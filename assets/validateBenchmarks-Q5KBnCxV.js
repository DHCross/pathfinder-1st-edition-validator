import{M as u,C as x,a as b,S as P,X as M}from"./pf1e-data-tables-BqrvN3By.js";function A(c,l="enforce_cr"){const e=JSON.parse(JSON.stringify(c)),s=[],n=(a,o,f,d)=>{o!=f&&s.push({feature:a,oldValue:o,newValue:f,reason:d})};if(l==="enforce_cr"){const a=u.find(o=>o.cr===e.cr);if(a){const f=(x[e.type]||{hitDieType:8}).hitDieType/2+.5,d=Math.floor(((e.con||10)-10)/2),_=Math.max(1,f+d),$=e.hp_claimed||e.hp;if($>a.hp*1.5){const y=Math.max(1,Math.round(a.hp/_));if((e.classLevels||[]).length===0){const H=e.racialHD;e.racialHD=y;const C=Math.floor(e.racialHD*f)+e.racialHD*d;e.hp=C,e.hp_claimed=C,n("Hit Dice",H,y,`Reduced to match CR ${e.cr} Benchmark`),n("Hit Points",$,C,`Recalculated for ${y} HD`)}}}}let t=0;if(e.racialHD&&e.racialHD>0){const a=x[e.type];let o="medium";a&&(o=a.babProgression),o==="fast"?t+=e.racialHD:o==="medium"?t+=Math.floor(e.racialHD*.75):t+=Math.floor(e.racialHD*.5)}for(const a of e.classLevels||[]){const o=b[a.className];o&&(o.babProgression==="fast"?t+=a.level:o.babProgression==="medium"?t+=Math.floor(a.level*.75):t+=Math.floor(a.level*.5))}(e.racialHD||0)===0&&(e.classLevels||[]).length===0&&(t=e.bab_claimed??e.bab??0);const h=e.bab_claimed??e.bab;t!==h&&(n("Base Attack Bonus",h,t,`Fixed based on ${e.racialHD||0} HD (${e.type}) + Class Levels`),e.bab=t,e.bab_claimed=t);const m=P[e.size]||{acAttackMod:0,cmbCmdMod:0},r=Math.floor(((e.str??10)-10)/2),v=Math.floor(((e.dex??10)-10)/2),p=10+t+r+v+(m.cmbCmdMod||0),S=e.cmd_claimed??e.cmd;if(p!==S&&(n("CMD",S,p,`Recalculated: 10 + BAB(${t}) + Str(${r}) + Dex(${v}) + Size(${m.cmbCmdMod})`),e.cmd=p,e.cmd_claimed=p),l==="fix_math"){const a=e.hp_claimed||e.hp;if(a>0){const o=u.find(f=>f.cr===e.cr);if(o&&a>o.hp*1.5){const f=u.find(d=>a>=d.hp*.85&&a<=d.hp*1.25);f&&(n("Challenge Rating",e.cr,f.cr,`Upgraded to match HP (${a})`),e.cr=f.cr,e.cr_text=f.cr)}}}let i=e.cr_text||e.cr.toString();if(i==="0.5"&&(i="1/2"),(i==="0.33"||i==="0.333")&&(i="1/3"),i==="0.25"&&(i="1/4"),(i==="0.16"||i==="0.166"||i==="0.167")&&(i="1/6"),i==="0.125"&&(i="1/8"),M[i]){const a=M[i];e.xp!==a&&(n("XP Award",e.xp,a,`Standardized for CR ${i}`),e.xp=a)}const g=e.ac_claimed||e.ac,D=10+v+m.acAttackMod;return g>D?e.ac=g:e.ac=Math.max(g,D),{block:e,fixes:s}}function w(c){const l=[],e=typeof c.cr=="number"?c.cr:parseInt(String(c.cr),10);if(isNaN(e))return{valid:!0,messages:l,status:"PASS"};const s=u.find(r=>r.cr===String(c.cr)||r.cr===c.cr_text);if(!s)return{valid:!0,messages:l,status:"PASS"};const n=c.hp_claimed??c.hp??void 0;if(n!==void 0&&typeof n=="number"){const r=n/s.hp;r<.7?l.push({severity:"warning",category:"benchmarks",message:`HP ${n} is very low for CR ${c.cr}. Standard is ~${s.hp}. Creature may be too fragile.`,expected:s.hp,actual:n}):r>1.5&&l.push({severity:"warning",category:"benchmarks",message:`HP ${n} is very high for CR ${c.cr}. Standard is ~${s.hp}. This is a "Damage Sponge."`,expected:s.hp,actual:n})}const t=c.ac_claimed??c.ac??void 0;if(t!==void 0&&typeof t=="number"){const r=t-s.ac;r<-4?l.push({severity:"warning",category:"benchmarks",message:`AC ${t} is very low for CR ${c.cr}. Standard is ~${s.ac}. Creature will be crit often.`,expected:s.ac,actual:t}):r>4&&l.push({severity:"warning",category:"benchmarks",message:`AC ${t} is very high for CR ${c.cr}. Standard is ~${s.ac}. Players may struggle to hit.`,expected:s.ac,actual:t})}const h=[{name:"Fort",val:c.fort_save_claimed},{name:"Ref",val:c.ref_save_claimed},{name:"Will",val:c.will_save_claimed}];for(const r of h)r.val!==void 0&&typeof r.val=="number"&&r.val<s.poorSave-2&&l.push({severity:"warning",category:"benchmarks",message:`${r.name} Save +${r.val} is very low for CR ${c.cr}. Standard is ~+${s.poorSave}. It will fail often.`,expected:s.poorSave,actual:r.val});return{valid:!l.some(r=>r.severity==="critical"),messages:l,status:l.length>0?"WARN":"PASS"}}export{A as a,w as v};
