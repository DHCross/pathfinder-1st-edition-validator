import{C as $,a as M,M as x,S as D,X as H,W as h,T as L}from"./pf1e-data-tables-BqrvN3By.js";function N(e){const r=[];let s=!1,t=e.racialHD||0,a=0;if(e.racialHD&&e.racialHD>0){const c=$[e.type];c?c.babProgression==="fast"?a+=e.racialHD:c.babProgression==="medium"?a+=Math.floor(e.racialHD*.75):a+=Math.floor(e.racialHD*.5):a+=Math.floor(e.racialHD*.75)}for(const c of e.classLevels||[]){const d=M[c.className];d&&(t+=c.level,d.babProgression==="fast"?a+=c.level:d.babProgression==="medium"?a+=Math.floor(c.level*.75):a+=Math.floor(c.level*.5))}const u=(e.cr||"").toString(),l=x.find(c=>c.cr===u);if(l){const c=Math.max(1,Math.round((l.hp||1)/4.5)),d=c*2;t>d&&t>=3&&(s=!0,r.push({category:"structure",severity:"critical",message:`HD/CR Mismatch: ${t} Hit Dice is inappropriate for CR ${e.cr}. This HD count suggests a much higher CR than declared and is a structural contradiction.`,expected:`${c} HD (max ${d})`,actual:`${t} HD`}))}const o=D[e.size]||{cmbCmdMod:0},i=Math.floor(((e.str||10)-10)/2),n=Math.floor(((e.dex||10)-10)/2);let g="MATCH";e.bab_claimed!==void 0&&e.bab_claimed!==a&&(g="MISMATCH",s=!0,r.push({category:"basics",severity:"critical",message:`Base Attack Bonus (BAB) +${e.bab_claimed} is illegal for ${t} HD. It must be +${a} according to ${e.type} progression.`,expected:a,actual:e.bab_claimed}));const m=10+a+i+n+o.cmbCmdMod,C=10+(e.bab_claimed||0)+i+n+o.cmbCmdMod;e.cmd_claimed&&(e.cmd_claimed===m||(e.cmd_claimed===C&&g==="MISMATCH"?r.push({category:"basics",severity:"warning",message:`CMD ${e.cmd_claimed} matches the source's (incorrect) BAB of +${e.bab_claimed}. If BAB were corrected to +${a}, CMD would be ${m}.`,expected:m,actual:e.cmd_claimed}):(s=!0,r.push({category:"basics",severity:"critical",message:`Calculated CMD is ${m} (10 + Legal BAB ${a} + Str ${i} + Dex ${n} + Size ${o.cmbCmdMod}), but stat block claims ${e.cmd_claimed}.`,expected:m,actual:e.cmd_claimed}))));const p=Math.ceil(t/2),v=e.feats?.length||0;v<p&&r.push({category:"basics",severity:"warning",message:`Creature has ${t} HD and should have at least ${p} feats, but only lists ${v}.`,expected:p,actual:v});const f=H[e.cr];return f&&e.xp!==f&&(s=!0,r.push({category:"basics",severity:"critical",message:`XP ${e.xp} does not match canonical value ${f} for CR ${e.cr}. (Source: Core Rulebook Experience Point Awards table)`,expected:f,actual:e.xp})),{valid:!s,status:s?"FAIL":r.length>0?"WARN":"PASS",messages:r}}function S(e){const r=[];if(e.gearValue===void 0)return{valid:!0,messages:[{severity:"note",category:"economy",message:"No gear value provided; skipping economy validation."}]};const s=A(e),t=T(e,s);if(t===null)return r.push({severity:"warning",category:"economy",message:`Unable to determine expected wealth for ${s} tier.`}),{valid:!0,messages:r};const a=e.gearValue,l=(a-t)/t*100,o=15;Math.abs(l)<=o?r.push({severity:"note",category:"economy",message:`Wealth is on target for ${s} (${a} gp vs expected ${t} gp).`,expected:t,actual:a}):l>o?r.push({severity:"warning",category:"economy",message:`Over-geared: ${s} has ${a} gp, expected ~${t} gp (+${l.toFixed(1)}%).`,expected:t,actual:a}):r.push({severity:"warning",category:"economy",message:`Under-geared: ${s} has ${a} gp, expected ~${t} gp (${l.toFixed(1)}%).`,expected:t,actual:a});let i="PASS";return r.some(n=>n.severity==="critical")?i="FAIL":r.some(n=>n.severity==="warning")&&(i="WARN"),{valid:Math.abs(l)<=o,messages:r,status:i}}function A(e){if(e.economicTier)return e.economicTier;const r=e.racialHD||0,s=e.classLevels||[],t=["Warrior","Expert","Commoner","Adept","Aristocrat"],u=s.filter(i=>!t.includes(i.className)).reduce((i,n)=>i+n.level,0),o=s.filter(i=>t.includes(i.className)).reduce((i,n)=>i+n.level,0);return u>=r&&u>0?"Heroic NPC":o>0?"Basic NPC":"Monster"}function T(e,r){if(r==="Heroic NPC"){const s=y(e);return s<1||s>20?null:h.heroicNpc[s]||null}if(r==="Basic NPC"){const s=y(e);return s<1||s>20?null:h.basicNpc[s]||null}if(r==="Monster"){const s=e.cr,t=L[s];if(!t)return null;let a=t.medium;return e.treasureType==="Double"?a*=2:e.treasureType==="Triple"?a*=3:e.treasureType==="Incidental"?a*=.5:e.treasureType==="None"&&(a=0),a}return null}function y(e){if(e.claimedEffectiveLevel!==void 0)return e.claimedEffectiveLevel;const r=e.racialHD||0,t=(e.classLevels||[]).reduce((a,u)=>a+u.level,0);return r+t}export{S as a,N as v};
