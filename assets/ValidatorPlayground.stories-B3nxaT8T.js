import{r as M,R as r}from"./iframe-bJ9Mhkbi.js";import{s as O,f as W}from"./pf1e-formatter-Bo9W7QKQ.js";import{M as w,C as z,a as X,S as U,X as P}from"./pf1e-data-tables-BqrvN3By.js";import{v as J,a as q,V as K}from"./validateEconomy-BmtNKXSQ.js";import"./preload-helper-PPVm8Dsz.js";function Q(c){return c.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function j(c){const t=Q(c),e={name:t.split(`
`).map(f=>f.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=t.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(e.melee_line="Melee "+o[1].trim());const n=t.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);n&&(e.ranged_line="Ranged "+n[1].trim());const u=t.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);u&&(e.speed_line="Speed "+u[1].trim());const S=t.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);S&&(e.special_attacks_line="Special Attacks "+S[1].trim());const i=t.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);i&&(e.spells_block=i[0].trim());const y=t.match(/SPECIAL ABILITIES(.+)$/s);y&&(e.special_abilities_block=`SPECIAL ABILITIES
`+y[1].trim());const v=t.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);v&&(e.skills_line="Skills "+v[1].trim());const E=t.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);E&&(e.languages_line="Languages "+E[1].trim());const d=t.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);d&&(e.equipment_line="Equipment "+d[1].trim());const x=t.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);x&&(e.cr=x[1]);const l=t.match(/XP\s*([0-9,]+)/i);l&&(e.xp=parseInt(l[1].replace(/,/g,"")));const s=t.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(s){e.alignment=s[1],e.size=s[2];const f=s[3].trim();e.subtypes=f.split(/,\s*/).map(D=>D.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(f)?e.type="Outsider":/Dragon/i.test(f)?e.type="Dragon":/Undead/i.test(f)?e.type="Undead":/Beast/i.test(f)?e.type="Magical Beast":e.type=f.split(" ")[0]}const m=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let p;for(;(p=m.exec(t))!==null;)e.classLevels?.push({className:p[1],level:parseInt(p[2])});const h=t.match(/AC\s*(\d+)/i);h&&(e.ac_claimed=parseInt(h[1]));const A=t.match(/touch\s*(\d+)/i);A&&(e.touch_ac_claimed=parseInt(A[1]));const _=t.match(/flat-?footed\s*(\d+)/i);_&&(e.flat_footed_ac_claimed=parseInt(_[1]));const g=t.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(g&&(e.hp_claimed=parseInt(g[1]),e.hp=parseInt(g[1]),g[2])){const f=/(\d+)d/.exec(g[2]);f&&(e.racialHD=parseInt(f[1]))}const b=e.classLevels?.reduce((f,D)=>f+D.level,0)||0;e.racialHD===b&&b>0&&(e.racialHD=0);const C=t.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);C&&(e.fort_save_claimed=parseInt(C[1]),e.ref_save_claimed=parseInt(C[2]),e.will_save_claimed=parseInt(C[3]));const I=t.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);I&&(e.bab_claimed=parseInt(I[1]));const N=t.match(/CMD\s*(\d+)/i);N&&(e.cmd_claimed=parseInt(N[1]));const R=(f,D)=>{const G=new RegExp(`${D}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),H=f.match(G);if(!H)return 10;const $=H[1];return/\d/.test($)?parseInt($):0};e.str=R(t,"Str"),e.dex=R(t,"Dex"),e.con=R(t,"Con"),e.int=R(t,"Int"),e.wis=R(t,"Wis"),e.cha=R(t,"Cha"),e.ac_claimed&&(e.ac=e.ac_claimed),e.touch_ac_claimed&&(e.touch=e.touch_ac_claimed),e.flat_footed_ac_claimed&&(e.flatFooted=e.flat_footed_ac_claimed);const k=t.match(/Init\s*([+-]?\d+)/i);k&&(e.init_claimed=parseInt(k[1]));const L=t.match(/Perception\s*([+-]?\d+)/i);L&&(e.perception_claimed=parseInt(L[1]));const T=t.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);T&&(e.feats=T[1].split(/[,;]/).map(f=>f.trim()).filter(Boolean));const F=t.match(/Treasure\s+(.+?)(?:$|\n)/i);if(F){const f=F[1].toLowerCase();f.includes("npc gear")?e.treasureType="NPC Gear":(f.includes("standard"),e.treasureType="Standard")}return e}function Z(c,t="enforce_cr"){const a=JSON.parse(JSON.stringify(c)),e=[],o=(s,m,p,h)=>{m!=p&&e.push({feature:s,oldValue:m,newValue:p,reason:h})};if(t==="enforce_cr"){const s=w.find(m=>m.cr===a.cr);if(s){const p=(z[a.type]||{hitDieType:8}).hitDieType/2+.5,h=Math.floor(((a.con||10)-10)/2),A=Math.max(1,p+h),_=a.hp_claimed||a.hp;if(_>s.hp*1.5){const g=Math.max(1,Math.round(s.hp/A));if((a.classLevels||[]).length===0){const b=a.racialHD;a.racialHD=g;const C=Math.floor(a.racialHD*p)+a.racialHD*h;a.hp=C,a.hp_claimed=C,o("Hit Dice",b,g,`Reduced to match CR ${a.cr} Benchmark`),o("Hit Points",_,C,`Recalculated for ${g} HD`)}}}}let n=0;if(a.racialHD&&a.racialHD>0){const s=z[a.type];let m="medium";s&&(m=s.babProgression),m==="fast"?n+=a.racialHD:m==="medium"?n+=Math.floor(a.racialHD*.75):n+=Math.floor(a.racialHD*.5)}for(const s of a.classLevels||[]){const m=X[s.className];m&&(m.babProgression==="fast"?n+=s.level:m.babProgression==="medium"?n+=Math.floor(s.level*.75):n+=Math.floor(s.level*.5))}(a.racialHD||0)===0&&(a.classLevels||[]).length===0&&(n=a.bab_claimed??a.bab??0);const u=a.bab_claimed??a.bab;n!==u&&(o("Base Attack Bonus",u,n,`Fixed based on ${a.racialHD||0} HD (${a.type}) + Class Levels`),a.bab=n,a.bab_claimed=n);const S=U[a.size]||{acAttackMod:0,cmbCmdMod:0},i=Math.floor(((a.str??10)-10)/2),y=Math.floor(((a.dex??10)-10)/2),v=10+n+i+y+(S.cmbCmdMod||0),E=a.cmd_claimed??a.cmd;if(v!==E&&(o("CMD",E,v,`Recalculated: 10 + BAB(${n}) + Str(${i}) + Dex(${y}) + Size(${S.cmbCmdMod})`),a.cmd=v,a.cmd_claimed=v),t==="fix_math"){const s=a.hp_claimed||a.hp;if(s>0){const m=w.find(p=>p.cr===a.cr);if(m&&s>m.hp*1.5){const p=w.find(h=>s>=h.hp*.85&&s<=h.hp*1.25);p&&(o("Challenge Rating",a.cr,p.cr,`Upgraded to match HP (${s})`),a.cr=p.cr,a.cr_text=p.cr)}}}let d=a.cr_text||a.cr.toString();if(d==="0.5"&&(d="1/2"),(d==="0.33"||d==="0.333")&&(d="1/3"),d==="0.25"&&(d="1/4"),(d==="0.16"||d==="0.166"||d==="0.167")&&(d="1/6"),d==="0.125"&&(d="1/8"),P[d]){const s=P[d];a.xp!==s&&(o("XP Award",a.xp,s,`Standardized for CR ${d}`),a.xp=s)}const x=a.ac_claimed||a.ac,l=10+y+S.acAttackMod;return x>l?a.ac=x:a.ac=Math.max(x,l),{block:a,fixes:e}}function Y(c){const t=[],a=typeof c.cr=="number"?c.cr:parseInt(String(c.cr),10);if(isNaN(a))return{valid:!0,messages:t,status:"PASS"};const e=w.find(i=>i.cr===String(c.cr)||i.cr===c.cr_text);if(!e)return{valid:!0,messages:t,status:"PASS"};const o=c.hp_claimed??c.hp??void 0;if(o!==void 0&&typeof o=="number"){const i=o/e.hp;i<.7?t.push({severity:"warning",category:"benchmarks",message:`HP ${o} is very low for CR ${c.cr}. Standard is ~${e.hp}. Creature may be too fragile.`,expected:e.hp,actual:o}):i>1.5&&t.push({severity:"warning",category:"benchmarks",message:`HP ${o} is very high for CR ${c.cr}. Standard is ~${e.hp}. This is a "Damage Sponge."`,expected:e.hp,actual:o})}const n=c.ac_claimed??c.ac??void 0;if(n!==void 0&&typeof n=="number"){const i=n-e.ac;i<-4?t.push({severity:"warning",category:"benchmarks",message:`AC ${n} is very low for CR ${c.cr}. Standard is ~${e.ac}. Creature will be crit often.`,expected:e.ac,actual:n}):i>4&&t.push({severity:"warning",category:"benchmarks",message:`AC ${n} is very high for CR ${c.cr}. Standard is ~${e.ac}. Players may struggle to hit.`,expected:e.ac,actual:n})}const u=[{name:"Fort",val:c.fort_save_claimed},{name:"Ref",val:c.ref_save_claimed},{name:"Will",val:c.will_save_claimed}];for(const i of u)i.val!==void 0&&typeof i.val=="number"&&i.val<e.poorSave-2&&t.push({severity:"warning",category:"benchmarks",message:`${i.name} Save +${i.val} is very low for CR ${c.cr}. Standard is ~+${e.poorSave}. It will fail often.`,expected:e.poorSave,actual:i.val});return{valid:!t.some(i=>i.severity==="critical"),messages:t,status:t.length>0?"WARN":"PASS"}}const ee=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,V=()=>{const[c,t]=M.useState(ee),[a,e]=M.useState(null),[o,n]=M.useState(1),[u,S]=M.useState("enforce_cr"),[i,y]=M.useState(null),[v,E]=M.useState([]),[d,x]=M.useState(null);return M.useEffect(()=>{if(!c.trim()){e(null),y(null),x(null),E([]);return}try{const l=j(c);e(l);const s=parseInt(l.cr)||1;n(s)}catch(l){console.error(l)}},[c]),M.useEffect(()=>{if(!a)return;let l=JSON.parse(JSON.stringify(a));const s=[],m=a.cr,p=o.toString();if(m!==p){const I=P[p];if(I){const{block:N,changes:R}=O(l,I);l=N,R.forEach(k=>s.push({feature:"Creature Scaler",oldValue:m,newValue:p,reason:k}))}}const{block:h,fixes:A}=Z(l,u);y(h),E([...s,...A]);const _=J(h),g=Y(h),b=q(h),C={valid:_.valid&&g.valid&&b.valid,status:_.status==="FAIL"||b.status==="FAIL"?"FAIL":_.status==="WARN"||b.status==="WARN"||g.status==="WARN"?"WARN":"PASS",messages:[..._.messages,...g.messages,...b.messages]};x(C)},[a,o,u]),r.createElement("div",{className:"validator-playground"},r.createElement("div",{className:"validator-column"},r.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),r.createElement("textarea",{className:"validator-textarea",value:c,onChange:l=>t(l.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"validator-scroll-area"},r.createElement("div",null,r.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v2.1)"),a&&d?r.createElement(K,{statBlock:a,validation:d}):null),v.length>0&&r.createElement("div",{className:"fix-report"},r.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",u==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"fix-list"},v.map((l,s)=>r.createElement("li",{key:s,className:"fix-item"},r.createElement("div",{style:{fontWeight:600}},l.feature),r.createElement("div",{className:"fix-change-row"},r.createElement("span",{className:"fix-old"},l.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"fix-new"},l.newValue)),r.createElement("div",{className:"fix-reason"},l.reason)))))),r.createElement("div",{className:"validator-column"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},r.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),r.createElement("div",{className:"mode-toggle",style:{display:"flex",alignItems:"center",gap:"1rem"}},r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"}},r.createElement("label",{htmlFor:"cr-slider",style:{fontSize:"0.75rem",fontWeight:"bold",color:"#4b5563"}},"Target CR: ",o),r.createElement("input",{id:"cr-slider",type:"range",min:"1",max:"20",value:o,onChange:l=>n(parseInt(l.target.value)),style:{width:"100px"}})),r.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},r.createElement("button",{onClick:()=>S("enforce_cr"),style:{backgroundColor:u==="enforce_cr"?"white":"transparent",color:u==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:u==="enforce_cr"?"bold":"normal",boxShadow:u==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep CR, Downgrade Stats"},"Design Mode (Enforce CR)"),r.createElement("button",{onClick:()=>S("fix_math"),style:{backgroundColor:u==="fix_math"?"white":"transparent",color:u==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:u==="fix_math"?"bold":"normal",boxShadow:u==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep Stats, Update CR"},"Audit Mode (Fix Math)")))),r.createElement("div",{className:"output-area"},i?r.createElement("pre",{className:"output-pre"},W(i)):r.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),r.createElement("button",{onClick:()=>i&&navigator.clipboard.writeText(W(i)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};V.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ie={title:"Validators/Rules Lawyer Workbench",component:V,parameters:{layout:"fullscreen"}},B={};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:"{}",...B.parameters?.docs?.source}}};const ne=["InteractiveWorkbench"];export{B as InteractiveWorkbench,ne as __namedExportsOrder,ie as default};
