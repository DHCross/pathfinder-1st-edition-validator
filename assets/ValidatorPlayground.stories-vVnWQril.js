import{r as D,R as r}from"./iframe-BG7qFO6u.js";import{C as j,b as O,S as q,M as H,X as G,v as J,a as Q,V as K}from"./validateEconomy-DhifNorQ.js";import"./preload-helper-PPVm8Dsz.js";function Z(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function Y(e){const s=Z(e),t={name:s.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=s.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(t.melee_line="Melee "+o[1].trim());const l=s.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);l&&(t.ranged_line="Ranged "+l[1].trim());const h=s.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);h&&(t.speed_line="Speed "+h[1].trim());const u=s.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);u&&(t.special_attacks_line="Special Attacks "+u[1].trim());const n=s.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);n&&(t.spells_block=n[0].trim());const x=s.match(/SPECIAL ABILITIES(.+)$/s);x&&(t.special_abilities_block=`SPECIAL ABILITIES
`+x[1].trim());const g=s.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);g&&(t.skills_line="Skills "+g[1].trim());const S=s.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);S&&(t.languages_line="Languages "+S[1].trim());const i=s.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);i&&(t.equipment_line="Equipment "+i[1].trim());const c=s.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);c&&(t.cr=c[1]);const d=s.match(/XP\s*([0-9,]+)/i);d&&(t.xp=parseInt(d[1].replace(/,/g,"")));const m=s.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(m){t.alignment=m[1],t.size=m[2];const p=m[3].trim();t.subtypes=p.split(/,\s*/).map(W=>W.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?t.type="Outsider":/Dragon/i.test(p)?t.type="Dragon":/Undead/i.test(p)?t.type="Undead":/Beast/i.test(p)?t.type="Magical Beast":t.type=p.split(" ")[0]}const _=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let $;for(;($=_.exec(s))!==null;)t.classLevels?.push({className:$[1],level:parseInt($[2])});const y=s.match(/AC\s*(\d+)/i);y&&(t.ac_claimed=parseInt(y[1]));const M=s.match(/touch\s*(\d+)/i);M&&(t.touch_ac_claimed=parseInt(M[1]));const A=s.match(/flat-?footed\s*(\d+)/i);A&&(t.flat_footed_ac_claimed=parseInt(A[1]));const v=s.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(v&&(t.hp_claimed=parseInt(v[1]),t.hp=parseInt(v[1]),v[2])){const p=/(\d+)d/.exec(v[2]);p&&(t.racialHD=parseInt(p[1]))}const R=t.classLevels?.reduce((p,W)=>p+W.level,0)||0;t.racialHD===R&&R>0&&(t.racialHD=0);const N=s.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);N&&(t.fort_save_claimed=parseInt(N[1]),t.ref_save_claimed=parseInt(N[2]),t.will_save_claimed=parseInt(N[3]));const w=s.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);w&&(t.bab_claimed=parseInt(w[1]));const B=s.match(/CMD\s*(\d+)/i);B&&(t.cmd_claimed=parseInt(B[1]));const I=/Str\s*(\d+)/i.exec(s),T=/Dex\s*(\d+)/i.exec(s),f=/Con\s*(\d+)/i.exec(s),C=/Int\s*(\d+)/i.exec(s),b=/Wis\s*(\d+)/i.exec(s),E=/Cha\s*(\d+)/i.exec(s);I&&(t.str=parseInt(I[1])),T&&(t.dex=parseInt(T[1])),f&&(t.con=parseInt(f[1])),C&&(t.int=parseInt(C[1])),b&&(t.wis=parseInt(b[1])),E&&(t.cha=parseInt(E[1])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const L=s.match(/Init\s*([+-]?\d+)/i);L&&(t.init_claimed=parseInt(L[1]));const P=s.match(/Perception\s*([+-]?\d+)/i);P&&(t.perception_claimed=parseInt(P[1]));const z=s.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);z&&(t.feats=z[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const V=s.match(/Treasure\s+(.+?)(?:$|\n)/i);if(V){const p=V[1].toLowerCase();p.includes("npc gear")?t.treasureType="NPC Gear":(p.includes("standard"),t.treasureType="Standard")}return t}function X(e){const{name:s,cr:a,xp:t,size:o,type:l}=e,h=e.alignment||"N",u=f=>Math.floor((f-10)/2),n=f=>u(f)>=0?`+${u(f)}`:`${u(f)}`;let x="";const g=e.classLevels?.reduce((f,C)=>f+C.level,0)||0;if(g>0&&(e.racialHD||0)===0){const f=e.classLevels[0],C=j[f.className],b=C?C.hitDieType:8,E=e.classLevels.reduce((L,P)=>L+P.level,0);x=`${E}d${b}+${u(e.con)*E}`}else{const f=e.racialHD||1,b=(O[e.type]||{hitDieType:8}).hitDieType,E=f+g;x=`${E}d${b}+${u(e.con)*E}`}const S=e.classLevels?.map(f=>`${f.className} ${f.level}`).join(", ")||"",i=e.subtypes&&e.subtypes.length>0?e.subtypes.join(", "):l,c=S?`${h} ${o} ${i} ${S}`:`${h} ${o} ${i}`,d=e.melee_line||`Melee weapon +${e.bab_claimed||0} (1d8)`,m=e.ranged_line?`${e.ranged_line}
`:"",_=e.special_attacks_line?`${e.special_attacks_line}
`:"",$=e.spells_block?`${e.spells_block}
`:"",y=e.skills_line?`${e.skills_line}
`:"",M=e.languages_line?`${e.languages_line}
`:"",A=e.equipment_line?`${e.equipment_line}
`:"",v=e.special_abilities_block?`
${e.special_abilities_block}`:"",R=e.speed_line||"Speed 30 ft.",N=e.init_claimed!==void 0?e.init_claimed>=0?`+${e.init_claimed}`:`${e.init_claimed}`:n(e.dex),w=e.perception_claimed!==void 0?e.perception_claimed>=0?`+${e.perception_claimed}`:`${e.perception_claimed}`:"+0",B=q[o]||{cmbCmdMod:0},I=(e.bab_claimed||0)+u(e.str)+B.cmbCmdMod,T=I>=0?`+${I}`:`${I}`;return`
${s}
CR ${a}
XP ${t?.toLocaleString()||"0"}
${c}
Init ${N}; Senses Perception ${w}
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${x})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
${R}
${d}
${m}${_}${$}STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||0}; CMB ${T}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
${y}${M}${A}${v}
`.trim()}function k(e,s="fix_math"){const a=JSON.parse(JSON.stringify(e)),t=[],o=(c,d,m,_)=>{d!=m&&t.push({feature:c,oldValue:d,newValue:m,reason:_})};if(s==="enforce_cr"){const c=H.find(d=>d.cr===a.cr);if(c){const m=(O[a.type]||{hitDieType:8}).hitDieType/2+.5,_=Math.floor(((a.con||10)-10)/2),$=Math.max(1,m+_),y=a.hp_claimed||a.hp;if(y>c.hp*1.5){const M=Math.max(1,Math.round(c.hp/$));if((a.classLevels||[]).length===0){const A=a.racialHD;a.racialHD=M;const v=Math.floor(a.racialHD*m)+a.racialHD*_;a.hp=v,a.hp_claimed=v,o("Hit Dice",A,M,`Reduced to match CR ${a.cr} Benchmark`),o("Hit Points",y,v,`Recalculated for ${M} HD`)}}}}let l=0;if(a.racialHD&&a.racialHD>0){const c=O[a.type];let d="medium";c&&(d=c.babProgression),d==="fast"?l+=a.racialHD:d==="medium"?l+=Math.floor(a.racialHD*.75):l+=Math.floor(a.racialHD*.5)}for(const c of a.classLevels||[]){const d=j[c.className];d&&(d.babProgression==="fast"?l+=c.level:d.babProgression==="medium"?l+=Math.floor(c.level*.75):l+=Math.floor(c.level*.5))}(a.racialHD||0)===0&&(a.classLevels||[]).length===0&&(l=a.bab_claimed??a.bab??0);const h=a.bab_claimed??a.bab;l!==h&&(o("Base Attack Bonus",h,l,`Fixed based on ${a.racialHD||0} HD (${a.type}) + Class Levels`),a.bab=l,a.bab_claimed=l);const u=q[a.size]||{cmbCmdMod:0},n=Math.floor(((a.str??10)-10)/2),x=Math.floor(((a.dex??10)-10)/2),g=10+l+n+x+(u.cmbCmdMod||0),S=a.cmd_claimed??a.cmd;if(g!==S&&(o("CMD",S,g,`Recalculated: 10 + BAB(${l}) + Str(${n}) + Dex(${x}) + Size(${u.cmbCmdMod})`),a.cmd=g,a.cmd_claimed=g),s==="fix_math"){const c=a.hp_claimed||a.hp;if(c>0){const d=H.find(m=>m.cr===a.cr);if(d&&c>d.hp*1.5){const m=H.find(_=>c>=_.hp*.85&&c<=_.hp*1.25);m&&(o("Challenge Rating",a.cr,m.cr,`Upgraded to match HP (${c})`),a.cr=m.cr,a.cr_text=m.cr)}}}let i=a.cr_text||a.cr.toString();if(i==="0.5"&&(i="1/2"),(i==="0.33"||i==="0.333")&&(i="1/3"),i==="0.25"&&(i="1/4"),(i==="0.16"||i==="0.166"||i==="0.167")&&(i="1/6"),i==="0.125"&&(i="1/8"),G[i]){const c=G[i];a.xp!==c&&(o("XP Award",a.xp,c,`Standardized for CR ${i}`),a.xp=c)}return{block:a,fixes:t}}function ee(e){const s=[],a=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(a))return{valid:!0,messages:s,status:"PASS"};const t=H.find(n=>n.cr===String(e.cr)||n.cr===e.cr_text);if(!t)return{valid:!0,messages:s,status:"PASS"};const o=e.hp_claimed??e.hp??void 0;if(o!==void 0&&typeof o=="number"){const n=o/t.hp;n<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${o} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):n>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${o} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const l=e.ac_claimed??e.ac??void 0;if(l!==void 0&&typeof l=="number"){const n=l-t.ac;n<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very low (-${Math.abs(n)}) for CR ${e.cr} (Benchmark: ${t.ac}).`}):n>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very high (+${n}) for CR ${e.cr} (Benchmark: ${t.ac}).`})}const h=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const n of h)n.val!==void 0&&typeof n.val=="number"&&n.val<t.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${n.name} Save +${n.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!s.some(n=>n.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const te=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,U=()=>{const[e,s]=D.useState(te),[a,t]=D.useState(null),[o,l]=D.useState("fix_math"),[h,u]=D.useState(null),[n,x]=D.useState([]),[g,S]=D.useState(null);return D.useEffect(()=>{if(!e.trim()){t(null),u(null),S(null),x([]);return}try{const i=Y(e);t(i);const c=J(i),d=ee(i),m=Q(i),_={valid:c.valid&&d.valid&&m.valid,status:c.status==="FAIL"||m.status==="FAIL"?"FAIL":c.status==="WARN"||m.status==="WARN"||d.status==="WARN"?"WARN":"PASS",messages:[...c.messages,...d.messages,...m.messages]};S(_);const{block:$,fixes:y}=k(i,o);u($),x(y)}catch(i){console.error(i)}},[e,o]),r.createElement("div",{className:"grid grid-cols-3 gap-4 p-4 h-screen bg-gray-50 font-sans"},r.createElement("div",{className:"flex flex-col gap-2 h-full"},r.createElement("h2",{className:"font-bold text-lg text-gray-700"},"1. Raw Stat Block"),r.createElement("textarea",{className:"flex-1 p-3 font-mono text-sm border border-gray-300 rounded shadow-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",value:e,onChange:i=>s(i.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"overflow-y-auto flex flex-col gap-4"},r.createElement("div",null,r.createElement("h3",{className:"font-bold text-lg mb-2 text-gray-700"},"2. Rules Lawyer Audit"),a&&g?r.createElement(K,{statBlock:a,validation:g}):null),n.length>0&&r.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4"},r.createElement("h4",{className:"font-bold text-blue-800 mb-2 text-sm flex items-center gap-2"},"ðŸ› ï¸ Auto-Fixes Applied (",o==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"space-y-2"},n.map((i,c)=>r.createElement("li",{key:c,className:"text-xs text-blue-900"},r.createElement("div",{className:"font-semibold"},i.feature),r.createElement("div",{className:"flex items-center gap-2 mt-0.5"},r.createElement("span",{className:"line-through opacity-60"},i.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"font-bold bg-white px-1 rounded border border-blue-100"},i.newValue)),r.createElement("div",{className:"text-blue-500 italic mt-0.5"},i.reason)))))),r.createElement("div",{className:"flex flex-col h-full"},r.createElement("div",{className:"flex justify-between items-center mb-2"},r.createElement("h2",{className:"font-bold text-lg text-gray-700"},"3. Auto-Fixed Version"),r.createElement("div",{className:"flex bg-gray-200 rounded p-1"},r.createElement("button",{onClick:()=>l("fix_math"),className:`px-3 py-1 text-xs rounded transition-all ${o==="fix_math"?"bg-white text-blue-700 font-bold shadow-sm":"text-gray-600 hover:text-gray-800"}`,title:"Trust Stats, Update CR"},"Fix Math"),r.createElement("button",{onClick:()=>l("enforce_cr"),className:`px-3 py-1 text-xs rounded transition-all ${o==="enforce_cr"?"bg-white text-blue-700 font-bold shadow-sm":"text-gray-600 hover:text-gray-800"}`,title:"Trust CR, Downgrade Stats"},"Enforce CR"))),r.createElement("div",{className:"flex-1 bg-white border rounded shadow-sm p-4 overflow-y-auto mt-2"},h?r.createElement("pre",{className:"text-xs font-mono whitespace-pre-wrap text-gray-800"},X(h)):r.createElement("p",{className:"text-gray-400 text-sm italic"},"Fixes will appear here.")),r.createElement("button",{onClick:()=>h&&navigator.clipboard.writeText(X(h)),className:"mt-2 w-full py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow-sm transition-colors flex items-center justify-center gap-2"},"ðŸ“‹ Copy to Clipboard")))};U.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ce={title:"Validators/Rules Lawyer Workbench",component:U,parameters:{layout:"fullscreen"}},F={};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:"{}",...F.parameters?.docs?.source}}};const ne=["InteractiveWorkbench"];export{F as InteractiveWorkbench,ne as __namedExportsOrder,ce as default};
