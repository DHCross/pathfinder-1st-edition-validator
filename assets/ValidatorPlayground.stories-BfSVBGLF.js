import{r as x,R as r}from"./iframe-B9MrWvyw.js";import{f as H}from"./pf1e-formatter-CbX6Uino.js";import{M as I,C as W,a as X,S as O,X as z}from"./pf1e-data-tables-BqrvN3By.js";import{v as U,a as q,V as J}from"./validateEconomy-swa5cDLk.js";import"./preload-helper-PPVm8Dsz.js";function Q(i){return i.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function j(i){const t=Q(i),e={name:t.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},m=t.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);m&&(e.melee_line="Melee "+m[1].trim());const n=t.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);n&&(e.ranged_line="Ranged "+n[1].trim());const h=t.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);h&&(e.speed_line="Speed "+h[1].trim());const g=t.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);g&&(e.special_attacks_line="Special Attacks "+g[1].trim());const l=t.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);l&&(e.spells_block=l[0].trim());const S=t.match(/SPECIAL ABILITIES(.+)$/s);S&&(e.special_abilities_block=`SPECIAL ABILITIES
`+S[1].trim());const v=t.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);v&&(e.skills_line="Skills "+v[1].trim());const C=t.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);C&&(e.languages_line="Languages "+C[1].trim());const c=t.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);c&&(e.equipment_line="Equipment "+c[1].trim());const f=t.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);f&&(e.cr=f[1]);const M=t.match(/XP\s*([0-9,]+)/i);M&&(e.xp=parseInt(M[1].replace(/,/g,"")));const s=t.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(s){e.alignment=s[1],e.size=s[2];const p=s[3].trim();e.subtypes=p.split(/,\s*/).map(A=>A.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?e.type="Outsider":/Dragon/i.test(p)?e.type="Dragon":/Undead/i.test(p)?e.type="Undead":/Beast/i.test(p)?e.type="Magical Beast":e.type=p.split(" ")[0]}const o=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let d;for(;(d=o.exec(t))!==null;)e.classLevels?.push({className:d[1],level:parseInt(d[2])});const u=t.match(/AC\s*(\d+)/i);u&&(e.ac_claimed=parseInt(u[1]));const R=t.match(/touch\s*(\d+)/i);R&&(e.touch_ac_claimed=parseInt(R[1]));const b=t.match(/flat-?footed\s*(\d+)/i);b&&(e.flat_footed_ac_claimed=parseInt(b[1]));const _=t.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(_&&(e.hp_claimed=parseInt(_[1]),e.hp=parseInt(_[1]),_[2])){const p=/(\d+)d/.exec(_[2]);p&&(e.racialHD=parseInt(p[1]))}const D=e.classLevels?.reduce((p,A)=>p+A.level,0)||0;e.racialHD===D&&D>0&&(e.racialHD=0);const y=t.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);y&&(e.fort_save_claimed=parseInt(y[1]),e.ref_save_claimed=parseInt(y[2]),e.will_save_claimed=parseInt(y[3]));const N=t.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);N&&(e.bab_claimed=parseInt(N[1]));const k=t.match(/CMD\s*(\d+)/i);k&&(e.cmd_claimed=parseInt(k[1]));const E=(p,A)=>{const G=new RegExp(`${A}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),T=p.match(G);if(!T)return 10;const F=T[1];return/\d/.test(F)?parseInt(F):0};e.str=E(t,"Str"),e.dex=E(t,"Dex"),e.con=E(t,"Con"),e.int=E(t,"Int"),e.wis=E(t,"Wis"),e.cha=E(t,"Cha"),e.ac_claimed&&(e.ac=e.ac_claimed),e.touch_ac_claimed&&(e.touch=e.touch_ac_claimed),e.flat_footed_ac_claimed&&(e.flatFooted=e.flat_footed_ac_claimed);const P=t.match(/Init\s*([+-]?\d+)/i);P&&(e.init_claimed=parseInt(P[1]));const $=t.match(/Perception\s*([+-]?\d+)/i);$&&(e.perception_claimed=parseInt($[1]));const w=t.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);w&&(e.feats=w[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const L=t.match(/Treasure\s+(.+?)(?:$|\n)/i);if(L){const p=L[1].toLowerCase();p.includes("npc gear")?e.treasureType="NPC Gear":(p.includes("standard"),e.treasureType="Standard")}return e}function K(i,t="fix_math"){const a=JSON.parse(JSON.stringify(i)),e=[],m=(s,o,d,u)=>{o!=d&&e.push({feature:s,oldValue:o,newValue:d,reason:u})};if(t==="enforce_cr"){const s=I.find(o=>o.cr===a.cr);if(s){const d=(W[a.type]||{hitDieType:8}).hitDieType/2+.5,u=Math.floor(((a.con||10)-10)/2),R=Math.max(1,d+u),b=a.hp_claimed||a.hp;if(b>s.hp*1.5){const _=Math.max(1,Math.round(s.hp/R));if((a.classLevels||[]).length===0){const D=a.racialHD;a.racialHD=_;const y=Math.floor(a.racialHD*d)+a.racialHD*u;a.hp=y,a.hp_claimed=y,m("Hit Dice",D,_,`Reduced to match CR ${a.cr} Benchmark`),m("Hit Points",b,y,`Recalculated for ${_} HD`)}}}}let n=0;if(a.racialHD&&a.racialHD>0){const s=W[a.type];let o="medium";s&&(o=s.babProgression),o==="fast"?n+=a.racialHD:o==="medium"?n+=Math.floor(a.racialHD*.75):n+=Math.floor(a.racialHD*.5)}for(const s of a.classLevels||[]){const o=X[s.className];o&&(o.babProgression==="fast"?n+=s.level:o.babProgression==="medium"?n+=Math.floor(s.level*.75):n+=Math.floor(s.level*.5))}(a.racialHD||0)===0&&(a.classLevels||[]).length===0&&(n=a.bab_claimed??a.bab??0);const h=a.bab_claimed??a.bab;n!==h&&(m("Base Attack Bonus",h,n,`Fixed based on ${a.racialHD||0} HD (${a.type}) + Class Levels`),a.bab=n,a.bab_claimed=n);const g=O[a.size]||{acAttackMod:0,cmbCmdMod:0},l=Math.floor(((a.str??10)-10)/2),S=Math.floor(((a.dex??10)-10)/2),v=10+n+l+S+(g.cmbCmdMod||0),C=a.cmd_claimed??a.cmd;if(v!==C&&(m("CMD",C,v,`Recalculated: 10 + BAB(${n}) + Str(${l}) + Dex(${S}) + Size(${g.cmbCmdMod})`),a.cmd=v,a.cmd_claimed=v),t==="fix_math"){const s=a.hp_claimed||a.hp;if(s>0){const o=I.find(d=>d.cr===a.cr);if(o&&s>o.hp*1.5){const d=I.find(u=>s>=u.hp*.85&&s<=u.hp*1.25);d&&(m("Challenge Rating",a.cr,d.cr,`Upgraded to match HP (${s})`),a.cr=d.cr,a.cr_text=d.cr)}}}let c=a.cr_text||a.cr.toString();if(c==="0.5"&&(c="1/2"),(c==="0.33"||c==="0.333")&&(c="1/3"),c==="0.25"&&(c="1/4"),(c==="0.16"||c==="0.166"||c==="0.167")&&(c="1/6"),c==="0.125"&&(c="1/8"),z[c]){const s=z[c];a.xp!==s&&(m("XP Award",a.xp,s,`Standardized for CR ${c}`),a.xp=s)}const f=a.ac_claimed||a.ac,M=10+S+g.acAttackMod;return f>M?a.ac=f:a.ac=Math.max(f,M),{block:a,fixes:e}}function Z(i){const t=[],a=typeof i.cr=="number"?i.cr:parseInt(String(i.cr),10);if(isNaN(a))return{valid:!0,messages:t,status:"PASS"};const e=I.find(l=>l.cr===String(i.cr)||l.cr===i.cr_text);if(!e)return{valid:!0,messages:t,status:"PASS"};const m=i.hp_claimed??i.hp??void 0;if(m!==void 0&&typeof m=="number"){const l=m/e.hp;l<.7?t.push({severity:"warning",category:"benchmarks",message:`HP ${m} is dangerously low (<70%) for CR ${i.cr} (Benchmark: ${e.hp}). Creature is a "Glass Jaw".`}):l>1.5&&t.push({severity:"warning",category:"benchmarks",message:`HP ${m} is significantly high (>150%) for CR ${i.cr} (Benchmark: ${e.hp}). It may be a "Damage Sponge".`})}const n=i.ac_claimed??i.ac??void 0;if(n!==void 0&&typeof n=="number"){const l=n-e.ac;l<-3?t.push({severity:"warning",category:"benchmarks",message:`AC ${n} is very low (-${Math.abs(l)}) for CR ${i.cr} (Benchmark: ${e.ac}).`}):l>5&&t.push({severity:"warning",category:"benchmarks",message:`AC ${n} is very high (+${l}) for CR ${i.cr} (Benchmark: ${e.ac}).`})}const h=[{name:"Fort",val:i.fort_save_claimed},{name:"Ref",val:i.ref_save_claimed},{name:"Will",val:i.will_save_claimed}];for(const l of h)l.val!==void 0&&typeof l.val=="number"&&l.val<e.poorSave-2&&t.push({severity:"warning",category:"benchmarks",message:`${l.name} Save +${l.val} is critically weak for CR ${i.cr} (Benchmark Poor Save: +${e.poorSave}).`});return{valid:!t.some(l=>l.severity==="critical"),messages:t,status:t.length>0?"WARN":"PASS"}}const Y=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,V=()=>{const[i,t]=x.useState(Y),[a,e]=x.useState(null),[m,n]=x.useState("fix_math"),[h,g]=x.useState(null),[l,S]=x.useState([]),[v,C]=x.useState(null);return x.useEffect(()=>{if(!i.trim()){e(null),g(null),C(null),S([]);return}try{const c=j(i);e(c);const{block:f,fixes:M}=K(c,m);g(f),S(M);const s=U(f),o=Z(f),d=q(f),u={valid:s.valid&&o.valid&&d.valid,status:s.status==="FAIL"||d.status==="FAIL"?"FAIL":s.status==="WARN"||d.status==="WARN"||o.status==="WARN"?"WARN":"PASS",messages:[...s.messages,...o.messages,...d.messages]};C(u)}catch(c){console.error(c)}},[i,m]),r.createElement("div",{className:"validator-playground"},r.createElement("div",{className:"validator-column"},r.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),r.createElement("textarea",{className:"validator-textarea",value:i,onChange:c=>t(c.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"validator-scroll-area"},r.createElement("div",null,r.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v2)"),a&&v?r.createElement(J,{statBlock:a,validation:v}):null),l.length>0&&r.createElement("div",{className:"fix-report"},r.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",m==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"fix-list"},l.map((c,f)=>r.createElement("li",{key:f,className:"fix-item"},r.createElement("div",{style:{fontWeight:600}},c.feature),r.createElement("div",{className:"fix-change-row"},r.createElement("span",{className:"fix-old"},c.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"fix-new"},c.newValue)),r.createElement("div",{className:"fix-reason"},c.reason)))))),r.createElement("div",{className:"validator-column"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},r.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),r.createElement("div",{className:"mode-toggle"},r.createElement("button",{onClick:()=>n("fix_math"),className:`mode-btn ${m==="fix_math"?"active":"inactive"}`,title:"Trust Stats, Update CR"},"Fix Math"),r.createElement("button",{onClick:()=>n("enforce_cr"),className:`mode-btn ${m==="enforce_cr"?"active":"inactive"}`,title:"Trust CR, Downgrade Stats"},"Enforce CR"))),r.createElement("div",{className:"output-area"},h?r.createElement("pre",{className:"output-pre"},H(h)):r.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),r.createElement("button",{onClick:()=>h&&navigator.clipboard.writeText(H(h)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};V.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ie={title:"Validators/Rules Lawyer Workbench",component:V,parameters:{layout:"fullscreen"}},B={};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:"{}",...B.parameters?.docs?.source}}};const re=["InteractiveWorkbench"];export{B as InteractiveWorkbench,re as __namedExportsOrder,ie as default};
