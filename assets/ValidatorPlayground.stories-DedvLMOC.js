import{r as T,R as c}from"./iframe-DrtcVVo2.js";import{C as O,a as G,S as q,X as H,M as J,v as U}from"./validateBasics-CetwHHmj.js";import"./preload-helper-PPVm8Dsz.js";function Q(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function W(e){const t=Q(e),a={name:t.split(`
`).map(l=>l.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=t.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(a.melee_line="Melee "+o[1].trim());const m=t.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);m&&(a.ranged_line="Ranged "+m[1].trim());const f=t.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);f&&(a.special_attacks_line="Special Attacks "+f[1].trim());const d=t.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);d&&(a.spells_block=d[0].trim());const s=t.match(/SPECIAL ABILITIES(.+)$/s);s&&(a.special_abilities_block=`SPECIAL ABILITIES
`+s[1].trim());const p=t.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);p&&(a.skills_line="Skills "+p[1].trim());const r=t.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);r&&(a.languages_line="Languages "+r[1].trim());const h=t.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);h&&(a.equipment_line="Equipment "+h[1].trim());const y=t.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);y&&(a.cr=y[1]);const _=t.match(/XP\s*([0-9,]+)/i);_&&(a.xp=parseInt(_[1].replace(/,/g,"")));const v=t.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(v){a.alignment=v[1],a.size=v[2];const l=v[3].trim();/Fiend|Devil|Demon|Daemon|Angel|Archon/i.test(l)?a.type="Outsider":/Dragon/i.test(l)?a.type="Dragon":/Undead/i.test(l)?a.type="Undead":a.type=l.split(" ")[0]}const R=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let C;for(;(C=R.exec(t))!==null;)a.classLevels?.push({className:C[1],level:parseInt(C[2])});const x=t.match(/AC\s*(\d+)/i);x&&(a.ac_claimed=parseInt(x[1]));const M=t.match(/touch\s*(\d+)/i);M&&(a.touch_ac_claimed=parseInt(M[1]));const I=t.match(/flat-?footed\s*(\d+)/i);I&&(a.flat_footed_ac_claimed=parseInt(I[1]));const S=t.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(S&&(a.hp_claimed=parseInt(S[1]),a.hp=parseInt(S[1]),S[2])){const l=/(\d+)d/.exec(S[2]);l&&(a.racialHD=parseInt(l[1]))}const n=a.classLevels?.reduce((l,X)=>l+X.level,0)||0;a.racialHD===n&&n>0&&(a.racialHD=0);const u=t.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);u&&(a.fort_save_claimed=parseInt(u[1]),a.ref_save_claimed=parseInt(u[2]),a.will_save_claimed=parseInt(u[3]));const $=t.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);$&&(a.bab_claimed=parseInt($[1]));const g=t.match(/CMD\s*(\d+)/i);g&&(a.cmd_claimed=parseInt(g[1]));const E=/Str\s*(\d+)/i.exec(t),D=/Dex\s*(\d+)/i.exec(t),B=/Con\s*(\d+)/i.exec(t),L=/Int\s*(\d+)/i.exec(t),F=/Wis\s*(\d+)/i.exec(t),P=/Cha\s*(\d+)/i.exec(t);E&&(a.str=parseInt(E[1])),D&&(a.dex=parseInt(D[1])),B&&(a.con=parseInt(B[1])),L&&(a.int=parseInt(L[1])),F&&(a.wis=parseInt(F[1])),P&&(a.cha=parseInt(P[1])),a.ac_claimed&&(a.ac=a.ac_claimed);const w=t.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);w&&(a.feats=w[1].split(/[,;]/).map(l=>l.trim()).filter(Boolean));const N=t.match(/Treasure\s+(.+?)(?:$|\n)/i);if(N){const l=N[1].toLowerCase();l.includes("npc gear")?a.treasureType="NPC Gear":(l.includes("standard"),a.treasureType="Standard")}return a}function j(e){const{name:t,cr:i,xp:a,size:o,type:m}=e,f=e.alignment||"N",d=n=>Math.floor((n-10)/2),s=n=>d(n)>=0?`+${d(n)}`:`${d(n)}`;let p="";const r=e.classLevels?.reduce((n,u)=>n+u.level,0)||0;if(r>0&&(e.racialHD||0)===0){const n=e.classLevels[0],u=O[n.className],$=u?u.hitDieType:8,g=e.classLevels.reduce((E,D)=>E+D.level,0);p=`${g}d${$}+${d(e.con)*g}`}else{const n=e.racialHD||1,$=(G[e.type]||{hitDieType:8}).hitDieType,g=n+r;p=`${g}d${$}+${d(e.con)*g}`}const h=e.classLevels?.map(n=>`${n.className} ${n.level}`).join(", ")||"",y=h?`${f} ${o} ${m} ${h}`:`${f} ${o} ${m}`,_=e.melee_line||`Melee weapon +${e.bab_claimed||0} (1d8)`,v=e.ranged_line?`${e.ranged_line}
`:"",R=e.special_attacks_line?`${e.special_attacks_line}
`:"",C=e.spells_block?`${e.spells_block}
`:"",x=e.skills_line?`${e.skills_line}
`:"",M=e.languages_line?`${e.languages_line}
`:"",I=e.equipment_line?`${e.equipment_line}
`:"",S=e.special_abilities_block?`
${e.special_abilities_block}`:"";return`
${t}
CR ${i}
XP ${a?.toLocaleString()||"0"}
${y}
Init ${s(e.dex)}; Senses Perception +0
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${p})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
Speed 30 ft.
${_}
${v}${R}${C}STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||0}; CMB +${(e.bab_claimed||0)+d(e.str)}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
${x}${M}${I}${S}
`.trim()}function b(e){const t=JSON.parse(JSON.stringify(e));let i=0;if(t.racialHD&&t.racialHD>0){const s=G[t.type];s?s.babProgression==="fast"?i+=t.racialHD:s.babProgression==="medium"?i+=Math.floor(t.racialHD*.75):i+=Math.floor(t.racialHD*.5):i+=Math.floor(t.racialHD*.75)}const a=t.classLevels||[];for(const s of a){const p=O[s.className];p&&(p.babProgression==="fast"?i+=s.level:p.babProgression==="medium"?i+=Math.floor(s.level*.75):i+=Math.floor(s.level*.5))}(t.racialHD||0)===0&&a.length===0&&(i=t.bab_claimed??t.bab??0),t.bab_claimed=i,t.bab=i;const o=q[t.size]||{cmbCmdMod:0},m=Math.floor(((t.str??10)-10)/2),f=Math.floor(((t.dex??10)-10)/2);t.cmd_claimed=10+i+m+f+(o.cmbCmdMod||0),t.cmd=t.cmd_claimed;let d=t.cr;return H[d]&&(t.xp=H[d]),t}function K(e){const t=[],i=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(i))return{valid:!0,messages:t,status:"PASS"};const a=J.find(s=>s.cr===String(e.cr)||s.cr===e.cr_text);if(!a)return{valid:!0,messages:t,status:"PASS"};const o=e.hp_claimed??e.hp??void 0;if(o!==void 0&&typeof o=="number"){const s=o/a.hp;s<.7?t.push({severity:"warning",category:"benchmarks",message:`HP ${o} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${a.hp}). Creature is a "Glass Jaw".`}):s>1.5&&t.push({severity:"warning",category:"benchmarks",message:`HP ${o} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${a.hp}). It may be a "Damage Sponge".`})}const m=e.ac_claimed??e.ac??void 0;if(m!==void 0&&typeof m=="number"){const s=m-a.ac;s<-3?t.push({severity:"warning",category:"benchmarks",message:`AC ${m} is very low (-${Math.abs(s)}) for CR ${e.cr} (Benchmark: ${a.ac}).`}):s>5&&t.push({severity:"warning",category:"benchmarks",message:`AC ${m} is very high (+${s}) for CR ${e.cr} (Benchmark: ${a.ac}).`})}const f=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const s of f)s.val!==void 0&&typeof s.val=="number"&&s.val<a.poorSave-2&&t.push({severity:"warning",category:"benchmarks",message:`${s.name} Save +${s.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${a.poorSave}).`});return{valid:!t.some(s=>s.severity==="error"),messages:t,status:t.length>0?"WARN":"PASS"}}const z=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,V=()=>{const[e,t]=T.useState(z),[i,a]=T.useState(()=>b(W(z))),[o,m]=T.useState([]),f=s=>{const p=s.currentTarget.value;t(p);try{const r=W(p),h=b(r);a(h);const y=U(r),_=K(r);m([y,_])}catch(r){console.error("Parse error:",r)}},d=s=>{switch(s){case"error":return"#dc2626";case"warning":return"#ea580c";case"info":return"#2563eb"}};return c.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",fontFamily:"system-ui, sans-serif",height:"100vh",boxSizing:"border-box"}},c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"ðŸ“ Raw Stat Block"),c.createElement("textarea",{value:e,onChange:f,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",lineHeight:1.5},spellCheck:!1})),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",overflow:"auto"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âš–ï¸ Validation Results"),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},o.map((s,p)=>c.createElement("div",{key:p,style:{border:"1px solid #d1d5db",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f9fafb"}},c.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem"}},s.messages[0]?.category||"Validation"),s.messages.length===0?c.createElement("div",{style:{color:"#059669",fontWeight:500}},"âœ“ PASS"):c.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},s.messages.map((r,h)=>c.createElement("li",{key:h,style:{color:d(r.severity),marginBottom:"0.25rem",fontSize:"0.875rem"}},c.createElement("strong",null,r.severity.toUpperCase(),":")," ",r.message,r.expected!==void 0&&c.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:"#6b7280"}},"Expected: ",JSON.stringify(r.expected)," | Actual: ",JSON.stringify(r.actual))))))))),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âœ¨ Auto-Fixed Version"),c.createElement("textarea",{value:j(i),readOnly:!0,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #10b981",borderRadius:"0.375rem",resize:"none",backgroundColor:"#f0fdf4",lineHeight:1.5},spellCheck:!1})))};V.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ee={title:"Validators/Rules Lawyer Workbench",component:V,parameters:{layout:"fullscreen"}},A={};A.parameters={...A.parameters,docs:{...A.parameters?.docs,source:{originalSource:"{}",...A.parameters?.docs?.source}}};const te=["InteractiveWorkbench"];export{A as InteractiveWorkbench,te as __namedExportsOrder,ee as default};
