import{C as D,a as L,M as R,S as b,X as N,W as $,T as E}from"./pf1e-data-tables-BqrvN3By.js";function B(e){const a=[],i=[];e.melee_line&&i.push(e.melee_line),e.ranged_line&&i.push(e.ranged_line),e.special_abilities_block&&i.push(e.special_abilities_block),e.spells_block&&i.push(e.spells_block),e.skills_line&&i.push(e.skills_line),e.feats&&e.feats.length&&i.push(e.feats.join(", ")),e.speed_line&&i.push(e.speed_line),e.raw_text&&i.push(e.raw_text);const s=i.join(`
`).toLowerCase(),t=(m,o,l,r,c)=>{a.push({severity:m,category:o,message:l,expected:r,actual:c})};return s.includes("bonus action")&&t("critical","system-bleed",'Found "Bonus Action" terminology. Pathfinder 1e uses "Swift Action" instead.',"Swift Action","Bonus Action"),s.includes("reaction")&&t("critical","system-bleed",'Found "Reaction" terminology. Pathfinder 1e uses "Immediate Action" or Attack of Opportunity semantics.',"Immediate Action / AoO","Reaction"),s.match(/\b\baction\b\b/)&&!s.includes("standard action")&&s.includes(" action")&&t("warning","system-bleed",'Found ambiguous "Action" wording; prefer "Standard Action" in PF1e stat blocks.',"Standard Action","Action"),s.includes("deception")&&t("warning","system-bleed",'Found 5e skill "Deception"; PF1e uses "Bluff".',"Bluff","Deception"),s.includes("persuasion")&&t("warning","system-bleed",'Found 5e skill "Persuasion"; PF1e uses "Diplomacy" or "Intimidate" depending on context.',"Diplomacy/Intimidate","Persuasion"),s.includes("insight")&&t("warning","system-bleed",'Found 5e skill "Insight"; PF1e uses "Sense Motive".',"Sense Motive","Insight"),s.includes("athletics")&&t("warning","system-bleed",'Found 5e skill "Athletics"; PF1e splits these across "Climb" and "Swim" or others.',"Climb/Swim","Athletics"),s.includes("acrobatics")&&t("warning","system-bleed",'Found "Acrobatics"—ensure usage is PF1e-conformant (Jump/Tumble context).',"Jump/Tumble","Acrobatics"),(s.includes("wisdom save")||s.includes("wisdom saving throw"))&&t("critical","system-bleed",'Found "Wisdom Save" wording. PF1e uses "Will" saves.',"Will Save","Wisdom Save"),(s.includes("dexterity save")||s.includes("dexterity saving throw"))&&t("critical","system-bleed",'Found "Dexterity Save" wording. PF1e uses "Reflex" saves.',"Reflex Save","Dexterity Save"),(s.includes("constitution save")||s.includes("constitution saving throw"))&&t("critical","system-bleed",'Found "Constitution Save" wording. PF1e uses "Fortitude" saves.',"Fortitude Save","Constitution Save"),(s.includes("advantage")||s.includes("disadvantage"))&&t("critical","system-bleed",'Found "Advantage/Disadvantage" mechanics text which is D&D 5e specific; translate to static bonuses/penalties for PF1e.',"Bonus/Penalty","Advantage/Disadvantage"),s.includes("short rest")&&t("critical","system-bleed",'Found "Short Rest"—PF1e does not use the 5e short/long rest nomenclature.',"N/A","Short Rest"),(s.includes("reflex dc")||/reflex\s*dc\s*\d+/i.test(s))&&t("critical","system-bleed",'Found a "Reflex DC" style mechanic (e.g., "Grapple Reflex DC 13"). Grapples normally use CMB/CMD in PF1e; this is nonstandard.',"Use CMB/CMD or special ability text","Reflex DC Grapple"),a}function U(e){const a=[];let i=!1,s=e.racialHD||0,t=0;if(e.racialHD&&e.racialHD>0){const n=D[e.type];n?n.babProgression==="fast"?t+=e.racialHD:n.babProgression==="medium"?t+=Math.floor(e.racialHD*.75):t+=Math.floor(e.racialHD*.5):t+=Math.floor(e.racialHD*.75)}for(const n of e.classLevels||[]){const d=L[n.className];d&&(s+=n.level,d.babProgression==="fast"?t+=n.level:d.babProgression==="medium"?t+=Math.floor(n.level*.75):t+=Math.floor(n.level*.5))}const m=(e.cr||"").toString(),o=R.find(n=>n.cr===m);if(o){const n=Math.max(1,Math.round((o.hp||1)/4.5)),d=n*2;s>d&&s>=3&&(i=!0,a.push({category:"structure",severity:"critical",message:`HD/CR Mismatch: ${s} Hit Dice is inappropriate for CR ${e.cr}. This HD count suggests a much higher CR than declared and is a structural contradiction.`,expected:`${n} HD (max ${d})`,actual:`${s} HD`}))}const l=b[e.size]||{cmbCmdMod:0},r=Math.floor(((e.str||10)-10)/2),c=Math.floor(((e.dex||10)-10)/2);let x="MATCH";e.bab_claimed!==void 0&&e.bab_claimed!==t&&(x="MISMATCH",i=!0,a.push({category:"basics",severity:"critical",message:`Base Attack Bonus (BAB) +${e.bab_claimed} is illegal for ${s} HD. It must be +${t} according to ${e.type} progression.`,expected:t,actual:e.bab_claimed}));const p=10+t+r+c+l.cmbCmdMod,M=10+(e.bab_claimed||0)+r+c+l.cmbCmdMod;e.cmd_claimed&&(e.cmd_claimed===p||(e.cmd_claimed===M&&x==="MISMATCH"?a.push({category:"basics",severity:"warning",message:`CMD ${e.cmd_claimed} matches the source's (incorrect) BAB of +${e.bab_claimed}. If BAB were corrected to +${t}, CMD would be ${p}.`,expected:p,actual:e.cmd_claimed}):(i=!0,a.push({category:"basics",severity:"critical",message:`Calculated CMD is ${p} (10 + Legal BAB ${t} + Str ${r} + Dex ${c} + Size ${l.cmbCmdMod}), but stat block claims ${e.cmd_claimed}.`,expected:p,actual:e.cmd_claimed}))));const h=Math.ceil(s/2),v=e.feats?.length||0;v<h&&a.push({category:"basics",severity:"warning",message:`Creature has ${s} HD and should have at least ${h} feats, but only lists ${v}.`,expected:h,actual:v});const y=N[e.cr];y&&e.xp!==y&&(i=!0,a.push({category:"basics",severity:"critical",message:`XP ${e.xp} does not match canonical value ${y} for CR ${e.cr}. (Source: Core Rulebook Experience Point Awards table)`,expected:y,actual:e.xp}));const f=D[e.type];f&&typeof f.hitDieType=="number"&&f.hitDieType<6&&a.push({category:"basics",severity:"warning",message:`Nonstandard Hit Die: ${e.type} is mapped to d${f.hitDieType} HD which is below the conventional minimum of d6 for monster racial HD. d4 is usually reserved for damage dice, not racial HD.`,expected:"d6+",actual:`d${f.hitDieType}`});const u={Tiny:{str:3,dex:16,con:10},Small:{str:8,dex:14,con:10},Medium:{str:10,dex:10,con:10},Large:{str:18,dex:8,con:14},Huge:{str:26,dex:6,con:18},Gargantuan:{str:34,dex:6,con:22},Colossal:{str:42,dex:6,con:26}}[e.size];if(u){const d=Math.abs((e.str||10)-u.str),F=Math.abs((e.dex||10)-u.dex),_=Math.abs((e.con||10)-u.con);d>4&&a.push({category:"basics",severity:"warning",message:`STR ${e.str} deviates significantly from ${e.size} baseline of ${u.str}. Physical scores should be "relatively close" to size-appropriate values.`,expected:`~${u.str}`,actual:e.str}),F>4&&a.push({category:"basics",severity:"warning",message:`DEX ${e.dex} deviates significantly from ${e.size} baseline of ${u.dex}. Physical scores should be "relatively close" to size-appropriate values.`,expected:`~${u.dex}`,actual:e.dex}),_>4&&a.push({category:"basics",severity:"note",message:`CON ${e.con} deviates from ${e.size} baseline of ${u.con}. High CON is OK for durability; verify intentional.`,expected:`~${u.con}`,actual:e.con})}const g=e.template,C={Skeleton:["Undead"],Zombie:["Undead"],Lich:["Undead"],Ghost:["Undead"]};if(g&&C[g]){const n=C[g];n.includes(e.type)&&a.push({category:"basics",severity:"warning",message:`Template "${g}" is typically applied to non-Undead creatures. Applying to ${e.type} (Undead type) may be redundant or contradictory.`,expected:`Non-${n[0]} creature type`,actual:e.type})}const S=(e.str||10)===10&&(e.dex||10)===10&&(e.con||10)===10,w=(e.int||10)===10&&(e.wis||10)===10&&(e.cha||10)===10,P=(e.racialHD||1)===1,H=(e.ac_claimed||10)<=10,T=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);S&&w&&P&&H&&(T||1)<=.33&&a.push({category:"basics",severity:"note",message:"Creature has minimum baseline stats (all 10s, 1 HD, AC ≤10, CR ≤1/3). This is appropriate for minions, commoners, or lowest-tier threats.",expected:"Varies",actual:"All baselines"});try{const n=B(e);if(n&&n.length)for(const d of n)a.push(d),d.severity==="critical"&&(i=!0)}catch(n){a.push({category:"system-bleed",severity:"note",message:`System-bleed detection failed: ${n?.message||n}`})}return{valid:!i,status:i?"FAIL":a.length>0?"WARN":"PASS",messages:a}}function G(e){const a=[];if(e.gearValue===void 0)return{valid:!0,messages:[{severity:"note",category:"economy",message:"No gear value provided; skipping economy validation."}]};const i=I(e),s=z(e,i);if(s===null)return a.push({severity:"warning",category:"economy",message:`Unable to determine expected wealth for ${i} tier.`}),{valid:!0,messages:a};const t=e.gearValue,o=(t-s)/s*100,l=15;Math.abs(o)<=l?a.push({severity:"note",category:"economy",message:`Wealth is on target for ${i} (${t} gp vs expected ${s} gp).`,expected:s,actual:t}):o>l?a.push({severity:"warning",category:"economy",message:`Over-geared: ${i} has ${t} gp, expected ~${s} gp (+${o.toFixed(1)}%).`,expected:s,actual:t}):a.push({severity:"warning",category:"economy",message:`Under-geared: ${i} has ${t} gp, expected ~${s} gp (${o.toFixed(1)}%).`,expected:s,actual:t});let r="PASS";return a.some(c=>c.severity==="critical")?r="FAIL":a.some(c=>c.severity==="warning")&&(r="WARN"),{valid:Math.abs(o)<=l,messages:a,status:r}}function I(e){if(e.economicTier)return e.economicTier;const a=e.racialHD||0,i=e.classLevels||[],s=["Warrior","Expert","Commoner","Adept","Aristocrat"],m=i.filter(r=>!s.includes(r.className)).reduce((r,c)=>r+c.level,0),l=i.filter(r=>s.includes(r.className)).reduce((r,c)=>r+c.level,0);return m>=a&&m>0?"Heroic NPC":l>0?"Basic NPC":"Monster"}function z(e,a){if(a==="Heroic NPC"){const i=A(e);return i<1||i>20?null:$.heroicNpc[i]||null}if(a==="Basic NPC"){const i=A(e);return i<1||i>20?null:$.basicNpc[i]||null}if(a==="Monster"){const i=e.cr,s=E[i];if(!s)return null;let t=s.medium;return e.treasureType==="Double"?t*=2:e.treasureType==="Triple"?t*=3:e.treasureType==="Incidental"?t*=.5:e.treasureType==="None"&&(t=0),t}return null}function A(e){if(e.claimedEffectiveLevel!==void 0)return e.claimedEffectiveLevel;const a=e.racialHD||0,s=(e.classLevels||[]).reduce((t,m)=>t+m.level,0);return a+s}export{G as a,U as v};
