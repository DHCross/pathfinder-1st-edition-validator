import{M as y,C as w,a as V,S as E,X as L}from"./pf1e-data-tables-BqrvN3By.js";function O(c,n="enforce_cr"){const e=JSON.parse(JSON.stringify(c)),o=[],r=(a,s,d,f)=>{s!=d&&o.push({feature:a,oldValue:s,newValue:d,reason:f})};if(n==="enforce_cr"){const a=y.find(s=>s.cr===e.cr);if(a){const d=(w[e.type]||{hitDieType:8}).hitDieType/2+.5,f=Math.floor(((e.con||10)-10)/2),I=Math.max(1,d+f),W=e.hp_claimed||e.hp;if(W>a.hp*1.5){const R=Math.max(1,Math.round(a.hp/I));if((e.classLevels||[]).length===0){const X=e.racialHD;e.racialHD=R;const b=Math.floor(e.racialHD*d)+e.racialHD*f;e.hp=b,e.hp_claimed=b,r("Hit Dice",X,R,`Reduced to match CR ${e.cr} Benchmark`),r("Hit Points",W,b,`Recalculated for ${R} HD`)}}}}let t=0;if(e.racialHD&&e.racialHD>0){const a=w[e.type];let s="medium";a&&(s=a.babProgression),s==="fast"?t+=e.racialHD:s==="medium"?t+=Math.floor(e.racialHD*.75):t+=Math.floor(e.racialHD*.5)}for(const a of e.classLevels||[]){const s=V[a.className];s&&(s.babProgression==="fast"?t+=a.level:s.babProgression==="medium"?t+=Math.floor(a.level*.75):t+=Math.floor(a.level*.5))}(e.racialHD||0)===0&&(e.classLevels||[]).length===0&&(t=e.bab_claimed??e.bab??0);const p=e.bab_claimed??e.bab;t!==p&&(r("Base Attack Bonus",p,t,`Fixed based on ${e.racialHD||0} HD (${e.type}) + Class Levels`),e.bab=t,e.bab_claimed=t);const m=E[e.size]||{acAttackMod:0,cmbCmdMod:0},i=Math.floor(((e.str??10)-10)/2),M=Math.floor(((e.dex??10)-10)/2),v=10+t+i+M+(m.cmbCmdMod||0),P=e.cmd_claimed??e.cmd;v!==P&&(r("CMD",P,v,`Recalculated: 10 + BAB(${t}) + Str(${i}) + Dex(${M}) + Size(${m.cmbCmdMod})`),e.cmd=v,e.cmd_claimed=v);const $=t+i+(m.cmbCmdMod||0),B=e.cmb;$!==B&&(r("CMB",B,$,`Recalculated: BAB(${t}) + Str(${i}) + Size(${m.cmbCmdMod})`),e.cmb=$);const h=(e.racialHD??0)+(e.classLevels||[]).reduce((a,s)=>a+(s.level||0),0),C=Math.floor(2+h/2),x=Math.floor(h/3),D=w[e.type]||{goodSaves:[]},u=(D.goodSaves?.includes("Fort")?C:x)+Math.floor(((e.con??10)-10)/2),g=(D.goodSaves?.includes("Ref")?C:x)+Math.floor(((e.dex??10)-10)/2),S=(D.goodSaves?.includes("Will")?C:x)+Math.floor(((e.wis??10)-10)/2),A=e.fort_save_claimed??e.fort;u!==A&&(r("Fort Save",A,u,`Recalculated for ${h} HD and con ${e.con}`),e.fort=u,e.fort_save_claimed=u);const F=e.ref_save_claimed??e.ref;g!==F&&(r("Ref Save",F,g,`Recalculated for ${h} HD and dex ${e.dex}`),e.ref=g,e.ref_save_claimed=g);const z=e.will_save_claimed??e.will;S!==z&&(r("Will Save",z,S,`Recalculated for ${h} HD and wis ${e.wis}`),e.will=S,e.will_save_claimed=S);const _=Math.floor(((e.dex??10)-10)/2),N=e.init_claimed??void 0;if(_!==N&&(r("Init",N,_,`Set to Dex modifier ${_}`),e.init_claimed=_),n==="fix_math"){const a=e.hp_claimed||e.hp;if(a>0){const s=y.find(d=>d.cr===e.cr);if(s&&a>s.hp*1.5){const d=y.find(f=>a>=f.hp*.85&&a<=f.hp*1.25);d&&(r("Challenge Rating",e.cr,d.cr,`Upgraded to match HP (${a})`),e.cr=d.cr,e.cr_text=d.cr)}}}let l=e.cr_text||e.cr.toString();if(l==="0.5"&&(l="1/2"),(l==="0.33"||l==="0.333")&&(l="1/3"),l==="0.25"&&(l="1/4"),(l==="0.16"||l==="0.166"||l==="0.167")&&(l="1/6"),l==="0.125"&&(l="1/8"),L[l]){const a=L[l];e.xp!==a&&(r("XP Award",e.xp,a,`Standardized for CR ${l}`),e.xp=a)}const H=e.ac_claimed||e.ac,T=10+M+m.acAttackMod;return H>T?e.ac=H:e.ac=Math.max(H,T),{block:e,fixes:o}}function K(c){const n=[],e=typeof c.cr=="number"?c.cr:parseInt(String(c.cr),10);if(isNaN(e))return{valid:!0,messages:n,status:"PASS"};const o=y.find(i=>i.cr===String(c.cr)||i.cr===c.cr_text);if(!o)return{valid:!0,messages:n,status:"PASS"};const r=c.hp_claimed??c.hp??void 0;if(r!==void 0&&typeof r=="number"){const i=r/o.hp;i<.7?n.push({severity:"warning",category:"benchmarks",message:`HP ${r} is very low for CR ${c.cr}. Standard is ~${o.hp}. Creature may be too fragile.`,expected:o.hp,actual:r}):i>1.5&&n.push({severity:"warning",category:"benchmarks",message:`HP ${r} is very high for CR ${c.cr}. Standard is ~${o.hp}. This is a "Damage Sponge."`,expected:o.hp,actual:r})}const t=c.ac_claimed??c.ac??void 0;if(t!==void 0&&typeof t=="number"){const i=t-o.ac;i<-4?n.push({severity:"warning",category:"benchmarks",message:`AC ${t} is very low for CR ${c.cr}. Standard is ~${o.ac}. Creature will be crit often.`,expected:o.ac,actual:t}):i>4&&n.push({severity:"warning",category:"benchmarks",message:`AC ${t} is very high for CR ${c.cr}. Standard is ~${o.ac}. Players may struggle to hit.`,expected:o.ac,actual:t})}const p=[{name:"Fort",val:c.fort_save_claimed},{name:"Ref",val:c.ref_save_claimed},{name:"Will",val:c.will_save_claimed}];for(const i of p)i.val!==void 0&&typeof i.val=="number"&&i.val<o.poorSave-2&&n.push({severity:"warning",category:"benchmarks",message:`${i.name} Save +${i.val} is very low for CR ${c.cr}. Standard is ~+${o.poorSave}. It will fail often.`,expected:o.poorSave,actual:i.val});return{valid:!n.some(i=>i.severity==="critical"),messages:n,status:n.length>0?"WARN":"PASS"}}export{O as a,K as v};
