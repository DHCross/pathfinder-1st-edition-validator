import{r as M,R as r}from"./iframe-DliMOVAR.js";import{s as X,f as z}from"./pf1e-formatter-BViDTO6Q.js";import{M as L,C as V,a as U,S as J,X as H}from"./pf1e-data-tables-BqrvN3By.js";import{v as G,a as q,V as K}from"./validateEconomy-B_7-Ymca.js";import"./preload-helper-PPVm8Dsz.js";function Q(i){return i.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function j(i){const a=Q(i),e={name:a.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},d=a.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);d&&(e.melee_line="Melee "+d[1].trim());const n=a.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);n&&(e.ranged_line="Ranged "+n[1].trim());const l=a.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);l&&(e.speed_line="Speed "+l[1].trim());const v=a.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);v&&(e.special_attacks_line="Special Attacks "+v[1].trim());const c=a.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);c&&(e.spells_block=c[0].trim());const C=a.match(/SPECIAL ABILITIES(.+)$/s);C&&(e.special_abilities_block=`SPECIAL ABILITIES
`+C[1].trim());const _=a.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);_&&(e.skills_line="Skills "+_[1].trim());const E=a.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);E&&(e.languages_line="Languages "+E[1].trim());const m=a.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);m&&(e.equipment_line="Equipment "+m[1].trim());const y=a.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);y&&(e.cr=y[1]);const o=a.match(/XP\s*([0-9,]+)/i);o&&(e.xp=parseInt(o[1].replace(/,/g,"")));const s=a.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(s){e.alignment=s[1],e.size=s[2];const p=s[3].trim();e.subtypes=p.split(/,\s*/).map(I=>I.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?e.type="Outsider":/Dragon/i.test(p)?e.type="Dragon":/Undead/i.test(p)?e.type="Undead":/Beast/i.test(p)?e.type="Magical Beast":e.type=p.split(" ")[0]}const f=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let u;for(;(u=f.exec(a))!==null;)e.classLevels?.push({className:u[1],level:parseInt(u[2])});const h=a.match(/AC\s*(\d+)/i);h&&(e.ac_claimed=parseInt(h[1]));const D=a.match(/touch\s*(\d+)/i);D&&(e.touch_ac_claimed=parseInt(D[1]));const N=a.match(/flat-?footed\s*(\d+)/i);N&&(e.flat_footed_ac_claimed=parseInt(N[1]));const S=a.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(S&&(e.hp_claimed=parseInt(S[1]),e.hp=parseInt(S[1]),S[2])){const p=/(\d+)d/.exec(S[2]);p&&(e.racialHD=parseInt(p[1]))}const x=e.classLevels?.reduce((p,I)=>p+I.level,0)||0;e.racialHD===x&&x>0&&(e.racialHD=0);const g=a.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);g&&(e.fort_save_claimed=parseInt(g[1]),e.ref_save_claimed=parseInt(g[2]),e.will_save_claimed=parseInt(g[3]));const k=a.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);k&&(e.bab_claimed=parseInt(k[1]));const R=a.match(/CMD\s*(\d+)/i);R&&(e.cmd_claimed=parseInt(R[1]));const A=(p,I)=>{const T=new RegExp(`${I}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),$=p.match(T);if(!$)return 10;const W=$[1];return/\d/.test(W)?parseInt(W):0};e.str=A(a,"Str"),e.dex=A(a,"Dex"),e.con=A(a,"Con"),e.int=A(a,"Int"),e.wis=A(a,"Wis"),e.cha=A(a,"Cha"),e.ac_claimed&&(e.ac=e.ac_claimed),e.touch_ac_claimed&&(e.touch=e.touch_ac_claimed),e.flat_footed_ac_claimed&&(e.flatFooted=e.flat_footed_ac_claimed);const w=a.match(/Init\s*([+-]?\d+)/i);w&&(e.init_claimed=parseInt(w[1]));const B=a.match(/Perception\s*([+-]?\d+)/i);B&&(e.perception_claimed=parseInt(B[1]));const P=a.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);P&&(e.feats=P[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const b=a.match(/Treasure\s+(.+?)(?:$|\n)/i);if(b){const p=b[1].toLowerCase();p.includes("npc gear")?e.treasureType="NPC Gear":(p.includes("standard"),e.treasureType="Standard")}return e}function Z(i,a="enforce_cr"){const t=JSON.parse(JSON.stringify(i)),e=[],d=(s,f,u,h)=>{f!=u&&e.push({feature:s,oldValue:f,newValue:u,reason:h})};if(a==="enforce_cr"){const s=L.find(f=>f.cr===t.cr);if(s){const u=(V[t.type]||{hitDieType:8}).hitDieType/2+.5,h=Math.floor(((t.con||10)-10)/2),D=Math.max(1,u+h),N=t.hp_claimed||t.hp;if(N>s.hp*1.5){const S=Math.max(1,Math.round(s.hp/D));if((t.classLevels||[]).length===0){const x=t.racialHD;t.racialHD=S;const g=Math.floor(t.racialHD*u)+t.racialHD*h;t.hp=g,t.hp_claimed=g,d("Hit Dice",x,S,`Reduced to match CR ${t.cr} Benchmark`),d("Hit Points",N,g,`Recalculated for ${S} HD`)}}}}let n=0;if(t.racialHD&&t.racialHD>0){const s=V[t.type];let f="medium";s&&(f=s.babProgression),f==="fast"?n+=t.racialHD:f==="medium"?n+=Math.floor(t.racialHD*.75):n+=Math.floor(t.racialHD*.5)}for(const s of t.classLevels||[]){const f=U[s.className];f&&(f.babProgression==="fast"?n+=s.level:f.babProgression==="medium"?n+=Math.floor(s.level*.75):n+=Math.floor(s.level*.5))}(t.racialHD||0)===0&&(t.classLevels||[]).length===0&&(n=t.bab_claimed??t.bab??0);const l=t.bab_claimed??t.bab;n!==l&&(d("Base Attack Bonus",l,n,`Fixed based on ${t.racialHD||0} HD (${t.type}) + Class Levels`),t.bab=n,t.bab_claimed=n);const v=J[t.size]||{acAttackMod:0,cmbCmdMod:0},c=Math.floor(((t.str??10)-10)/2),C=Math.floor(((t.dex??10)-10)/2),_=10+n+c+C+(v.cmbCmdMod||0),E=t.cmd_claimed??t.cmd;if(_!==E&&(d("CMD",E,_,`Recalculated: 10 + BAB(${n}) + Str(${c}) + Dex(${C}) + Size(${v.cmbCmdMod})`),t.cmd=_,t.cmd_claimed=_),a==="fix_math"){const s=t.hp_claimed||t.hp;if(s>0){const f=L.find(u=>u.cr===t.cr);if(f&&s>f.hp*1.5){const u=L.find(h=>s>=h.hp*.85&&s<=h.hp*1.25);u&&(d("Challenge Rating",t.cr,u.cr,`Upgraded to match HP (${s})`),t.cr=u.cr,t.cr_text=u.cr)}}}let m=t.cr_text||t.cr.toString();if(m==="0.5"&&(m="1/2"),(m==="0.33"||m==="0.333")&&(m="1/3"),m==="0.25"&&(m="1/4"),(m==="0.16"||m==="0.166"||m==="0.167")&&(m="1/6"),m==="0.125"&&(m="1/8"),H[m]){const s=H[m];t.xp!==s&&(d("XP Award",t.xp,s,`Standardized for CR ${m}`),t.xp=s)}const y=t.ac_claimed||t.ac,o=10+C+v.acAttackMod;return y>o?t.ac=y:t.ac=Math.max(y,o),{block:t,fixes:e}}function Y(i){const a=[],t=typeof i.cr=="number"?i.cr:parseInt(String(i.cr),10);if(isNaN(t))return{valid:!0,messages:a,status:"PASS"};const e=L.find(c=>c.cr===String(i.cr)||c.cr===i.cr_text);if(!e)return{valid:!0,messages:a,status:"PASS"};const d=i.hp_claimed??i.hp??void 0;if(d!==void 0&&typeof d=="number"){const c=d/e.hp;c<.7?a.push({severity:"warning",category:"benchmarks",message:`HP ${d} is very low for CR ${i.cr}. Standard is ~${e.hp}. Creature may be too fragile.`,expected:e.hp,actual:d}):c>1.5&&a.push({severity:"warning",category:"benchmarks",message:`HP ${d} is very high for CR ${i.cr}. Standard is ~${e.hp}. This is a "Damage Sponge."`,expected:e.hp,actual:d})}const n=i.ac_claimed??i.ac??void 0;if(n!==void 0&&typeof n=="number"){const c=n-e.ac;c<-4?a.push({severity:"warning",category:"benchmarks",message:`AC ${n} is very low for CR ${i.cr}. Standard is ~${e.ac}. Creature will be crit often.`,expected:e.ac,actual:n}):c>4&&a.push({severity:"warning",category:"benchmarks",message:`AC ${n} is very high for CR ${i.cr}. Standard is ~${e.ac}. Players may struggle to hit.`,expected:e.ac,actual:n})}const l=[{name:"Fort",val:i.fort_save_claimed},{name:"Ref",val:i.ref_save_claimed},{name:"Will",val:i.will_save_claimed}];for(const c of l)c.val!==void 0&&typeof c.val=="number"&&c.val<e.poorSave-2&&a.push({severity:"warning",category:"benchmarks",message:`${c.name} Save +${c.val} is very low for CR ${i.cr}. Standard is ~+${e.poorSave}. It will fail often.`,expected:e.poorSave,actual:c.val});return{valid:!a.some(c=>c.severity==="critical"),messages:a,status:a.length>0?"WARN":"PASS"}}const ee=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,O=()=>{const[i,a]=M.useState(ee),[t,e]=M.useState(null),[d,n]=M.useState(1),[l,v]=M.useState("enforce_cr"),[c,C]=M.useState(null),[_,E]=M.useState([]),[m,y]=M.useState(null);return M.useEffect(()=>{if(!i.trim()){e(null),C(null),y(null),E([]);return}try{const o=j(i);e(o);const s=parseInt(o.cr)||1;n(s)}catch(o){console.error(o)}},[i]),M.useEffect(()=>{if(!t)return;let o=JSON.parse(JSON.stringify(t));const s=[],f=t.cr,u=d.toString();if(f!==u){const b=H[u];if(b){const{block:p,changes:I}=X(o,b);o=p,I.forEach(T=>s.push({feature:"Creature Scaler",oldValue:f,newValue:u,reason:T}))}}const{block:h,fixes:D}=Z(o,l);C(h),E([...s,...D]);const S=G(t).messages.filter(b=>b.category==="structure"),x=l==="enforce_cr"?h:t;let g={status:"PASS",messages:[]},k={status:"PASS",messages:[]},R={status:"PASS",messages:[]};x&&(g=G(x),k=Y(x),R=q(x));const A=[...S,...g.messages,...k.messages,...R.messages],w=S.some(b=>b.severity==="critical"),B=g.status==="FAIL"||R.status==="FAIL",P={valid:!w&&!B,status:w||B?"FAIL":g.status==="WARN"||R.status==="WARN"||k.status==="WARN"?"WARN":"PASS",messages:A};y(P)},[t,d,l]),r.createElement("div",{className:"validator-playground"},r.createElement("div",{className:"validator-column"},r.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),r.createElement("textarea",{className:"validator-textarea",value:i,onChange:o=>a(o.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"validator-scroll-area"},r.createElement("div",null,r.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v3.0)"),r.createElement("div",{style:{fontSize:"0.85rem",color:"#6b7280",marginBottom:"0.5rem"}},"Validating: ",l==="enforce_cr"?"Auto-Fixed Version (Design Mode)":"Raw Input (Audit Mode)"),t&&m?r.createElement(K,{statBlock:l==="enforce_cr"?c:t,validation:m,validationTarget:l==="enforce_cr"?"fixed":"raw"}):null),_.length>0&&r.createElement("div",{className:"fix-report"},r.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",l==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"fix-list"},_.map((o,s)=>r.createElement("li",{key:s,className:"fix-item"},r.createElement("div",{style:{fontWeight:600}},o.feature),r.createElement("div",{className:"fix-change-row"},r.createElement("span",{className:"fix-old"},o.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"fix-new"},o.newValue)),r.createElement("div",{className:"fix-reason"},o.reason)))))),r.createElement("div",{className:"validator-column"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},r.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),r.createElement("div",{className:"mode-toggle",style:{display:"flex",alignItems:"center",gap:"1rem"}},r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"}},r.createElement("label",{htmlFor:"cr-slider",style:{fontSize:"0.75rem",fontWeight:"bold",color:"#4b5563"}},"Target CR: ",d),r.createElement("input",{id:"cr-slider",type:"range",min:"1",max:"20",value:d,onChange:o=>n(parseInt(o.target.value)),style:{width:"100px"}})),r.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},r.createElement("button",{onClick:()=>v("enforce_cr"),style:{backgroundColor:l==="enforce_cr"?"white":"transparent",color:l==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:l==="enforce_cr"?"bold":"normal",boxShadow:l==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep CR, Downgrade Stats"},"Design Mode (Enforce CR)"),r.createElement("button",{onClick:()=>v("fix_math"),style:{backgroundColor:l==="fix_math"?"white":"transparent",color:l==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:l==="fix_math"?"bold":"normal",boxShadow:l==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep Stats, Update CR"},"Audit Mode (Fix Math)")))),r.createElement("div",{className:"output-area"},c?r.createElement("pre",{className:"output-pre"},z(c)):r.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),r.createElement("button",{onClick:()=>c&&navigator.clipboard.writeText(z(c)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};O.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ie={title:"Validators/Rules Lawyer Workbench",component:O,parameters:{layout:"fullscreen"}},F={};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:"{}",...F.parameters?.docs?.source}}};const ne=["InteractiveWorkbench"];export{F as InteractiveWorkbench,ne as __namedExportsOrder,ie as default};
