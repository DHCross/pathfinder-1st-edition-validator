import{r as $,R as c}from"./iframe-BvNyzkca.js";import{C as X,S as J,X as W,M as U,v as j}from"./validateBasics-DEY3oNcw.js";import"./preload-helper-PPVm8Dsz.js";function H(e){const t={name:e.split(`
`).map(m=>m.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"humanoid"},r=/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i,l=/XP\s*([0-9,]+)/i,d=/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s]+)/i,f=/AC\s*(\d+)/i,p=/touch\s*(\d+)/i,a=/flat-footed\s*(\d+)/i,o=/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/i,n=/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i,h=/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i,u=/CMD\s*(\d+)/i,g=/Feats[:\s]+(.+?)(?:;|$|Skills|Languages|SQ|Ecology)/i,G=/Treasure\s+(.+?)(?:$|\n)/i;let i=e.replace(/\n/g," ");const M=i.match(r);M&&(t.cr=M[1]);const I=i.match(l);I&&(t.xp=parseInt(I[1].replace(/,/g,"")));const S=i.match(d);S&&(t.size=S[2],t.type=S[3].trim());const R=i.match(f);R&&(t.ac_claimed=parseInt(R[1]));const E=i.match(p);E&&(t.touch_ac_claimed=parseInt(E[1]));const B=i.match(a);B&&(t.flat_footed_ac_claimed=parseInt(B[1]));const v=i.match(o);if(v){t.hp_claimed=parseInt(v[1]),t.hp=parseInt(v[1]);const m=v[2];if(m){const z=/(\d+)d/.exec(m);z&&(t.racialHD=parseInt(z[1]))}}const y=i.match(n);y&&(t.fort_save_claimed=parseInt(y[1]),t.fort=parseInt(y[1]),t.ref_save_claimed=parseInt(y[2]),t.ref=parseInt(y[2]),t.will_save_claimed=parseInt(y[3]),t.will=parseInt(y[3]));const _=i.match(h);_&&(t.bab_claimed=parseInt(_[1]),t.bab=parseInt(_[1]));const C=i.match(u);C&&(t.cmd_claimed=parseInt(C[1]),t.cmd=parseInt(C[1]));const F=/Str\s*(\d+)/i.exec(i),w=/Dex\s*(\d+)/i.exec(i),T=/Con\s*(\d+)/i.exec(i),P=/Int\s*(\d+)/i.exec(i),b=/Wis\s*(\d+)/i.exec(i),A=/Cha\s*(\d+)/i.exec(i);F&&(t.str=parseInt(F[1])),w&&(t.dex=parseInt(w[1])),T&&(t.con=parseInt(T[1])),P&&(t.int=parseInt(P[1])),b&&(t.wis=parseInt(b[1])),A&&(t.cha=parseInt(A[1])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const N=i.match(g);N&&(t.feats=N[1].split(/[,;]+/).map(m=>m.trim()).filter(Boolean));const D=i.match(G);if(D){const m=D[1].toLowerCase();m.includes("npc gear")?t.treasureType="NPC Gear":m.includes("standard")?t.treasureType="Standard":m.includes("double")?t.treasureType="Double":m.includes("triple")?t.treasureType="Triple":m.includes("incidental")?t.treasureType="Incidental":m.includes("none")&&(t.treasureType="None")}return t}function K(e){const{name:s,cr:t,xp:r,size:l,type:d}=e,f=e.alignment||"N",p=t,a=u=>Math.floor((u-10)/2),o=u=>{const g=a(u);return g>=0?`+${g}`:`${g}`},h=`${e.racialHD||1}d8+${a(e.con)}`;return`
${s}
CR ${p}
XP ${r?.toLocaleString()||"0"}
${f} ${l} ${d}
Init ${o(e.dex)}; Senses Perception +0
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||e.touch||10}, flat-footed ${e.flat_footed_ac_claimed||e.flatFooted||10}
hp ${e.hp_claimed||e.hp} (${h})
Fort +${e.fort_save_claimed||e.fort}, Ref +${e.ref_save_claimed||e.ref}, Will +${e.will_save_claimed||e.will}
OFFENSE
Speed 30 ft.
Melee weapon +${e.bab_claimed||e.bab} (1d8)
STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||e.bab}; CMB +${(e.bab_claimed||e.bab)+a(e.str)}; CMD ${e.cmd_claimed||e.cmd||10}
Feats ${e.feats?.join(", ")||"None"}
Treasure ${e.treasureType||"Standard"}
`.trim()}function L(e){const s=JSON.parse(JSON.stringify(e));let t=s.racialHD||0,r=0;const l=s.classLevels||[];for(const o of l){const n=X[o.className];if(!n){t+=o.level||0;continue}t+=o.level||0,n.babProgression==="Fast"?r+=o.level:n.babProgression==="Medium"?r+=Math.floor((o.level||0)*.75):r+=Math.floor((o.level||0)*.5)}t===0&&l.length===0&&(r=s.bab_claimed??s.bab??0),s.bab_claimed=r,s.bab=r;const d=J[s.size]||{cmbCmdMod:0},f=Math.floor(((s.str??10)-10)/2),p=Math.floor(((s.dex??10)-10)/2);s.cmd_claimed=10+r+f+p+(d.cmbCmdMod||0),s.cmd=s.cmd_claimed;let a=s.cr;return W[a]&&(s.xp=W[a]),s}function Q(e){const s=[],t=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(t))return{valid:!0,messages:s,status:"PASS"};const r=U.find(a=>a.cr===String(e.cr)||a.cr===e.cr_text);if(!r)return{valid:!0,messages:s,status:"PASS"};const l=e.hp_claimed??e.hp??void 0;if(l!==void 0&&typeof l=="number"){const a=l/r.hp;a<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${l} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${r.hp}). Creature is a "Glass Jaw".`}):a>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${l} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${r.hp}). It may be a "Damage Sponge".`})}const d=e.ac_claimed??e.ac??void 0;if(d!==void 0&&typeof d=="number"){const a=d-r.ac;a<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${d} is very low (-${Math.abs(a)}) for CR ${e.cr} (Benchmark: ${r.ac}).`}):a>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${d} is very high (+${a}) for CR ${e.cr} (Benchmark: ${r.ac}).`})}const f=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const a of f)a.val!==void 0&&typeof a.val=="number"&&a.val<r.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${a.name} Save +${a.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${r.poorSave}).`});return{valid:!s.some(a=>a.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const V=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,O=()=>{const[e,s]=$.useState(V),[t,r]=$.useState(()=>L(H(V))),[l,d]=$.useState([]),f=a=>{const o=a.currentTarget.value;s(o);try{const n=H(o),h=L(n);r(h);const u=j(n),g=Q(n);d([u,g])}catch(n){console.error("Parse error:",n)}},p=a=>{switch(a){case"error":return"#dc2626";case"warning":return"#ea580c";case"info":return"#2563eb"}};return c.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",fontFamily:"system-ui, sans-serif",height:"100vh",boxSizing:"border-box"}},c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"ðŸ“ Raw Stat Block"),c.createElement("textarea",{value:e,onChange:f,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",lineHeight:1.5},spellCheck:!1})),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",overflow:"auto"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âš–ï¸ Validation Results"),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},l.map((a,o)=>c.createElement("div",{key:o,style:{border:"1px solid #d1d5db",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f9fafb"}},c.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem"}},a.messages[0]?.category||"Validation"),a.messages.length===0?c.createElement("div",{style:{color:"#059669",fontWeight:500}},"âœ“ PASS"):c.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},a.messages.map((n,h)=>c.createElement("li",{key:h,style:{color:p(n.severity),marginBottom:"0.25rem",fontSize:"0.875rem"}},c.createElement("strong",null,n.severity.toUpperCase(),":")," ",n.message,n.expected!==void 0&&c.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:"#6b7280"}},"Expected: ",JSON.stringify(n.expected)," | Actual: ",JSON.stringify(n.actual))))))))),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âœ¨ Auto-Fixed Version"),c.createElement("textarea",{value:K(t),readOnly:!0,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #10b981",borderRadius:"0.375rem",resize:"none",backgroundColor:"#f0fdf4",lineHeight:1.5},spellCheck:!1})))};O.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const k={title:"Validators/Rules Lawyer Workbench",component:O,parameters:{layout:"fullscreen"}},x={};x.parameters={...x.parameters,docs:{...x.parameters?.docs,source:{originalSource:"{}",...x.parameters?.docs?.source}}};const ee=["InteractiveWorkbench"];export{x as InteractiveWorkbench,ee as __namedExportsOrder,k as default};
