import{r as y,R as l}from"./iframe-DbLPxDSm.js";import{M as D,C as z,b as j,S as q,X as G,v as U,a as Q,V as J}from"./validateEconomy-DBTclgie.js";import"./preload-helper-PPVm8Dsz.js";function K(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function Y(e){const a=K(e),t={name:a.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=a.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(t.melee_line="Melee "+o[1].trim());const c=a.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);c&&(t.ranged_line="Ranged "+c[1].trim());const f=a.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);f&&(t.speed_line="Speed "+f[1].trim());const h=a.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);h&&(t.special_attacks_line="Special Attacks "+h[1].trim());const i=a.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);i&&(t.spells_block=i[0].trim());const g=a.match(/SPECIAL ABILITIES(.+)$/s);g&&(t.special_abilities_block=`SPECIAL ABILITIES
`+g[1].trim());const S=a.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);S&&(t.skills_line="Skills "+S[1].trim());const $=a.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);$&&(t.languages_line="Languages "+$[1].trim());const n=a.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);n&&(t.equipment_line="Equipment "+n[1].trim());const r=a.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);r&&(t.cr=r[1]);const d=a.match(/XP\s*([0-9,]+)/i);d&&(t.xp=parseInt(d[1].replace(/,/g,"")));const m=a.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(m){t.alignment=m[1],t.size=m[2];const p=m[3].trim();t.subtypes=p.split(/,\s*/).map(E=>E.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?t.type="Outsider":/Dragon/i.test(p)?t.type="Dragon":/Undead/i.test(p)?t.type="Undead":/Beast/i.test(p)?t.type="Magical Beast":t.type=p.split(" ")[0]}const u=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let v;for(;(v=u.exec(a))!==null;)t.classLevels?.push({className:v[1],level:parseInt(v[2])});const C=a.match(/AC\s*(\d+)/i);C&&(t.ac_claimed=parseInt(C[1]));const M=a.match(/touch\s*(\d+)/i);M&&(t.touch_ac_claimed=parseInt(M[1]));const A=a.match(/flat-?footed\s*(\d+)/i);A&&(t.flat_footed_ac_claimed=parseInt(A[1]));const _=a.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(_&&(t.hp_claimed=parseInt(_[1]),t.hp=parseInt(_[1]),_[2])){const p=/(\d+)d/.exec(_[2]);p&&(t.racialHD=parseInt(p[1]))}const B=t.classLevels?.reduce((p,E)=>p+E.level,0)||0;t.racialHD===B&&B>0&&(t.racialHD=0);const R=a.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);R&&(t.fort_save_claimed=parseInt(R[1]),t.ref_save_claimed=parseInt(R[2]),t.will_save_claimed=parseInt(R[3]));const N=a.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);N&&(t.bab_claimed=parseInt(N[1]));const P=a.match(/CMD\s*(\d+)/i);P&&(t.cmd_claimed=parseInt(P[1]));const x=(p,E)=>{const X=new RegExp(`${E}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),H=p.match(X);if(!H)return 10;const W=H[1];return/\d/.test(W)?parseInt(W):0};t.str=x(a,"Str"),t.dex=x(a,"Dex"),t.con=x(a,"Con"),t.int=x(a,"Int"),t.wis=x(a,"Wis"),t.cha=x(a,"Cha"),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const L=a.match(/Init\s*([+-]?\d+)/i);L&&(t.init_claimed=parseInt(L[1]));const T=a.match(/Perception\s*([+-]?\d+)/i);T&&(t.perception_claimed=parseInt(T[1]));const F=a.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);F&&(t.feats=F[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const w=a.match(/Treasure\s+(.+?)(?:$|\n)/i);if(w){const p=w[1].toLowerCase();p.includes("npc gear")?t.treasureType="NPC Gear":(p.includes("standard"),t.treasureType="Standard")}return t}function O(e){const a=[],s=i=>i===0?"â€”":i.toString();a.push(`${e.name}`),a.push(`CR ${e.cr}`),a.push(`XP ${e.xp}`);const t=e.gender?`${e.gender} `:"",o=(e.classLevels||[]).map(i=>`${i.className} ${i.level}`).join(", ");a.push(`${t}${e.size} ${e.type} ${o}`.trim()),a.push(`Init ${e.init>0?"+":""}${e.init}; Senses ${e.senses||""}; Perception +${e.perception||0}`),e.aura&&a.push(`Aura ${e.aura}`),a.push("DEFENSE");const c=[];e.ac_mods&&(e.ac_mods.touch&&c.push(`touch ${e.ac_mods.touch}`),e.ac_mods.flat_footed&&c.push(`flat-footed ${e.ac_mods.flat_footed}`)),a.push(`AC ${e.ac}, ${c.join(", ")}`),a.push(`hp ${e.hp} (${e.hd})`);const f=`Fort +${e.fort}, Ref +${e.ref}, Will +${e.will}`;a.push(f),e.defensive_abilities&&a.push(`Defensive Abilities ${e.defensive_abilities}`),e.dr&&a.push(`DR ${e.dr}`),e.immune&&a.push(`Immune ${e.immune}`),e.resist&&a.push(`Resist ${e.resist}`),e.sr&&a.push(`SR ${e.sr}`),a.push("OFFENSE");const h=e.speed_line||"Speed 30 ft.";if(a.push(h),e.melee&&a.push(`Melee ${e.melee}`),e.ranged&&a.push(`Ranged ${e.ranged}`),e.space&&e.reach&&a.push(`Space ${e.space} ft.; Reach ${e.reach} ft.`),e.special_attacks&&a.push(`Special Attacks ${e.special_attacks}`),a.push("STATISTICS"),a.push(`Str ${s(e.str)}, Dex ${s(e.dex)}, Con ${s(e.con)}, Int ${s(e.int)}, Wis ${s(e.wis)}, Cha ${s(e.cha)}`),a.push(`Base Atk +${e.bab_claimed}; CMB ${e.cmb_claimed}; CMD ${e.cmd_claimed}`),e.feats&&e.feats.length>0&&a.push(`Feats ${e.feats.join(", ")}`),e.skills&&e.skills.length>0){const i=e.skills.map(g=>`${g.name} +${g.value}`).join(", ");a.push(`Skills ${i}`)}if(e.languages&&e.languages.length>0&&a.push(`Languages ${e.languages.join(", ")}`),e.sq&&a.push(`SQ ${e.sq}`),a.push("ECOLOGY"),a.push(`Environment ${e.environment||"any"}`),a.push(`Organization ${e.organization||"solitary"}`),a.push(`Treasure ${e.treasure||"standard"}`),e.special_abilities&&e.special_abilities.length>0){a.push("SPECIAL ABILITIES");for(const i of e.special_abilities)a.push(`${i.name} (${i.type}) ${i.description}`)}return a.join(`
`)}function Z(e,a="fix_math"){const s=JSON.parse(JSON.stringify(e)),t=[],o=(r,d,m,u)=>{d!=m&&t.push({feature:r,oldValue:d,newValue:m,reason:u})};if(a==="enforce_cr"){const r=D.find(d=>d.cr===s.cr);if(r){const m=(z[s.type]||{hitDieType:8}).hitDieType/2+.5,u=Math.floor(((s.con||10)-10)/2),v=Math.max(1,m+u),C=s.hp_claimed||s.hp;if(C>r.hp*1.5){const M=Math.max(1,Math.round(r.hp/v));if((s.classLevels||[]).length===0){const A=s.racialHD;s.racialHD=M;const _=Math.floor(s.racialHD*m)+s.racialHD*u;s.hp=_,s.hp_claimed=_,o("Hit Dice",A,M,`Reduced to match CR ${s.cr} Benchmark`),o("Hit Points",C,_,`Recalculated for ${M} HD`)}}}}let c=0;if(s.racialHD&&s.racialHD>0){const r=z[s.type];let d="medium";r&&(d=r.babProgression),d==="fast"?c+=s.racialHD:d==="medium"?c+=Math.floor(s.racialHD*.75):c+=Math.floor(s.racialHD*.5)}for(const r of s.classLevels||[]){const d=j[r.className];d&&(d.babProgression==="fast"?c+=r.level:d.babProgression==="medium"?c+=Math.floor(r.level*.75):c+=Math.floor(r.level*.5))}(s.racialHD||0)===0&&(s.classLevels||[]).length===0&&(c=s.bab_claimed??s.bab??0);const f=s.bab_claimed??s.bab;c!==f&&(o("Base Attack Bonus",f,c,`Fixed based on ${s.racialHD||0} HD (${s.type}) + Class Levels`),s.bab=c,s.bab_claimed=c);const h=q[s.size]||{cmbCmdMod:0},i=Math.floor(((s.str??10)-10)/2),g=Math.floor(((s.dex??10)-10)/2),S=10+c+i+g+(h.cmbCmdMod||0),$=s.cmd_claimed??s.cmd;if(S!==$&&(o("CMD",$,S,`Recalculated: 10 + BAB(${c}) + Str(${i}) + Dex(${g}) + Size(${h.cmbCmdMod})`),s.cmd=S,s.cmd_claimed=S),a==="fix_math"){const r=s.hp_claimed||s.hp;if(r>0){const d=D.find(m=>m.cr===s.cr);if(d&&r>d.hp*1.5){const m=D.find(u=>r>=u.hp*.85&&r<=u.hp*1.25);m&&(o("Challenge Rating",s.cr,m.cr,`Upgraded to match HP (${r})`),s.cr=m.cr,s.cr_text=m.cr)}}}let n=s.cr_text||s.cr.toString();if(n==="0.5"&&(n="1/2"),(n==="0.33"||n==="0.333")&&(n="1/3"),n==="0.25"&&(n="1/4"),(n==="0.16"||n==="0.166"||n==="0.167")&&(n="1/6"),n==="0.125"&&(n="1/8"),G[n]){const r=G[n];s.xp!==r&&(o("XP Award",s.xp,r,`Standardized for CR ${n}`),s.xp=r)}return{block:s,fixes:t}}function b(e){const a=[],s=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(s))return{valid:!0,messages:a,status:"PASS"};const t=D.find(i=>i.cr===String(e.cr)||i.cr===e.cr_text);if(!t)return{valid:!0,messages:a,status:"PASS"};const o=e.hp_claimed??e.hp??void 0;if(o!==void 0&&typeof o=="number"){const i=o/t.hp;i<.7?a.push({severity:"warning",category:"benchmarks",message:`HP ${o} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):i>1.5&&a.push({severity:"warning",category:"benchmarks",message:`HP ${o} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const c=e.ac_claimed??e.ac??void 0;if(c!==void 0&&typeof c=="number"){const i=c-t.ac;i<-3?a.push({severity:"warning",category:"benchmarks",message:`AC ${c} is very low (-${Math.abs(i)}) for CR ${e.cr} (Benchmark: ${t.ac}).`}):i>5&&a.push({severity:"warning",category:"benchmarks",message:`AC ${c} is very high (+${i}) for CR ${e.cr} (Benchmark: ${t.ac}).`})}const f=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const i of f)i.val!==void 0&&typeof i.val=="number"&&i.val<t.poorSave-2&&a.push({severity:"warning",category:"benchmarks",message:`${i.name} Save +${i.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!a.some(i=>i.severity==="error"),messages:a,status:a.length>0?"WARN":"PASS"}}const k=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,V=()=>{const[e,a]=y.useState(k),[s,t]=y.useState(null),[o,c]=y.useState("fix_math"),[f,h]=y.useState(null),[i,g]=y.useState([]),[S,$]=y.useState(null);return y.useEffect(()=>{if(!e.trim()){t(null),h(null),$(null),g([]);return}try{const n=Y(e);t(n);const{block:r,fixes:d}=Z(n,o);h(r),g(d);const m=U(r),u=b(r),v=Q(r),C={valid:m.valid&&u.valid&&v.valid,status:m.status==="FAIL"||v.status==="FAIL"?"FAIL":m.status==="WARN"||v.status==="WARN"||u.status==="WARN"?"WARN":"PASS",messages:[...m.messages,...u.messages,...v.messages]};$(C)}catch(n){console.error(n)}},[e,o]),l.createElement("div",{className:"validator-playground"},l.createElement("div",{className:"validator-column"},l.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),l.createElement("textarea",{className:"validator-textarea",value:e,onChange:n=>a(n.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),l.createElement("div",{className:"validator-scroll-area"},l.createElement("div",null,l.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v2)"),s&&S?l.createElement(J,{statBlock:s,validation:S}):null),i.length>0&&l.createElement("div",{className:"fix-report"},l.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",o==="fix_math"?"Audit Mode":"Design Mode",")"),l.createElement("ul",{className:"fix-list"},i.map((n,r)=>l.createElement("li",{key:r,className:"fix-item"},l.createElement("div",{style:{fontWeight:600}},n.feature),l.createElement("div",{className:"fix-change-row"},l.createElement("span",{className:"fix-old"},n.oldValue),l.createElement("span",null,"â†’"),l.createElement("span",{className:"fix-new"},n.newValue)),l.createElement("div",{className:"fix-reason"},n.reason)))))),l.createElement("div",{className:"validator-column"},l.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},l.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),l.createElement("div",{className:"mode-toggle"},l.createElement("button",{onClick:()=>c("fix_math"),className:`mode-btn ${o==="fix_math"?"active":"inactive"}`,title:"Trust Stats, Update CR"},"Fix Math"),l.createElement("button",{onClick:()=>c("enforce_cr"),className:`mode-btn ${o==="enforce_cr"?"active":"inactive"}`,title:"Trust CR, Downgrade Stats"},"Enforce CR"))),l.createElement("div",{className:"output-area"},f?l.createElement("pre",{className:"output-pre"},O(f)):l.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),l.createElement("button",{onClick:()=>f&&navigator.clipboard.writeText(O(f)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};V.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const se={title:"Validators/Rules Lawyer Workbench",component:V,parameters:{layout:"fullscreen"}},I={};I.parameters={...I.parameters,docs:{...I.parameters?.docs,source:{originalSource:"{}",...I.parameters?.docs?.source}}};const ie=["InteractiveWorkbench"];export{I as InteractiveWorkbench,ie as __namedExportsOrder,se as default};
