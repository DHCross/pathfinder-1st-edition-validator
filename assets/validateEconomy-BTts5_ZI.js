import{R as c}from"./iframe-CB91AcA2.js";import{C,a as $,M,S as D,X as S,W as h,T as E}from"./pf1e-data-tables-BqrvN3By.js";const w=({statBlock:e,validation:s,validationTarget:a})=>{const i=[...s.messages].sort((t,n)=>{const f={critical:0,warning:1,note:2};return f[t.severity]-f[n.severity]}),r=t=>{switch(t){case"critical":return"#ef4444";case"warning":return"#f59e0b";case"note":return"#9ca3af";default:return"#3b82f6"}},u=t=>{switch(t){case"critical":return"#fef2f2";case"warning":return"#fffbeb";case"note":return"#f9fafb";default:return"#eff6ff"}},l=t=>{switch(t){case"critical":return"ðŸ›‘";case"warning":return"âš ï¸";case"note":return"ðŸ“";default:return"â„¹ï¸"}},d=t=>{switch(t){case"PASS":return{backgroundColor:"#dcfce7",color:"#166534",borderColor:"#bbf7d0"};case"FAIL":return{backgroundColor:"#fee2e2",color:"#991b1b",borderColor:"#fecaca"};case"WARN":return{backgroundColor:"#fef9c3",color:"#854d0e",borderColor:"#fde047"};default:return{}}};return c.createElement("div",{style:{padding:"1.5rem",maxWidth:"42rem",margin:"0 auto",fontFamily:"sans-serif",border:"1px solid #e5e7eb",borderRadius:"0.5rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",backgroundColor:"white"}},c.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",borderBottom:"1px solid #e5e7eb",paddingBottom:"1rem",marginBottom:"1rem"}},c.createElement("div",null,c.createElement("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#111827",margin:0}},e.name||"Unnamed"),c.createElement("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:0}},e.size," ",e.type," â€¢ CR ",e.cr_text||e.cr)),c.createElement("span",{title:a==="fixed"?"Validating fixed (auto-fixed) version â€” see right panel":"Validating raw input version",style:{padding:"0.25rem 1rem",borderRadius:"9999px",fontSize:"0.875rem",fontWeight:"bold",border:"1px solid",display:"inline-flex",alignItems:"center",gap:"0.5rem",...d(s.status||"PASS")}},s.status," ",a?`(${a==="fixed"?"Fixed":"Raw"})`:""," ",a==="fixed"&&"âž¡ï¸")),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"}},i.length===0?c.createElement("div",{style:{textAlign:"center",padding:"2rem",color:"#9ca3af",fontStyle:"italic",border:"2px dashed #e5e7eb",borderRadius:"0.5rem"}},"âœ¨ No issues found. This stat block is mechanically perfect."):i.map((t,n)=>c.createElement("div",{key:n,style:{padding:"0.75rem",borderRadius:"0.25rem",borderLeftWidth:"4px",borderLeftStyle:"solid",border:"1px solid #e5e7eb",borderLeftColor:r(t.severity),backgroundColor:u(t.severity)}},c.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.25rem"}},c.createElement("span",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"0.25rem"}},l(t.severity)," ",t.category.toUpperCase())),c.createElement("p",{style:{color:"#1f2937",margin:0}},t.message),(t.expected!==void 0||t.actual!==void 0)&&c.createElement("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",fontFamily:"monospace",backgroundColor:"rgba(255,255,255,0.5)",padding:"0.25rem",borderRadius:"0.25rem",display:"inline-block"}},t.actual!==void 0&&c.createElement("span",{style:{marginRight:"0.5rem",color:"#dc2626"}},"Found: ",JSON.stringify(t.actual)),t.expected!==void 0&&c.createElement("span",{style:{color:"#16a34a"}},"Expected: ",JSON.stringify(t.expected)))))))};w.__docgenInfo={description:"",methods:[],displayName:"ValidatorDisplay",props:{statBlock:{required:!0,tsType:{name:"PF1eStatBlock"},description:""},validation:{required:!0,tsType:{name:"ValidationResult"},description:""},validationTarget:{required:!1,tsType:{name:"union",raw:"'raw' | 'fixed'",elements:[{name:"literal",value:"'raw'"},{name:"literal",value:"'fixed'"}]},description:""}}};function T(e){const s=[];let a=!1,i=e.racialHD||0,r=0;if(e.racialHD&&e.racialHD>0){const o=C[e.type];o?o.babProgression==="fast"?r+=e.racialHD:o.babProgression==="medium"?r+=Math.floor(e.racialHD*.75):r+=Math.floor(e.racialHD*.5):r+=Math.floor(e.racialHD*.75)}for(const o of e.classLevels||[]){const m=$[o.className];m&&(i+=o.level,m.babProgression==="fast"?r+=o.level:m.babProgression==="medium"?r+=Math.floor(o.level*.75):r+=Math.floor(o.level*.5))}const u=(e.cr||"").toString(),l=M.find(o=>o.cr===u);if(l){const o=Math.max(1,Math.round((l.hp||1)/4.5)),m=o*2;i>m&&i>=3&&(a=!0,s.push({category:"structure",severity:"critical",message:`HD/CR Mismatch: ${i} Hit Dice is inappropriate for CR ${e.cr}. This HD count suggests a much higher CR than declared and is a structural contradiction.`,expected:`${o} HD (max ${m})`,actual:`${i} HD`}))}const d=D[e.size]||{cmbCmdMod:0},t=Math.floor(((e.str||10)-10)/2),n=Math.floor(((e.dex||10)-10)/2);let f="MATCH";e.bab_claimed!==void 0&&e.bab_claimed!==r&&(f="MISMATCH",a=!0,s.push({category:"basics",severity:"critical",message:`Base Attack Bonus (BAB) +${e.bab_claimed} is illegal for ${i} HD. It must be +${r} according to ${e.type} progression.`,expected:r,actual:e.bab_claimed}));const p=10+r+t+n+d.cmbCmdMod,b=10+(e.bab_claimed||0)+t+n+d.cmbCmdMod;e.cmd_claimed&&(e.cmd_claimed===p||(e.cmd_claimed===b&&f==="MISMATCH"?s.push({category:"basics",severity:"warning",message:`CMD ${e.cmd_claimed} matches the source's (incorrect) BAB of +${e.bab_claimed}. If BAB were corrected to +${r}, CMD would be ${p}.`,expected:p,actual:e.cmd_claimed}):(a=!0,s.push({category:"basics",severity:"critical",message:`Calculated CMD is ${p} (10 + Legal BAB ${r} + Str ${t} + Dex ${n} + Size ${d.cmbCmdMod}), but stat block claims ${e.cmd_claimed}.`,expected:p,actual:e.cmd_claimed}))));const y=Math.ceil(i/2),v=e.feats?.length||0;v<y&&s.push({category:"basics",severity:"warning",message:`Creature has ${i} HD and should have at least ${y} feats, but only lists ${v}.`,expected:y,actual:v});const g=S[e.cr];return g&&e.xp!==g&&(a=!0,s.push({category:"basics",severity:"critical",message:`XP ${e.xp} does not match canonical value ${g} for CR ${e.cr}. (Source: Core Rulebook Experience Point Awards table)`,expected:g,actual:e.xp})),{valid:!a,status:a?"FAIL":s.length>0?"WARN":"PASS",messages:s}}function N(e){const s=[];if(e.gearValue===void 0)return{valid:!0,messages:[{severity:"note",category:"economy",message:"No gear value provided; skipping economy validation."}]};const a=H(e),i=L(e,a);if(i===null)return s.push({severity:"warning",category:"economy",message:`Unable to determine expected wealth for ${a} tier.`}),{valid:!0,messages:s};const r=e.gearValue,l=(r-i)/i*100,d=15;Math.abs(l)<=d?s.push({severity:"note",category:"economy",message:`Wealth is on target for ${a} (${r} gp vs expected ${i} gp).`,expected:i,actual:r}):l>d?s.push({severity:"warning",category:"economy",message:`Over-geared: ${a} has ${r} gp, expected ~${i} gp (+${l.toFixed(1)}%).`,expected:i,actual:r}):s.push({severity:"warning",category:"economy",message:`Under-geared: ${a} has ${r} gp, expected ~${i} gp (${l.toFixed(1)}%).`,expected:i,actual:r});let t="PASS";return s.some(n=>n.severity==="critical")?t="FAIL":s.some(n=>n.severity==="warning")&&(t="WARN"),{valid:Math.abs(l)<=d,messages:s,status:t}}function H(e){if(e.economicTier)return e.economicTier;const s=e.racialHD||0,a=e.classLevels||[],i=["Warrior","Expert","Commoner","Adept","Aristocrat"],u=a.filter(t=>!i.includes(t.className)).reduce((t,n)=>t+n.level,0),d=a.filter(t=>i.includes(t.className)).reduce((t,n)=>t+n.level,0);return u>=s&&u>0?"Heroic NPC":d>0?"Basic NPC":"Monster"}function L(e,s){if(s==="Heroic NPC"){const a=x(e);return a<1||a>20?null:h.heroicNpc[a]||null}if(s==="Basic NPC"){const a=x(e);return a<1||a>20?null:h.basicNpc[a]||null}if(s==="Monster"){const a=e.cr,i=E[a];if(!i)return null;let r=i.medium;return e.treasureType==="Double"?r*=2:e.treasureType==="Triple"?r*=3:e.treasureType==="Incidental"?r*=.5:e.treasureType==="None"&&(r=0),r}return null}function x(e){if(e.claimedEffectiveLevel!==void 0)return e.claimedEffectiveLevel;const s=e.racialHD||0,i=(e.classLevels||[]).reduce((r,u)=>r+u.level,0);return s+i}export{w as V,N as a,T as v};
