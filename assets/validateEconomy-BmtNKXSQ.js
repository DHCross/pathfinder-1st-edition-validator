import{R as n}from"./iframe-bJ9Mhkbi.js";import{C,a as $,M,S as D,X as S,W as h,T as E}from"./pf1e-data-tables-BqrvN3By.js";const H=({statBlock:e,validation:a})=>{const s=[...a.messages].sort((r,c)=>{const o={critical:0,warning:1,note:2};return o[r.severity]-o[c.severity]}),i=r=>{switch(r){case"critical":return"#ef4444";case"warning":return"#f59e0b";case"note":return"#9ca3af";default:return"#3b82f6"}},t=r=>{switch(r){case"critical":return"#fef2f2";case"warning":return"#fffbeb";case"note":return"#f9fafb";default:return"#eff6ff"}},u=r=>{switch(r){case"critical":return"ðŸ›‘";case"warning":return"âš ï¸";case"note":return"ðŸ“";default:return"â„¹ï¸"}},d=r=>{switch(r){case"PASS":return{backgroundColor:"#dcfce7",color:"#166534",borderColor:"#bbf7d0"};case"FAIL":return{backgroundColor:"#fee2e2",color:"#991b1b",borderColor:"#fecaca"};case"WARN":return{backgroundColor:"#fef9c3",color:"#854d0e",borderColor:"#fde047"};default:return{}}};return n.createElement("div",{style:{padding:"1.5rem",maxWidth:"42rem",margin:"0 auto",fontFamily:"sans-serif",border:"1px solid #e5e7eb",borderRadius:"0.5rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",backgroundColor:"white"}},n.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",borderBottom:"1px solid #e5e7eb",paddingBottom:"1rem",marginBottom:"1rem"}},n.createElement("div",null,n.createElement("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#111827",margin:0}},e.name||"Unnamed"),n.createElement("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:0}},e.size," ",e.type," â€¢ CR ",e.cr_text||e.cr)),n.createElement("span",{style:{padding:"0.25rem 1rem",borderRadius:"9999px",fontSize:"0.875rem",fontWeight:"bold",border:"1px solid",...d(a.status||"PASS")}},a.status)),n.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"}},s.length===0?n.createElement("div",{style:{textAlign:"center",padding:"2rem",color:"#9ca3af",fontStyle:"italic",border:"2px dashed #e5e7eb",borderRadius:"0.5rem"}},"âœ¨ No issues found. This stat block is mechanically perfect."):s.map((r,c)=>n.createElement("div",{key:c,style:{padding:"0.75rem",borderRadius:"0.25rem",borderLeftWidth:"4px",borderLeftStyle:"solid",border:"1px solid #e5e7eb",borderLeftColor:i(r.severity),backgroundColor:t(r.severity)}},n.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.25rem"}},n.createElement("span",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"0.25rem"}},u(r.severity)," ",r.category.toUpperCase())),n.createElement("p",{style:{color:"#1f2937",margin:0}},r.message),(r.expected!==void 0||r.actual!==void 0)&&n.createElement("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",fontFamily:"monospace",backgroundColor:"rgba(255,255,255,0.5)",padding:"0.25rem",borderRadius:"0.25rem",display:"inline-block"}},r.actual!==void 0&&n.createElement("span",{style:{marginRight:"0.5rem",color:"#dc2626"}},"Found: ",JSON.stringify(r.actual)),r.expected!==void 0&&n.createElement("span",{style:{color:"#16a34a"}},"Expected: ",JSON.stringify(r.expected)))))))};H.__docgenInfo={description:"",methods:[],displayName:"ValidatorDisplay",props:{statBlock:{required:!0,tsType:{name:"PF1eStatBlock"},description:""},validation:{required:!0,tsType:{name:"ValidationResult"},description:""}}};function T(e){const a=[];let s=!1,i=e.racialHD||0,t=0;if(e.racialHD&&e.racialHD>0){const l=C[e.type];l?l.babProgression==="fast"?t+=e.racialHD:l.babProgression==="medium"?t+=Math.floor(e.racialHD*.75):t+=Math.floor(e.racialHD*.5):t+=Math.floor(e.racialHD*.75)}for(const l of e.classLevels||[]){const m=$[l.className];m&&(i+=l.level,m.babProgression==="fast"?t+=l.level:m.babProgression==="medium"?t+=Math.floor(l.level*.75):t+=Math.floor(l.level*.5))}const u=(e.cr||"").toString(),d=M.find(l=>l.cr===u);if(d){const l=Math.max(1,Math.round((d.hp||1)/4.5)),m=l*2;i>m&&i>=3&&(s=!0,a.push({category:"structure",severity:"critical",message:`HD/CR Mismatch: ${i} Hit Dice is inappropriate for CR ${e.cr}. This HD count suggests a much higher CR than declared and is a structural contradiction.`,expected:`${l} HD (max ${m})`,actual:`${i} HD`}))}const r=D[e.size]||{cmbCmdMod:0},c=Math.floor(((e.str||10)-10)/2),o=Math.floor(((e.dex||10)-10)/2);let v="MATCH";e.bab_claimed!==void 0&&e.bab_claimed!==t&&(v="MISMATCH",s=!0,a.push({category:"basics",severity:"critical",message:`Base Attack Bonus (BAB) +${e.bab_claimed} is illegal for ${i} HD. It must be +${t} according to ${e.type} progression.`,expected:t,actual:e.bab_claimed}));const f=10+t+c+o+r.cmbCmdMod,x=10+(e.bab_claimed||0)+c+o+r.cmbCmdMod;e.cmd_claimed&&(e.cmd_claimed===f||(e.cmd_claimed===x&&v==="MISMATCH"?a.push({category:"basics",severity:"warning",message:`CMD ${e.cmd_claimed} matches the source's (incorrect) BAB of +${e.bab_claimed}. If BAB were corrected to +${t}, CMD would be ${f}.`,expected:f,actual:e.cmd_claimed}):(s=!0,a.push({category:"basics",severity:"critical",message:`Calculated CMD is ${f} (10 + Legal BAB ${t} + Str ${c} + Dex ${o} + Size ${r.cmbCmdMod}), but stat block claims ${e.cmd_claimed}.`,expected:f,actual:e.cmd_claimed}))));const g=Math.ceil(i/2),y=e.feats?.length||0;y<g&&a.push({category:"basics",severity:"warning",message:`Creature has ${i} HD and should have at least ${g} feats, but only lists ${y}.`,expected:g,actual:y});const p=S[e.cr];return p&&e.xp!==p&&(s=!0,a.push({category:"basics",severity:"critical",message:`XP ${e.xp} does not match canonical value ${p} for CR ${e.cr}. (Source: Core Rulebook Experience Point Awards table)`,expected:p,actual:e.xp})),{valid:!s,status:s?"FAIL":a.length>0?"WARN":"PASS",messages:a}}function N(e){const a=[];if(e.gearValue===void 0)return{valid:!0,messages:[{severity:"note",category:"economy",message:"No gear value provided; skipping economy validation."}]};const s=L(e),i=R(e,s);if(i===null)return a.push({severity:"warning",category:"economy",message:`Unable to determine expected wealth for ${s} tier.`}),{valid:!0,messages:a};const t=e.gearValue,d=(t-i)/i*100,r=15;Math.abs(d)<=r?a.push({severity:"note",category:"economy",message:`Wealth is on target for ${s} (${t} gp vs expected ${i} gp).`,expected:i,actual:t}):d>r?a.push({severity:"warning",category:"economy",message:`Over-geared: ${s} has ${t} gp, expected ~${i} gp (+${d.toFixed(1)}%).`,expected:i,actual:t}):a.push({severity:"warning",category:"economy",message:`Under-geared: ${s} has ${t} gp, expected ~${i} gp (${d.toFixed(1)}%).`,expected:i,actual:t});let c="PASS";return a.some(o=>o.severity==="critical")?c="FAIL":a.some(o=>o.severity==="warning")&&(c="WARN"),{valid:Math.abs(d)<=r,messages:a,status:c}}function L(e){if(e.economicTier)return e.economicTier;const a=e.racialHD||0,s=e.classLevels||[],i=["Warrior","Expert","Commoner","Adept","Aristocrat"],u=s.filter(c=>!i.includes(c.className)).reduce((c,o)=>c+o.level,0),r=s.filter(c=>i.includes(c.className)).reduce((c,o)=>c+o.level,0);return u>=a&&u>0?"Heroic NPC":r>0?"Basic NPC":"Monster"}function R(e,a){if(a==="Heroic NPC"){const s=b(e);return s<1||s>20?null:h.heroicNpc[s]||null}if(a==="Basic NPC"){const s=b(e);return s<1||s>20?null:h.basicNpc[s]||null}if(a==="Monster"){const s=e.cr,i=E[s];if(!i)return null;let t=i.medium;return e.treasureType==="Double"?t*=2:e.treasureType==="Triple"?t*=3:e.treasureType==="Incidental"?t*=.5:e.treasureType==="None"&&(t=0),t}return null}function b(e){if(e.claimedEffectiveLevel!==void 0)return e.claimedEffectiveLevel;const a=e.racialHD||0,i=(e.classLevels||[]).reduce((t,u)=>t+u.level,0);return a+i}export{H as V,N as a,T as v};
