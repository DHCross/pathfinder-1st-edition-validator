import{r as D,R as r}from"./iframe-Dqo_ob27.js";import{s as q,f as G}from"./pf1e-formatter-rxhD__3t.js";import{M as T,C as V,a as K,S as Q,X as z}from"./pf1e-data-tables-BqrvN3By.js";import{v as O,a as j,V as Z}from"./validateEconomy-BhOzF6i-.js";import"./preload-helper-PPVm8Dsz.js";function Y(n){return n.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function ee(n){const a=Y(n),t={name:a.split(`
`).map(s=>s.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=a.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(t.melee_line="Melee "+o[1].trim());const l=a.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);l&&(t.ranged_line="Ranged "+l[1].trim());const p=a.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);p&&(t.speed_line="Speed "+p[1].trim());const g=a.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);g&&(t.special_attacks_line="Special Attacks "+g[1].trim());const c=a.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);c&&(t.spells_block=c[0].trim());const b=a.match(/SPECIAL ABILITIES(.+)$/s);b&&(t.special_abilities_block=`SPECIAL ABILITIES
`+b[1].trim());const x=a.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);x&&(t.skills_line="Skills "+x[1].trim());const w=a.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);w&&(t.languages_line="Languages "+w[1].trim());const R=a.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);R&&(t.equipment_line="Equipment "+R[1].trim());const I=a.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);I&&(t.cr=I[1]);const m=a.match(/XP\s*([0-9,]+)/i);m&&(t.xp=parseInt(m[1].replace(/,/g,"")));const h=a.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(h){t.alignment=h[1],t.size=h[2];const s=h[3].trim();t.subtypes=s.split(/,\s*/).map(u=>u.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(s)?t.type="Outsider":/Dragon/i.test(s)?t.type="Dragon":/Undead/i.test(s)?t.type="Undead":/Beast/i.test(s)?t.type="Magical Beast":t.type=s.split(" ")[0]}const B=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let v;for(;(v=B.exec(a))!==null;)t.classLevels?.push({className:v[1],level:parseInt(v[2])});const y=a.match(/AC\s*(\d+)/i);y&&(t.ac_claimed=parseInt(y[1]));const E=a.match(/touch\s*(\d+)/i);E&&(t.touch_ac_claimed=parseInt(E[1]));const k=a.match(/flat-?footed\s*(\d+)/i);k&&(t.flat_footed_ac_claimed=parseInt(k[1]));const _=a.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(_&&(t.hp_claimed=parseInt(_[1]),t.hp=parseInt(_[1]),_[2])){const s=/(\d+)d/.exec(_[2]);s&&(t.racialHD=parseInt(s[1]))}const F=t.classLevels?.reduce((s,u)=>s+u.level,0)||0;t.racialHD===F&&F>0&&(t.racialHD=0);const A=a.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);A&&(t.fort_save_claimed=parseInt(A[1]),t.ref_save_claimed=parseInt(A[2]),t.will_save_claimed=parseInt(A[3]));const S=a.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);S&&(t.bab_claimed=parseInt(S[1]));const M=a.match(/CMD\s*(\d+)/i);M&&(t.cmd_claimed=parseInt(M[1]));const d=(s,u)=>{const H=new RegExp(`${u}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),$=s.match(H);if(!$)return 10;const N=$[1];return/\d/.test(N)?parseInt(N):0};t.str=d(a,"Str"),t.dex=d(a,"Dex"),t.con=d(a,"Con"),t.int=d(a,"Int"),t.wis=d(a,"Wis"),t.cha=d(a,"Cha"),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const C=a.match(/Init\s*([+-]?\d+)/i);C&&(t.init_claimed=parseInt(C[1]));const P=a.match(/Perception\s*([+-]?\d+)/i);P&&(t.perception_claimed=parseInt(P[1]));const i=a.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);i&&(t.feats=i[1].split(/[,;]/).map(s=>s.trim()).filter(Boolean));const f=a.match(/Treasure\s+(.+?)(?:$|\n)/i);if(f){const s=f[1].toLowerCase();s.includes("npc gear")?t.treasureType="NPC Gear":(s.includes("standard"),t.treasureType="Standard")}return t}function te(n,a="enforce_cr"){const e=JSON.parse(JSON.stringify(n)),t=[],o=(i,f,s,u)=>{f!=s&&t.push({feature:i,oldValue:f,newValue:s,reason:u})};if(a==="enforce_cr"){const i=T.find(f=>f.cr===e.cr);if(i){const s=(V[e.type]||{hitDieType:8}).hitDieType/2+.5,u=Math.floor(((e.con||10)-10)/2),H=Math.max(1,s+u),$=e.hp_claimed||e.hp;if($>i.hp*1.5){const N=Math.max(1,Math.round(i.hp/H));if((e.classLevels||[]).length===0){const J=e.racialHD;e.racialHD=N;const W=Math.floor(e.racialHD*s)+e.racialHD*u;e.hp=W,e.hp_claimed=W,o("Hit Dice",J,N,`Reduced to match CR ${e.cr} Benchmark`),o("Hit Points",$,W,`Recalculated for ${N} HD`)}}}}let l=0;if(e.racialHD&&e.racialHD>0){const i=V[e.type];let f="medium";i&&(f=i.babProgression),f==="fast"?l+=e.racialHD:f==="medium"?l+=Math.floor(e.racialHD*.75):l+=Math.floor(e.racialHD*.5)}for(const i of e.classLevels||[]){const f=K[i.className];f&&(f.babProgression==="fast"?l+=i.level:f.babProgression==="medium"?l+=Math.floor(i.level*.75):l+=Math.floor(i.level*.5))}(e.racialHD||0)===0&&(e.classLevels||[]).length===0&&(l=e.bab_claimed??e.bab??0);const p=e.bab_claimed??e.bab;l!==p&&(o("Base Attack Bonus",p,l,`Fixed based on ${e.racialHD||0} HD (${e.type}) + Class Levels`),e.bab=l,e.bab_claimed=l);const g=Q[e.size]||{acAttackMod:0,cmbCmdMod:0},c=Math.floor(((e.str??10)-10)/2),b=Math.floor(((e.dex??10)-10)/2),x=10+l+c+b+(g.cmbCmdMod||0),w=e.cmd_claimed??e.cmd;x!==w&&(o("CMD",w,x,`Recalculated: 10 + BAB(${l}) + Str(${c}) + Dex(${b}) + Size(${g.cmbCmdMod})`),e.cmd=x,e.cmd_claimed=x);const R=l+c+(g.cmbCmdMod||0),I=e.cmb;R!==I&&(o("CMB",I,R,`Recalculated: BAB(${l}) + Str(${c}) + Size(${g.cmbCmdMod})`),e.cmb=R);const m=(e.racialHD??0)+(e.classLevels||[]).reduce((i,f)=>i+(f.level||0),0),h=Math.floor(2+m/2),B=Math.floor(m/3),v=V[e.type]||{goodSaves:[]},y=(v.goodSaves?.includes("Fort")?h:B)+Math.floor(((e.con??10)-10)/2),E=(v.goodSaves?.includes("Ref")?h:B)+Math.floor(((e.dex??10)-10)/2),k=(v.goodSaves?.includes("Will")?h:B)+Math.floor(((e.wis??10)-10)/2),_=e.fort_save_claimed??e.fort;y!==_&&(o("Fort Save",_,y,`Recalculated for ${m} HD and con ${e.con}`),e.fort=y,e.fort_save_claimed=y);const F=e.ref_save_claimed??e.ref;E!==F&&(o("Ref Save",F,E,`Recalculated for ${m} HD and dex ${e.dex}`),e.ref=E,e.ref_save_claimed=E);const A=e.will_save_claimed??e.will;k!==A&&(o("Will Save",A,k,`Recalculated for ${m} HD and wis ${e.wis}`),e.will=k,e.will_save_claimed=k);const S=Math.floor(((e.dex??10)-10)/2),M=e.init_claimed??void 0;if(S!==M&&(o("Init",M,S,`Set to Dex modifier ${S}`),e.init_claimed=S),a==="fix_math"){const i=e.hp_claimed||e.hp;if(i>0){const f=T.find(s=>s.cr===e.cr);if(f&&i>f.hp*1.5){const s=T.find(u=>i>=u.hp*.85&&i<=u.hp*1.25);s&&(o("Challenge Rating",e.cr,s.cr,`Upgraded to match HP (${i})`),e.cr=s.cr,e.cr_text=s.cr)}}}let d=e.cr_text||e.cr.toString();if(d==="0.5"&&(d="1/2"),(d==="0.33"||d==="0.333")&&(d="1/3"),d==="0.25"&&(d="1/4"),(d==="0.16"||d==="0.166"||d==="0.167")&&(d="1/6"),d==="0.125"&&(d="1/8"),z[d]){const i=z[d];e.xp!==i&&(o("XP Award",e.xp,i,`Standardized for CR ${d}`),e.xp=i)}const C=e.ac_claimed||e.ac,P=10+b+g.acAttackMod;return C>P?e.ac=C:e.ac=Math.max(C,P),{block:e,fixes:t}}function X(n){const a=[],e=typeof n.cr=="number"?n.cr:parseInt(String(n.cr),10);if(isNaN(e))return{valid:!0,messages:a,status:"PASS"};const t=T.find(c=>c.cr===String(n.cr)||c.cr===n.cr_text);if(!t)return{valid:!0,messages:a,status:"PASS"};const o=n.hp_claimed??n.hp??void 0;if(o!==void 0&&typeof o=="number"){const c=o/t.hp;c<.7?a.push({severity:"warning",category:"benchmarks",message:`HP ${o} is very low for CR ${n.cr}. Standard is ~${t.hp}. Creature may be too fragile.`,expected:t.hp,actual:o}):c>1.5&&a.push({severity:"warning",category:"benchmarks",message:`HP ${o} is very high for CR ${n.cr}. Standard is ~${t.hp}. This is a "Damage Sponge."`,expected:t.hp,actual:o})}const l=n.ac_claimed??n.ac??void 0;if(l!==void 0&&typeof l=="number"){const c=l-t.ac;c<-4?a.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very low for CR ${n.cr}. Standard is ~${t.ac}. Creature will be crit often.`,expected:t.ac,actual:l}):c>4&&a.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very high for CR ${n.cr}. Standard is ~${t.ac}. Players may struggle to hit.`,expected:t.ac,actual:l})}const p=[{name:"Fort",val:n.fort_save_claimed},{name:"Ref",val:n.ref_save_claimed},{name:"Will",val:n.will_save_claimed}];for(const c of p)c.val!==void 0&&typeof c.val=="number"&&c.val<t.poorSave-2&&a.push({severity:"warning",category:"benchmarks",message:`${c.name} Save +${c.val} is very low for CR ${n.cr}. Standard is ~+${t.poorSave}. It will fail often.`,expected:t.poorSave,actual:c.val});return{valid:!a.some(c=>c.severity==="critical"),messages:a,status:a.length>0?"WARN":"PASS"}}const ae=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,U=()=>{const[n,a]=D.useState(ae),[e,t]=D.useState(null),[o,l]=D.useState(1),[p,g]=D.useState("enforce_cr"),[c,b]=D.useState(null),[x,w]=D.useState([]),[R,I]=D.useState(null);return D.useEffect(()=>{if(!n.trim()){t(null),b(null),I(null),w([]);return}try{const m=ee(n);t(m);const h=parseInt(m.cr)||1;l(h)}catch(m){console.error(m)}},[n]),D.useEffect(()=>{if(!e)return;let m=JSON.parse(JSON.stringify(e));const h=[],B=e.cr,v=o.toString();if(B!==v){const u=z[v];if(u){const{block:H,changes:$}=q(m,u);m=H,$.forEach(N=>h.push({feature:"Creature Scaler",oldValue:B,newValue:v,reason:N}))}}const{block:y,fixes:E}=te(m,p);b(y),w([...h,...E]);const _=O(e).messages.filter(u=>u.category==="structure"),A=X(e).messages.filter(u=>u.severity!=="note"),S=p==="enforce_cr"?y:e;let M={status:"PASS",messages:[]},d={status:"PASS",messages:[]},C={status:"PASS",messages:[]};S&&(M=O(S),d=X(S),C=j(S));const P=[..._,...A,...M.messages,...d.messages,...C.messages],i=_.some(u=>u.severity==="critical"),f=M.status==="FAIL"||C.status==="FAIL",s={valid:!i&&!f,status:i||f?"FAIL":M.status==="WARN"||C.status==="WARN"||d.status==="WARN"?"WARN":"PASS",messages:P};I(s)},[e,o,p]),r.createElement("div",{className:"validator-playground"},r.createElement("div",{className:"validator-column"},r.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),r.createElement("textarea",{className:"validator-textarea",value:n,onChange:m=>a(m.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"validator-scroll-area"},r.createElement("div",null,r.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v3.0)"),r.createElement("div",{style:{fontSize:"0.85rem",color:"#6b7280",marginBottom:"0.5rem"}},"Validating: ",p==="enforce_cr"?"Auto-Fixed Version (Design Mode)":"Raw Input (Audit Mode)"),e&&R?r.createElement(Z,{statBlock:p==="enforce_cr"?c:e,validation:R,validationTarget:p==="enforce_cr"?"fixed":"raw"}):null),x.length>0&&r.createElement("div",{className:"fix-report"},r.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",p==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"fix-list"},x.map((m,h)=>r.createElement("li",{key:h,className:"fix-item"},r.createElement("div",{style:{fontWeight:600}},m.feature),r.createElement("div",{className:"fix-change-row"},r.createElement("span",{className:"fix-old"},m.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"fix-new"},m.newValue)),r.createElement("div",{className:"fix-reason"},m.reason)))))),r.createElement("div",{className:"validator-column"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},r.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),r.createElement("div",{className:"mode-toggle",style:{display:"flex",alignItems:"center",gap:"1rem"}},r.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"}},r.createElement("label",{htmlFor:"cr-slider",style:{fontSize:"0.75rem",fontWeight:"bold",color:"#4b5563"}},"Target CR: ",o),r.createElement("input",{id:"cr-slider",type:"range",min:"1",max:"20",value:o,onChange:m=>l(parseInt(m.target.value)),style:{width:"100px"}})),r.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},r.createElement("button",{onClick:()=>g("enforce_cr"),style:{backgroundColor:p==="enforce_cr"?"white":"transparent",color:p==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:p==="enforce_cr"?"bold":"normal",boxShadow:p==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep CR, Downgrade Stats"},"Design Mode (Enforce CR)"),r.createElement("button",{onClick:()=>g("fix_math"),style:{backgroundColor:p==="fix_math"?"white":"transparent",color:p==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:p==="fix_math"?"bold":"normal",boxShadow:p==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep Stats, Update CR"},"Audit Mode (Fix Math)")))),r.createElement("div",{className:"output-area"},c?r.createElement("pre",{className:"output-pre"},G(c)):r.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),r.createElement("button",{onClick:()=>c&&navigator.clipboard.writeText(G(c)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};U.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ne={title:"Validators/Rules Lawyer Workbench",component:U,parameters:{layout:"fullscreen"}},L={};L.parameters={...L.parameters,docs:{...L.parameters?.docs,source:{originalSource:"{}",...L.parameters?.docs?.source}}};const oe=["InteractiveWorkbench"];export{L as InteractiveWorkbench,oe as __namedExportsOrder,ne as default};
