import{R as o}from"./iframe-D_60GUjX.js";import{C as h,a as C,S as x,X as $,W as y,T as M}from"./pf1e-data-tables-BqrvN3By.js";const E=({statBlock:e,validation:a})=>{const s=[...a.messages].sort((r,n)=>{const c={critical:0,warning:1,note:2};return c[r.severity]-c[n.severity]}),i=r=>{switch(r){case"critical":return"#ef4444";case"warning":return"#f59e0b";case"note":return"#9ca3af";default:return"#3b82f6"}},t=r=>{switch(r){case"critical":return"#fef2f2";case"warning":return"#fffbeb";case"note":return"#f9fafb";default:return"#eff6ff"}},d=r=>{switch(r){case"critical":return"ðŸ›‘";case"warning":return"âš ï¸";case"note":return"ðŸ“";default:return"â„¹ï¸"}},l=r=>{switch(r){case"PASS":return{backgroundColor:"#dcfce7",color:"#166534",borderColor:"#bbf7d0"};case"FAIL":return{backgroundColor:"#fee2e2",color:"#991b1b",borderColor:"#fecaca"};case"WARN":return{backgroundColor:"#fef9c3",color:"#854d0e",borderColor:"#fde047"};default:return{}}};return o.createElement("div",{style:{padding:"1.5rem",maxWidth:"42rem",margin:"0 auto",fontFamily:"sans-serif",border:"1px solid #e5e7eb",borderRadius:"0.5rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",backgroundColor:"white"}},o.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",borderBottom:"1px solid #e5e7eb",paddingBottom:"1rem",marginBottom:"1rem"}},o.createElement("div",null,o.createElement("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#111827",margin:0}},e.name||"Unnamed"),o.createElement("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:0}},e.size," ",e.type," â€¢ CR ",e.cr_text||e.cr)),o.createElement("span",{style:{padding:"0.25rem 1rem",borderRadius:"9999px",fontSize:"0.875rem",fontWeight:"bold",border:"1px solid",...l(a.status||"PASS")}},a.status)),o.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"}},s.length===0?o.createElement("div",{style:{textAlign:"center",padding:"2rem",color:"#9ca3af",fontStyle:"italic",border:"2px dashed #e5e7eb",borderRadius:"0.5rem"}},"âœ¨ No issues found. This stat block is mechanically perfect."):s.map((r,n)=>o.createElement("div",{key:n,style:{padding:"0.75rem",borderRadius:"0.25rem",borderLeftWidth:"4px",borderLeftStyle:"solid",border:"1px solid #e5e7eb",borderLeftColor:i(r.severity),backgroundColor:t(r.severity)}},o.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.25rem"}},o.createElement("span",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"0.25rem"}},d(r.severity)," ",r.category.toUpperCase())),o.createElement("p",{style:{color:"#1f2937",margin:0}},r.message),(r.expected!==void 0||r.actual!==void 0)&&o.createElement("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",fontFamily:"monospace",backgroundColor:"rgba(255,255,255,0.5)",padding:"0.25rem",borderRadius:"0.25rem",display:"inline-block"}},r.actual!==void 0&&o.createElement("span",{style:{marginRight:"0.5rem",color:"#dc2626"}},"Found: ",JSON.stringify(r.actual)),r.expected!==void 0&&o.createElement("span",{style:{color:"#16a34a"}},"Expected: ",JSON.stringify(r.expected)))))))};E.__docgenInfo={description:"",methods:[],displayName:"ValidatorDisplay",props:{statBlock:{required:!0,tsType:{name:"PF1eStatBlock"},description:""},validation:{required:!0,tsType:{name:"ValidationResult"},description:""}}};function w(e){const a=[];let s=!1,i=e.racialHD||0,t=0;if(e.racialHD&&e.racialHD>0){const u=h[e.type];u?u.babProgression==="fast"?t+=e.racialHD:u.babProgression==="medium"?t+=Math.floor(e.racialHD*.75):t+=Math.floor(e.racialHD*.5):t+=Math.floor(e.racialHD*.75)}for(const u of e.classLevels||[]){const g=C[u.className];g&&(i+=u.level,g.babProgression==="fast"?t+=u.level:g.babProgression==="medium"?t+=Math.floor(u.level*.75):t+=Math.floor(u.level*.5))}const d=x[e.size]||{cmbCmdMod:0},l=Math.floor(((e.str||10)-10)/2),r=Math.floor(((e.dex||10)-10)/2);let n="MATCH";e.bab_claimed!==void 0&&e.bab_claimed!==t&&(n="MISMATCH",s=!0,a.push({category:"basics",severity:"critical",message:`Base Attack Bonus (BAB) +${e.bab_claimed} is illegal for ${i} HD. It must be +${t} according to ${e.type} progression.`,expected:t,actual:e.bab_claimed}));const c=10+t+l+r+d.cmbCmdMod,b=10+(e.bab_claimed||0)+l+r+d.cmbCmdMod;e.cmd_claimed&&(e.cmd_claimed===c||(e.cmd_claimed===b&&n==="MISMATCH"?a.push({category:"basics",severity:"warning",message:`CMD ${e.cmd_claimed} matches the source's (incorrect) BAB of +${e.bab_claimed}. If BAB were corrected to +${t}, CMD would be ${c}.`,expected:c,actual:e.cmd_claimed}):(s=!0,a.push({category:"basics",severity:"critical",message:`Calculated CMD is ${c} (10 + Legal BAB ${t} + Str ${l} + Dex ${r} + Size ${d.cmbCmdMod}), but stat block claims ${e.cmd_claimed}.`,expected:c,actual:e.cmd_claimed}))));const f=Math.ceil(i/2),p=e.feats?.length||0;p<f&&a.push({category:"basics",severity:"warning",message:`Creature has ${i} HD and should have at least ${f} feats, but only lists ${p}.`,expected:f,actual:p});const m=$[e.cr];return m&&e.xp!==m&&(s=!0,a.push({category:"basics",severity:"critical",message:`XP ${e.xp} does not match canonical value ${m} for CR ${e.cr}. (Source: Core Rulebook Experience Point Awards table)`,expected:m,actual:e.xp})),{valid:!s,status:s?"FAIL":a.length>0?"WARN":"PASS",messages:a}}function N(e){const a=[];if(e.gearValue===void 0)return{valid:!0,messages:[{severity:"note",category:"economy",message:"No gear value provided; skipping economy validation."}]};const s=S(e),i=L(e,s);if(i===null)return a.push({severity:"warning",category:"economy",message:`Unable to determine expected wealth for ${s} tier.`}),{valid:!0,messages:a};const t=e.gearValue,l=(t-i)/i*100,r=15;Math.abs(l)<=r?a.push({severity:"note",category:"economy",message:`Wealth is on target for ${s} (${t} gp vs expected ${i} gp).`,expected:i,actual:t}):l>r?a.push({severity:"warning",category:"economy",message:`Over-geared: ${s} has ${t} gp, expected ~${i} gp (+${l.toFixed(1)}%).`,expected:i,actual:t}):a.push({severity:"warning",category:"economy",message:`Under-geared: ${s} has ${t} gp, expected ~${i} gp (${l.toFixed(1)}%).`,expected:i,actual:t});let n="PASS";return a.some(c=>c.severity==="critical")?n="FAIL":a.some(c=>c.severity==="warning")&&(n="WARN"),{valid:Math.abs(l)<=r,messages:a,status:n}}function S(e){if(e.economicTier)return e.economicTier;const a=e.racialHD||0,s=e.classLevels||[],i=["Warrior","Expert","Commoner","Adept","Aristocrat"],d=s.filter(n=>!i.includes(n.className)).reduce((n,c)=>n+c.level,0),r=s.filter(n=>i.includes(n.className)).reduce((n,c)=>n+c.level,0);return d>=a&&d>0?"Heroic NPC":r>0?"Basic NPC":"Monster"}function L(e,a){if(a==="Heroic NPC"){const s=v(e);return s<1||s>20?null:y.heroicNpc[s]||null}if(a==="Basic NPC"){const s=v(e);return s<1||s>20?null:y.basicNpc[s]||null}if(a==="Monster"){const s=e.cr,i=M[s];if(!i)return null;let t=i.medium;return e.treasureType==="Double"?t*=2:e.treasureType==="Triple"?t*=3:e.treasureType==="Incidental"?t*=.5:e.treasureType==="None"&&(t=0),t}return null}function v(e){if(e.claimedEffectiveLevel!==void 0)return e.claimedEffectiveLevel;const a=e.racialHD||0,i=(e.classLevels||[]).reduce((t,d)=>t+d.level,0);return a+i}export{E as V,N as a,w as v};
