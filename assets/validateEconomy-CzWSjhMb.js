import{R as n}from"./iframe-Dmi92YQ7.js";import{C,a as $,M,S as w,X as S,W as h,T as D}from"./pf1e-data-tables-BqrvN3By.js";function E(e){const t={critical:0,warning:1,note:2};return[...e].sort((r,s)=>t[r.severity]-t[s.severity])}function L(e,t){const r=t==="fixed"?"Fixed":t==="raw"?"Raw":void 0,s=t==="fixed"?" âž¡":"";return`${e}${r?` (${r})`:""}${s}`}const T=({statBlock:e,validation:t,validationTarget:r})=>{const s=E(t.messages),i=a=>{switch(a){case"critical":return"#ef4444";case"warning":return"#f59e0b";case"note":return"#9ca3af";default:return"#3b82f6"}},u=a=>{switch(a){case"critical":return"#fef2f2";case"warning":return"#fffbeb";case"note":return"#f9fafb";default:return"#eff6ff"}},l=a=>{switch(a){case"critical":return"ðŸ›‘";case"warning":return"âš ï¸";case"note":return"ðŸ“";default:return"â„¹ï¸"}},d=a=>{switch(a){case"PASS":return{backgroundColor:"#dcfce7",color:"#166534",borderColor:"#bbf7d0"};case"FAIL":return{backgroundColor:"#fee2e2",color:"#991b1b",borderColor:"#fecaca"};case"WARN":return{backgroundColor:"#fef9c3",color:"#854d0e",borderColor:"#fde047"};default:return{}}};return n.createElement("div",{style:{padding:"1.5rem",maxWidth:"42rem",margin:"0 auto",fontFamily:"sans-serif",border:"1px solid #e5e7eb",borderRadius:"0.5rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",backgroundColor:"white"}},n.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",borderBottom:"1px solid #e5e7eb",paddingBottom:"1rem",marginBottom:"1rem"}},n.createElement("div",null,n.createElement("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#111827",margin:0}},e.name||"Unnamed"),n.createElement("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:0}},e.size," ",e.type," â€¢ CR ",e.cr_text||e.cr)),n.createElement("span",{title:r==="fixed"?"Validating fixed (auto-fixed) version â€” see right panel":"Validating raw input version",style:{padding:"0.25rem 1rem",borderRadius:"9999px",fontSize:"0.875rem",fontWeight:"bold",border:"1px solid",display:"inline-flex",alignItems:"center",gap:"0.5rem",...d(t.status||"PASS")}},L(t.status||"PASS",r))),n.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"}},s.length===0?n.createElement("div",{style:{textAlign:"center",padding:"2rem",color:"#9ca3af",fontStyle:"italic",border:"2px dashed #e5e7eb",borderRadius:"0.5rem"}},"âœ¨ No issues found. This stat block is mechanically perfect."):s.map((a,c)=>n.createElement("div",{key:c,style:{padding:"0.75rem",borderRadius:"0.25rem",borderLeftWidth:"4px",borderLeftStyle:"solid",border:"1px solid #e5e7eb",borderLeftColor:i(a.severity),backgroundColor:u(a.severity)}},n.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.25rem"}},n.createElement("span",{style:{fontWeight:"bold",display:"flex",alignItems:"center",gap:"0.25rem"}},l(a.severity)," ",a.category.toUpperCase())),n.createElement("p",{style:{color:"#1f2937",margin:0}},a.message),(a.expected!==void 0||a.actual!==void 0)&&n.createElement("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",fontFamily:"monospace",backgroundColor:"rgba(255,255,255,0.5)",padding:"0.25rem",borderRadius:"0.25rem",display:"inline-block"}},a.actual!==void 0&&n.createElement("span",{style:{marginRight:"0.5rem",color:"#dc2626"}},"Found: ",JSON.stringify(a.actual)),a.expected!==void 0&&n.createElement("span",{style:{color:"#16a34a"}},"Expected: ",JSON.stringify(a.expected)))))))};T.__docgenInfo={description:`Traffic Light System (Tiered Reporting)
---------------------------------------------------
This UI component renders validation messages using a 3-tier traffic light system:
 - Critical (ðŸ”´): illegal / structural / must fix -> severity: 'critical'
 - Warning  (ðŸŸ¡): suspicious / review -> severity: 'warning'
 - Note     (âšª): informational / flavor -> severity: 'note'

Design Mode (default): validates the fixed block, but structural errors from the raw block
are merged and always surfaced.
Audit Mode           : validates the raw input only.

The validationTarget prop ("raw" | "fixed") is used to label the badge and the
ARIA/tooltip for accessibility.`,methods:[],displayName:"ValidatorDisplay",props:{statBlock:{required:!0,tsType:{name:"PF1eStatBlock"},description:""},validation:{required:!0,tsType:{name:"ValidationResult"},description:""},validationTarget:{required:!1,tsType:{name:"union",raw:"'raw' | 'fixed'",elements:[{name:"literal",value:"'raw'"},{name:"literal",value:"'fixed'"}]},description:""}}};function P(e){const t=[];let r=!1,s=e.racialHD||0,i=0;if(e.racialHD&&e.racialHD>0){const o=C[e.type];o?o.babProgression==="fast"?i+=e.racialHD:o.babProgression==="medium"?i+=Math.floor(e.racialHD*.75):i+=Math.floor(e.racialHD*.5):i+=Math.floor(e.racialHD*.75)}for(const o of e.classLevels||[]){const f=$[o.className];f&&(s+=o.level,f.babProgression==="fast"?i+=o.level:f.babProgression==="medium"?i+=Math.floor(o.level*.75):i+=Math.floor(o.level*.5))}const u=(e.cr||"").toString(),l=M.find(o=>o.cr===u);if(l){const o=Math.max(1,Math.round((l.hp||1)/4.5)),f=o*2;s>f&&s>=3&&(r=!0,t.push({category:"structure",severity:"critical",message:`HD/CR Mismatch: ${s} Hit Dice is inappropriate for CR ${e.cr}. This HD count suggests a much higher CR than declared and is a structural contradiction.`,expected:`${o} HD (max ${f})`,actual:`${s} HD`}))}const d=w[e.size]||{cmbCmdMod:0},a=Math.floor(((e.str||10)-10)/2),c=Math.floor(((e.dex||10)-10)/2);let v="MATCH";e.bab_claimed!==void 0&&e.bab_claimed!==i&&(v="MISMATCH",r=!0,t.push({category:"basics",severity:"critical",message:`Base Attack Bonus (BAB) +${e.bab_claimed} is illegal for ${s} HD. It must be +${i} according to ${e.type} progression.`,expected:i,actual:e.bab_claimed}));const m=10+i+a+c+d.cmbCmdMod,b=10+(e.bab_claimed||0)+a+c+d.cmbCmdMod;e.cmd_claimed&&(e.cmd_claimed===m||(e.cmd_claimed===b&&v==="MISMATCH"?t.push({category:"basics",severity:"warning",message:`CMD ${e.cmd_claimed} matches the source's (incorrect) BAB of +${e.bab_claimed}. If BAB were corrected to +${i}, CMD would be ${m}.`,expected:m,actual:e.cmd_claimed}):(r=!0,t.push({category:"basics",severity:"critical",message:`Calculated CMD is ${m} (10 + Legal BAB ${i} + Str ${a} + Dex ${c} + Size ${d.cmbCmdMod}), but stat block claims ${e.cmd_claimed}.`,expected:m,actual:e.cmd_claimed}))));const g=Math.ceil(s/2),y=e.feats?.length||0;y<g&&t.push({category:"basics",severity:"warning",message:`Creature has ${s} HD and should have at least ${g} feats, but only lists ${y}.`,expected:g,actual:y});const p=S[e.cr];return p&&e.xp!==p&&(r=!0,t.push({category:"basics",severity:"critical",message:`XP ${e.xp} does not match canonical value ${p} for CR ${e.cr}. (Source: Core Rulebook Experience Point Awards table)`,expected:p,actual:e.xp})),{valid:!r,status:r?"FAIL":t.length>0?"WARN":"PASS",messages:t}}function _(e){const t=[];if(e.gearValue===void 0)return{valid:!0,messages:[{severity:"note",category:"economy",message:"No gear value provided; skipping economy validation."}]};const r=R(e),s=A(e,r);if(s===null)return t.push({severity:"warning",category:"economy",message:`Unable to determine expected wealth for ${r} tier.`}),{valid:!0,messages:t};const i=e.gearValue,l=(i-s)/s*100,d=15;Math.abs(l)<=d?t.push({severity:"note",category:"economy",message:`Wealth is on target for ${r} (${i} gp vs expected ${s} gp).`,expected:s,actual:i}):l>d?t.push({severity:"warning",category:"economy",message:`Over-geared: ${r} has ${i} gp, expected ~${s} gp (+${l.toFixed(1)}%).`,expected:s,actual:i}):t.push({severity:"warning",category:"economy",message:`Under-geared: ${r} has ${i} gp, expected ~${s} gp (${l.toFixed(1)}%).`,expected:s,actual:i});let a="PASS";return t.some(c=>c.severity==="critical")?a="FAIL":t.some(c=>c.severity==="warning")&&(a="WARN"),{valid:Math.abs(l)<=d,messages:t,status:a}}function R(e){if(e.economicTier)return e.economicTier;const t=e.racialHD||0,r=e.classLevels||[],s=["Warrior","Expert","Commoner","Adept","Aristocrat"],u=r.filter(a=>!s.includes(a.className)).reduce((a,c)=>a+c.level,0),d=r.filter(a=>s.includes(a.className)).reduce((a,c)=>a+c.level,0);return u>=t&&u>0?"Heroic NPC":d>0?"Basic NPC":"Monster"}function A(e,t){if(t==="Heroic NPC"){const r=x(e);return r<1||r>20?null:h.heroicNpc[r]||null}if(t==="Basic NPC"){const r=x(e);return r<1||r>20?null:h.basicNpc[r]||null}if(t==="Monster"){const r=e.cr,s=D[r];if(!s)return null;let i=s.medium;return e.treasureType==="Double"?i*=2:e.treasureType==="Triple"?i*=3:e.treasureType==="Incidental"?i*=.5:e.treasureType==="None"&&(i=0),i}return null}function x(e){if(e.claimedEffectiveLevel!==void 0)return e.claimedEffectiveLevel;const t=e.racialHD||0,s=(e.classLevels||[]).reduce((i,u)=>i+u.level,0);return t+s}export{T as V,_ as a,P as v};
