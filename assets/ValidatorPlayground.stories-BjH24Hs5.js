import{r as D,R as l}from"./iframe-Cy3tCZgN.js";import{C as j,b as z,S as q,M as N,X as G,v as J,a as Q,V as Y}from"./validateEconomy-CcT3cuCM.js";import"./preload-helper-PPVm8Dsz.js";function K(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function Z(e){const s=K(e),t={name:s.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},n=s.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);n&&(t.melee_line="Melee "+n[1].trim());const o=s.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);o&&(t.ranged_line="Ranged "+o[1].trim());const u=s.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);u&&(t.speed_line="Speed "+u[1].trim());const h=s.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);h&&(t.special_attacks_line="Special Attacks "+h[1].trim());const c=s.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);c&&(t.spells_block=c[0].trim());const S=s.match(/SPECIAL ABILITIES(.+)$/s);S&&(t.special_abilities_block=`SPECIAL ABILITIES
`+S[1].trim());const g=s.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);g&&(t.skills_line="Skills "+g[1].trim());const y=s.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);y&&(t.languages_line="Languages "+y[1].trim());const i=s.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);i&&(t.equipment_line="Equipment "+i[1].trim());const r=s.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);r&&(t.cr=r[1]);const d=s.match(/XP\s*([0-9,]+)/i);d&&(t.xp=parseInt(d[1].replace(/,/g,"")));const m=s.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(m){t.alignment=m[1],t.size=m[2];const p=m[3].trim();t.subtypes=p.split(/,\s*/).map(W=>W.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?t.type="Outsider":/Dragon/i.test(p)?t.type="Dragon":/Undead/i.test(p)?t.type="Undead":/Beast/i.test(p)?t.type="Magical Beast":t.type=p.split(" ")[0]}const _=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let x;for(;(x=_.exec(s))!==null;)t.classLevels?.push({className:x[1],level:parseInt(x[2])});const $=s.match(/AC\s*(\d+)/i);$&&(t.ac_claimed=parseInt($[1]));const C=s.match(/touch\s*(\d+)/i);C&&(t.touch_ac_claimed=parseInt(C[1]));const E=s.match(/flat-?footed\s*(\d+)/i);E&&(t.flat_footed_ac_claimed=parseInt(E[1]));const v=s.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(v&&(t.hp_claimed=parseInt(v[1]),t.hp=parseInt(v[1]),v[2])){const p=/(\d+)d/.exec(v[2]);p&&(t.racialHD=parseInt(p[1]))}const B=t.classLevels?.reduce((p,W)=>p+W.level,0)||0;t.racialHD===B&&B>0&&(t.racialHD=0);const R=s.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);R&&(t.fort_save_claimed=parseInt(R[1]),t.ref_save_claimed=parseInt(R[2]),t.will_save_claimed=parseInt(R[3]));const w=s.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);w&&(t.bab_claimed=parseInt(w[1]));const T=s.match(/CMD\s*(\d+)/i);T&&(t.cmd_claimed=parseInt(T[1]));const I=/Str\s*(\d+)/i.exec(s),F=/Dex\s*(\d+)/i.exec(s),f=/Con\s*(\d+)/i.exec(s),M=/Int\s*(\d+)/i.exec(s),A=/Wis\s*(\d+)/i.exec(s),b=/Cha\s*(\d+)/i.exec(s);I&&(t.str=parseInt(I[1])),F&&(t.dex=parseInt(F[1])),f&&(t.con=parseInt(f[1])),M&&(t.int=parseInt(M[1])),A&&(t.wis=parseInt(A[1])),b&&(t.cha=parseInt(b[1])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const L=s.match(/Init\s*([+-]?\d+)/i);L&&(t.init_claimed=parseInt(L[1]));const P=s.match(/Perception\s*([+-]?\d+)/i);P&&(t.perception_claimed=parseInt(P[1]));const O=s.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);O&&(t.feats=O[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const V=s.match(/Treasure\s+(.+?)(?:$|\n)/i);if(V){const p=V[1].toLowerCase();p.includes("npc gear")?t.treasureType="NPC Gear":(p.includes("standard"),t.treasureType="Standard")}return t}function X(e){const{name:s,cr:a,xp:t,size:n,type:o}=e,u=e.alignment||"N",h=f=>Math.floor((f-10)/2),c=f=>h(f)>=0?`+${h(f)}`:`${h(f)}`;let S="";const g=e.classLevels?.reduce((f,M)=>f+M.level,0)||0;if(g>0&&(e.racialHD||0)===0){const f=e.classLevels[0],M=j[f.className],A=M?M.hitDieType:8,b=e.classLevels.reduce((L,P)=>L+P.level,0);S=`${b}d${A}+${h(e.con)*b}`}else{const f=e.racialHD||1,A=(z[e.type]||{hitDieType:8}).hitDieType,b=f+g;S=`${b}d${A}+${h(e.con)*b}`}const y=e.classLevels?.map(f=>`${f.className} ${f.level}`).join(", ")||"",i=e.subtypes&&e.subtypes.length>0?e.subtypes.join(", "):o,r=y?`${u} ${n} ${i} ${y}`:`${u} ${n} ${i}`,d=e.melee_line||`Melee weapon +${e.bab_claimed||0} (1d8)`,m=e.ranged_line?`${e.ranged_line}
`:"",_=e.special_attacks_line?`${e.special_attacks_line}
`:"",x=e.spells_block?`${e.spells_block}
`:"",$=e.skills_line?`${e.skills_line}
`:"",C=e.languages_line?`${e.languages_line}
`:"",E=e.equipment_line?`${e.equipment_line}
`:"",v=e.special_abilities_block?`
${e.special_abilities_block}`:"",B=e.speed_line||"Speed 30 ft.",R=e.init_claimed!==void 0?e.init_claimed>=0?`+${e.init_claimed}`:`${e.init_claimed}`:c(e.dex),w=e.perception_claimed!==void 0?e.perception_claimed>=0?`+${e.perception_claimed}`:`${e.perception_claimed}`:"+0",T=q[n]||{cmbCmdMod:0},I=(e.bab_claimed||0)+h(e.str)+T.cmbCmdMod,F=I>=0?`+${I}`:`${I}`;return`
${s}
CR ${a}
XP ${t?.toLocaleString()||"0"}
${r}
Init ${R}; Senses Perception ${w}
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${S})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
${B}
${d}
${m}${_}${x}STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||0}; CMB ${F}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
${$}${C}${E}${v}
`.trim()}function k(e,s="fix_math"){const a=JSON.parse(JSON.stringify(e)),t=[],n=(r,d,m,_)=>{d!=m&&t.push({feature:r,oldValue:d,newValue:m,reason:_})};if(s==="enforce_cr"){const r=N.find(d=>d.cr===a.cr);if(r){const m=(z[a.type]||{hitDieType:8}).hitDieType/2+.5,_=Math.floor(((a.con||10)-10)/2),x=Math.max(1,m+_),$=a.hp_claimed||a.hp;if($>r.hp*1.5){const C=Math.max(1,Math.round(r.hp/x));if((a.classLevels||[]).length===0){const E=a.racialHD;a.racialHD=C;const v=Math.floor(a.racialHD*m)+a.racialHD*_;a.hp=v,a.hp_claimed=v,n("Hit Dice",E,C,`Reduced to match CR ${a.cr} Benchmark`),n("Hit Points",$,v,`Recalculated for ${C} HD`)}}}}let o=0;if(a.racialHD&&a.racialHD>0){const r=z[a.type];let d="medium";r&&(d=r.babProgression),d==="fast"?o+=a.racialHD:d==="medium"?o+=Math.floor(a.racialHD*.75):o+=Math.floor(a.racialHD*.5)}for(const r of a.classLevels||[]){const d=j[r.className];d&&(d.babProgression==="fast"?o+=r.level:d.babProgression==="medium"?o+=Math.floor(r.level*.75):o+=Math.floor(r.level*.5))}(a.racialHD||0)===0&&(a.classLevels||[]).length===0&&(o=a.bab_claimed??a.bab??0);const u=a.bab_claimed??a.bab;o!==u&&(n("Base Attack Bonus",u,o,`Fixed based on ${a.racialHD||0} HD (${a.type}) + Class Levels`),a.bab=o,a.bab_claimed=o);const h=q[a.size]||{cmbCmdMod:0},c=Math.floor(((a.str??10)-10)/2),S=Math.floor(((a.dex??10)-10)/2),g=10+o+c+S+(h.cmbCmdMod||0),y=a.cmd_claimed??a.cmd;if(g!==y&&(n("CMD",y,g,`Recalculated: 10 + BAB(${o}) + Str(${c}) + Dex(${S}) + Size(${h.cmbCmdMod})`),a.cmd=g,a.cmd_claimed=g),s==="fix_math"){const r=a.hp_claimed||a.hp;if(r>0){const d=N.find(m=>m.cr===a.cr);if(d&&r>d.hp*1.5){const m=N.find(_=>r>=_.hp*.85&&r<=_.hp*1.25);m&&(n("Challenge Rating",a.cr,m.cr,`Upgraded to match HP (${r})`),a.cr=m.cr,a.cr_text=m.cr)}}}let i=a.cr_text||a.cr.toString();if(i==="0.5"&&(i="1/2"),(i==="0.33"||i==="0.333")&&(i="1/3"),i==="0.25"&&(i="1/4"),(i==="0.16"||i==="0.166"||i==="0.167")&&(i="1/6"),i==="0.125"&&(i="1/8"),G[i]){const r=G[i];a.xp!==r&&(n("XP Award",a.xp,r,`Standardized for CR ${i}`),a.xp=r)}return{block:a,fixes:t}}function ee(e){const s=[],a=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(a))return{valid:!0,messages:s,status:"PASS"};const t=N.find(c=>c.cr===String(e.cr)||c.cr===e.cr_text);if(!t)return{valid:!0,messages:s,status:"PASS"};const n=e.hp_claimed??e.hp??void 0;if(n!==void 0&&typeof n=="number"){const c=n/t.hp;c<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${n} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):c>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${n} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const o=e.ac_claimed??e.ac??void 0;if(o!==void 0&&typeof o=="number"){const c=o-t.ac;c<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${o} is very low (-${Math.abs(c)}) for CR ${e.cr} (Benchmark: ${t.ac}).`}):c>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${o} is very high (+${c}) for CR ${e.cr} (Benchmark: ${t.ac}).`})}const u=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const c of u)c.val!==void 0&&typeof c.val=="number"&&c.val<t.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${c.name} Save +${c.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!s.some(c=>c.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const te=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,U=()=>{const[e,s]=D.useState(te),[a,t]=D.useState(null),[n,o]=D.useState("fix_math"),[u,h]=D.useState(null),[c,S]=D.useState([]),[g,y]=D.useState(null);return D.useEffect(()=>{if(!e.trim()){t(null),h(null),y(null),S([]);return}try{const i=Z(e);t(i);const r=J(i),d=ee(i),m=Q(i),_={valid:r.valid&&d.valid&&m.valid,status:r.status==="FAIL"||m.status==="FAIL"?"FAIL":r.status==="WARN"||m.status==="WARN"||d.status==="WARN"?"WARN":"PASS",messages:[...r.messages,...d.messages,...m.messages]};y(_);const{block:x,fixes:$}=k(i,n);h(x),S($)}catch(i){console.error(i)}},[e,n]),l.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",height:"100vh",backgroundColor:"#f9fafb",fontFamily:"sans-serif",boxSizing:"border-box"}},l.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",height:"100%"}},l.createElement("h2",{style:{fontWeight:"bold",fontSize:"1.125rem",color:"#374151",margin:0}},"1. Raw Stat Block"),l.createElement("textarea",{style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",outline:"none"},value:e,onChange:i=>s(i.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),l.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column",gap:"1rem"}},l.createElement("div",null,l.createElement("h3",{style:{fontWeight:"bold",fontSize:"1.125rem",marginBottom:"0.5rem",color:"#374151",margin:0}},"2. Rules Lawyer Audit"),a&&g?l.createElement(Y,{statBlock:a,validation:g}):null),c.length>0&&l.createElement("div",{style:{backgroundColor:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:"0.5rem",padding:"1rem"}},l.createElement("h4",{style:{fontWeight:"bold",color:"#1e40af",marginBottom:"0.5rem",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem",margin:0}},"ðŸ› ï¸ Auto-Fixes Applied (",n==="fix_math"?"Audit Mode":"Design Mode",")"),l.createElement("ul",{style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"0.5rem"}},c.map((i,r)=>l.createElement("li",{key:r,style:{fontSize:"0.75rem",color:"#1e3a8a"}},l.createElement("div",{style:{fontWeight:600}},i.feature),l.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.125rem"}},l.createElement("span",{style:{textDecoration:"line-through",opacity:.6}},i.oldValue),l.createElement("span",null,"â†’"),l.createElement("span",{style:{fontWeight:"bold",backgroundColor:"white",padding:"0 0.25rem",borderRadius:"0.25rem",border:"1px solid #dbeafe"}},i.newValue)),l.createElement("div",{style:{color:"#3b82f6",fontStyle:"italic",marginTop:"0.125rem"}},i.reason)))))),l.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%"}},l.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},l.createElement("h2",{style:{fontWeight:"bold",fontSize:"1.125rem",color:"#374151",margin:0}},"3. Auto-Fixed Version"),l.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},l.createElement("button",{onClick:()=>o("fix_math"),style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",transition:"all 0.2s",border:"none",cursor:"pointer",backgroundColor:n==="fix_math"?"white":"transparent",color:n==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:n==="fix_math"?"bold":"normal",boxShadow:n==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none"},title:"Trust Stats, Update CR"},"Fix Math"),l.createElement("button",{onClick:()=>o("enforce_cr"),style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",transition:"all 0.2s",border:"none",cursor:"pointer",backgroundColor:n==="enforce_cr"?"white":"transparent",color:n==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:n==="enforce_cr"?"bold":"normal",boxShadow:n==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none"},title:"Trust CR, Downgrade Stats"},"Enforce CR"))),l.createElement("div",{style:{flex:1,backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.25rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",padding:"1rem",overflowY:"auto",marginTop:"0.5rem"}},u?l.createElement("pre",{style:{fontSize:"0.75rem",fontFamily:"monospace",whiteSpace:"pre-wrap",color:"#1f2937",margin:0}},X(u)):l.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),l.createElement("button",{onClick:()=>u&&navigator.clipboard.writeText(X(u)),style:{marginTop:"0.5rem",width:"100%",padding:"0.5rem",backgroundColor:"#16a34a",color:"white",fontWeight:"bold",borderRadius:"0.25rem",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",border:"none",cursor:"pointer"}},"ðŸ“‹ Copy to Clipboard")))};U.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const re={title:"Validators/Rules Lawyer Workbench",component:U,parameters:{layout:"fullscreen"}},H={};H.parameters={...H.parameters,docs:{...H.parameters?.docs,source:{originalSource:"{}",...H.parameters?.docs?.source}}};const ne=["InteractiveWorkbench"];export{H as InteractiveWorkbench,ne as __namedExportsOrder,re as default};
