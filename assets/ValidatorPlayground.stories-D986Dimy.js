import{r as m,R as a}from"./iframe-Dmi92YQ7.js";import{s as H,f as V}from"./pf1e-formatter-rxhD__3t.js";import{a as X,v as z}from"./validateBenchmarks-BezZg9qS.js";import{X as U}from"./pf1e-data-tables-BqrvN3By.js";import{v as G,a as q,V as Q}from"./validateEconomy-CzWSjhMb.js";import"./preload-helper-PPVm8Dsz.js";function $(d){return d.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function J(d){const t=$(d),e={name:t.split(`
`).map(s=>s.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},f=t.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);f&&(e.melee_line="Melee "+f[1].trim());const v=t.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);v&&(e.ranged_line="Ranged "+v[1].trim());const c=t.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);c&&(e.speed_line="Speed "+c[1].trim());const x=t.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);x&&(e.special_attacks_line="Special Attacks "+x[1].trim());const p=t.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);p&&(e.spells_block=p[0].trim());const C=t.match(/SPECIAL ABILITIES(.+)$/s);C&&(e.special_abilities_block=`SPECIAL ABILITIES
`+C[1].trim());const b=t.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);b&&(e.skills_line="Skills "+b[1].trim());const k=t.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);k&&(e.languages_line="Languages "+k[1].trim());const y=t.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);y&&(e.equipment_line="Equipment "+y[1].trim());const I=t.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);I&&(e.cr=I[1]);const r=t.match(/XP\s*([0-9,]+)/i);r&&(e.xp=parseInt(r[1].replace(/,/g,"")));const l=t.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(l){e.alignment=l[1],e.size=l[2];const s=l[3].trim();e.subtypes=s.split(/,\s*/).map(i=>i.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(s)?e.type="Outsider":/Dragon/i.test(s)?e.type="Dragon":/Undead/i.test(s)?e.type="Undead":/Beast/i.test(s)?e.type="Magical Beast":e.type=s.split(" ")[0]}const R=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let h;for(;(h=R.exec(t))!==null;)e.classLevels?.push({className:h[1],level:parseInt(h[2])});const M=t.match(/AC\s*(\d+)/i);M&&(e.ac_claimed=parseInt(M[1]));const B=t.match(/touch\s*(\d+)/i);B&&(e.touch_ac_claimed=parseInt(B[1]));const D=t.match(/flat-?footed\s*(\d+)/i);D&&(e.flat_footed_ac_claimed=parseInt(D[1]));const u=t.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(u&&(e.hp_claimed=parseInt(u[1]),e.hp=parseInt(u[1]),u[2])){const s=/(\d+)d/.exec(u[2]);s&&(e.racialHD=parseInt(s[1]))}const P=e.classLevels?.reduce((s,i)=>s+i.level,0)||0;e.racialHD===P&&P>0&&(e.racialHD=0);const E=t.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);E&&(e.fort_save_claimed=parseInt(E[1]),e.ref_save_claimed=parseInt(E[2]),e.will_save_claimed=parseInt(E[3]));const g=t.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);g&&(e.bab_claimed=parseInt(g[1]));const S=t.match(/CMD\s*(\d+)/i);S&&(e.cmd_claimed=parseInt(S[1]));const o=(s,i)=>{const W=new RegExp(`${i}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),F=s.match(W);if(!F)return 10;const L=F[1];return/\d/.test(L)?parseInt(L):0};e.str=o(t,"Str"),e.dex=o(t,"Dex"),e.con=o(t,"Con"),e.int=o(t,"Int"),e.wis=o(t,"Wis"),e.cha=o(t,"Cha"),e.ac_claimed&&(e.ac=e.ac_claimed),e.touch_ac_claimed&&(e.touch=e.touch_ac_claimed),e.flat_footed_ac_claimed&&(e.flatFooted=e.flat_footed_ac_claimed);const _=t.match(/Init\s*([+-]?\d+)/i);_&&(e.init_claimed=parseInt(_[1]));const w=t.match(/Perception\s*([+-]?\d+)/i);w&&(e.perception_claimed=parseInt(w[1]));const A=t.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);A&&(e.feats=A[1].split(/[,;]/).map(s=>s.trim()).filter(Boolean));const N=t.match(/Treasure\s+(.+?)(?:$|\n)/i);if(N){const s=N[1].toLowerCase();s.includes("npc gear")?e.treasureType="NPC Gear":(s.includes("standard"),e.treasureType="Standard")}return e}const K=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,O=()=>{const[d,t]=m.useState(K),[n,e]=m.useState(null),[f,v]=m.useState(1),[c,x]=m.useState("enforce_cr"),[p,C]=m.useState(null),[b,k]=m.useState([]),[y,I]=m.useState(null);return m.useEffect(()=>{if(!d.trim()){e(null),C(null),I(null),k([]);return}try{const r=J(d);e(r);const l=parseInt(r.cr)||1;v(l)}catch(r){console.error(r)}},[d]),m.useEffect(()=>{if(!n)return;let r=JSON.parse(JSON.stringify(n));const l=[],R=n.cr,h=f.toString();if(R!==h){const i=U[h];if(i){const{block:W,changes:F}=H(r,i);r=W,F.forEach(L=>l.push({feature:"Creature Scaler",oldValue:R,newValue:h,reason:L}))}}const{block:M,fixes:B}=X(r,c);C(M),k([...l,...B]);const u=G(n).messages.filter(i=>i.category==="structure"),E=z(n).messages.filter(i=>i.severity!=="note"),g=c==="enforce_cr"?M:n;let S={status:"PASS",messages:[]},o={status:"PASS",messages:[]},_={status:"PASS",messages:[]};g&&(S=G(g),o=z(g),_=q(g));const w=[...u,...E,...S.messages,...o.messages,..._.messages],A=u.some(i=>i.severity==="critical"),N=S.status==="FAIL"||_.status==="FAIL",s={valid:!A&&!N,status:A||N?"FAIL":S.status==="WARN"||_.status==="WARN"||o.status==="WARN"?"WARN":"PASS",messages:w};I(s)},[n,f,c]),a.createElement("div",{className:"validator-playground"},a.createElement("div",{className:"validator-column"},a.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),a.createElement("textarea",{className:"validator-textarea",value:d,onChange:r=>t(r.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),a.createElement("div",{className:"validator-scroll-area"},a.createElement("div",null,a.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v3.0)"),a.createElement("div",{style:{fontSize:"0.85rem",color:"#6b7280",marginBottom:"0.5rem"}},"Validating: ",c==="enforce_cr"?"Auto-Fixed Version (Design Mode)":"Raw Input (Audit Mode)"),n&&y?a.createElement(Q,{statBlock:c==="enforce_cr"?p:n,validation:y,validationTarget:c==="enforce_cr"?"fixed":"raw"}):null),b.length>0&&a.createElement("div",{className:"fix-report"},a.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",c==="fix_math"?"Audit Mode":"Design Mode",")"),a.createElement("ul",{className:"fix-list"},b.map((r,l)=>a.createElement("li",{key:l,className:"fix-item"},a.createElement("div",{style:{fontWeight:600}},r.feature),a.createElement("div",{className:"fix-change-row"},a.createElement("span",{className:"fix-old"},r.oldValue),a.createElement("span",null,"â†’"),a.createElement("span",{className:"fix-new"},r.newValue)),a.createElement("div",{className:"fix-reason"},r.reason)))))),a.createElement("div",{className:"validator-column"},a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},a.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),a.createElement("div",{className:"mode-toggle",style:{display:"flex",alignItems:"center",gap:"1rem"}},a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"}},a.createElement("label",{htmlFor:"cr-slider",style:{fontSize:"0.75rem",fontWeight:"bold",color:"#4b5563"}},"Target CR: ",f),a.createElement("input",{id:"cr-slider",type:"range",min:"1",max:"20",value:f,onChange:r=>v(parseInt(r.target.value)),style:{width:"100px"}})),a.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},a.createElement("button",{onClick:()=>x("enforce_cr"),style:{backgroundColor:c==="enforce_cr"?"white":"transparent",color:c==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:c==="enforce_cr"?"bold":"normal",boxShadow:c==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep CR, Downgrade Stats"},"Design Mode (Enforce CR)"),a.createElement("button",{onClick:()=>x("fix_math"),style:{backgroundColor:c==="fix_math"?"white":"transparent",color:c==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:c==="fix_math"?"bold":"normal",boxShadow:c==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep Stats, Update CR"},"Audit Mode (Fix Math)")))),a.createElement("div",{className:"output-area"},p?a.createElement("pre",{className:"output-pre"},V(p)):a.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),a.createElement("button",{onClick:()=>p&&navigator.clipboard.writeText(V(p)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};O.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const se={title:"Validators/Rules Lawyer Workbench",component:O,parameters:{layout:"fullscreen"}},T={};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:"{}",...T.parameters?.docs?.source}}};const re=["InteractiveWorkbench"];export{T as InteractiveWorkbench,re as __namedExportsOrder,se as default};
