import{r as I,R as n}from"./iframe-BRzSImvC.js";import{C as L,S as V,X as N,M as O,v as G}from"./validateBasics-B8TiwF7x.js";import"./preload-helper-PPVm8Dsz.js";function D(e){const t={name:e.split(`
`).map(d=>d.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"humanoid"},r=/(?:CR|Challenge Rating)\s*(\d+(?:\/\d+)?)/i,c=/XP\s*([0-9,]+)/i,o=/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\s]+)/i,f=/AC\s*(\d+)/i,p=/touch\s*(\d+)/i,a=/flat-footed\s*(\d+)/i,m=/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/i,i=/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i,h=/Str\s*(\d+),\s*Dex\s*(\d+),\s*Con\s*(\d+),\s*Int\s*(\d+),\s*Wis\s*(\d+),\s*Cha\s*(\d+)/i,u=/Base Atk\s*\+?(\d+)/i,g=/CMD\s*(\d+)/i,W=/Feats\s+(.+?)(?:Skills|Treasure|Languages|SQ|Ecology|$)/i,H=/Treasure\s+(.+?)(?:$|\n)/i;let l=e.replace(/\n/g," ");const R=l.match(r);R&&(t.cr=R[1]);const E=l.match(c);E&&(t.xp=parseInt(E[1].replace(/,/g,"")));const x=l.match(o);x&&(t.size=x[2],t.type=x[3].trim());const M=l.match(f);M&&(t.ac_claimed=parseInt(M[1]));const F=l.match(p);F&&(t.touch_ac_claimed=parseInt(F[1]));const T=l.match(a);T&&(t.flat_footed_ac_claimed=parseInt(T[1]));const _=l.match(m);if(_){t.hp_claimed=parseInt(_[1]),t.hp=parseInt(_[1]);const d=_[2];if(d){const P=/(\d+)d/.exec(d);P&&(t.racialHD=parseInt(P[1]))}}const y=l.match(i);y&&(t.fort_save_claimed=parseInt(y[1]),t.fort=parseInt(y[1]),t.ref_save_claimed=parseInt(y[2]),t.ref=parseInt(y[2]),t.will_save_claimed=parseInt(y[3]),t.will=parseInt(y[3]));const $=l.match(u);$&&(t.bab_claimed=parseInt($[1]),t.bab=parseInt($[1]));const C=l.match(g);C&&(t.cmd_claimed=parseInt(C[1]),t.cmd=parseInt(C[1]));const v=l.match(h);v&&(t.str=parseInt(v[1]),t.dex=parseInt(v[2]),t.con=parseInt(v[3]),t.int=parseInt(v[4]),t.wis=parseInt(v[5]),t.cha=parseInt(v[6])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const w=l.match(W);w&&(t.feats=w[1].split(",").map(d=>d.trim().replace(/[;.]$/,"")));const B=l.match(H);if(B){const d=B[1].toLowerCase();d.includes("npc gear")?t.treasureType="NPC Gear":d.includes("standard")?t.treasureType="Standard":d.includes("double")?t.treasureType="Double":d.includes("triple")?t.treasureType="Triple":d.includes("incidental")?t.treasureType="Incidental":d.includes("none")&&(t.treasureType="None")}return t}function X(e){const{name:s,cr:t,xp:r,size:c,type:o}=e,f=e.alignment||"N",p=t,a=u=>Math.floor((u-10)/2),m=u=>{const g=a(u);return g>=0?`+${g}`:`${g}`},h=`${e.racialHD||1}d8+${a(e.con)}`;return`
${s}
CR ${p}
XP ${r?.toLocaleString()||"0"}
${f} ${c} ${o}
Init ${m(e.dex)}; Senses Perception +0
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||e.touch||10}, flat-footed ${e.flat_footed_ac_claimed||e.flatFooted||10}
hp ${e.hp_claimed||e.hp} (${h})
Fort +${e.fort_save_claimed||e.fort}, Ref +${e.ref_save_claimed||e.ref}, Will +${e.will_save_claimed||e.will}
OFFENSE
Speed 30 ft.
Melee weapon +${e.bab_claimed||e.bab} (1d8)
STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||e.bab}; CMB +${(e.bab_claimed||e.bab)+a(e.str)}; CMD ${e.cmd_claimed||e.cmd||10}
Feats ${e.feats?.join(", ")||"None"}
Treasure ${e.treasureType||"Standard"}
`.trim()}function A(e){const s=JSON.parse(JSON.stringify(e));let t=s.racialHD||0,r=0;for(const a of s.classLevels||[]){const m=L[a.className];m&&(t+=a.level,m.babProgression==="Fast"?r+=a.level:m.babProgression==="Medium"?r+=Math.floor(a.level*.75):r+=Math.floor(a.level*.5))}s.bab_claimed=r,s.bab=r;const c=V[s.size]||{special_cmb_cmd:0},o=Math.floor((s.str-10)/2),f=Math.floor((s.dex-10)/2);s.cmd_claimed=10+r+o+f+c.special_cmb_cmd,s.cmd=s.cmd_claimed;let p=s.cr;return N[p]&&(s.xp=N[p]),s}function J(e){const s=[],t=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(t))return{valid:!0,messages:s,status:"PASS"};const r=O.find(a=>a.cr===String(e.cr)||a.cr===e.cr_text);if(!r)return{valid:!0,messages:s,status:"PASS"};const c=e.hp_claimed??e.hp??void 0;if(c!==void 0&&typeof c=="number"){const a=c/r.hp;a<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${c} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${r.hp}). Creature is a "Glass Jaw".`}):a>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${c} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${r.hp}). It may be a "Damage Sponge".`})}const o=e.ac_claimed??e.ac??void 0;if(o!==void 0&&typeof o=="number"){const a=o-r.ac;a<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${o} is very low (-${Math.abs(a)}) for CR ${e.cr} (Benchmark: ${r.ac}).`}):a>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${o} is very high (+${a}) for CR ${e.cr} (Benchmark: ${r.ac}).`})}const f=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const a of f)a.val!==void 0&&typeof a.val=="number"&&a.val<r.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${a.name} Save +${a.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${r.poorSave}).`});return{valid:!s.some(a=>a.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const b=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,z=()=>{const[e,s]=I.useState(b),[t,r]=I.useState(()=>A(D(b))),[c,o]=I.useState([]),f=a=>{const m=a.currentTarget.value;s(m);try{const i=D(m),h=A(i);r(h);const u=G(i),g=J(i);o([u,g])}catch(i){console.error("Parse error:",i)}},p=a=>{switch(a){case"error":return"#dc2626";case"warning":return"#ea580c";case"info":return"#2563eb"}};return n.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",fontFamily:"system-ui, sans-serif",height:"100vh",boxSizing:"border-box"}},n.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},n.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"ðŸ“ Raw Stat Block"),n.createElement("textarea",{value:e,onChange:f,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",lineHeight:1.5},spellCheck:!1})),n.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",overflow:"auto"}},n.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âš–ï¸ Validation Results"),n.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},c.map((a,m)=>n.createElement("div",{key:m,style:{border:"1px solid #d1d5db",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f9fafb"}},n.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem"}},a.messages[0]?.category||"Validation"),a.messages.length===0?n.createElement("div",{style:{color:"#059669",fontWeight:500}},"âœ“ PASS"):n.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},a.messages.map((i,h)=>n.createElement("li",{key:h,style:{color:p(i.severity),marginBottom:"0.25rem",fontSize:"0.875rem"}},n.createElement("strong",null,i.severity.toUpperCase(),":")," ",i.message,i.expected!==void 0&&n.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:"#6b7280"}},"Expected: ",JSON.stringify(i.expected)," | Actual: ",JSON.stringify(i.actual))))))))),n.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},n.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âœ¨ Auto-Fixed Version"),n.createElement("textarea",{value:X(t),readOnly:!0,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #10b981",borderRadius:"0.375rem",resize:"none",backgroundColor:"#f0fdf4",lineHeight:1.5},spellCheck:!1})))};z.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const Q={title:"Validators/Rules Lawyer Workbench",component:z,parameters:{layout:"fullscreen"}},S={};S.parameters={...S.parameters,docs:{...S.parameters?.docs,source:{originalSource:"{}",...S.parameters?.docs?.source}}};const Z=["InteractiveWorkbench"];export{S as InteractiveWorkbench,Z as __namedExportsOrder,Q as default};
