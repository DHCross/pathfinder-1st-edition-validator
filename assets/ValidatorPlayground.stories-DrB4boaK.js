import{r as R,R as r}from"./iframe-B2JClXEg.js";import{C as G,b,S as X,M as H,X as z,v as U,a as j,V as J}from"./validateEconomy-CxAYavmt.js";import"./preload-helper-PPVm8Dsz.js";function Q(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function K(e){const s=Q(e),t={name:s.split(`
`).map(d=>d.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=s.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(t.melee_line="Melee "+o[1].trim());const l=s.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);l&&(t.ranged_line="Ranged "+l[1].trim());const h=s.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);h&&(t.speed_line="Speed "+h[1].trim());const u=s.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);u&&(t.special_attacks_line="Special Attacks "+u[1].trim());const n=s.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);n&&(t.spells_block=n[0].trim());const v=s.match(/SPECIAL ABILITIES(.+)$/s);v&&(t.special_abilities_block=`SPECIAL ABILITIES
`+v[1].trim());const _=s.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);_&&(t.skills_line="Skills "+_[1].trim());const $=s.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);$&&(t.languages_line="Languages "+$[1].trim());const c=s.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);c&&(t.equipment_line="Equipment "+c[1].trim());const i=s.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);i&&(t.cr=i[1]);const p=s.match(/XP\s*([0-9,]+)/i);p&&(t.xp=parseInt(p[1].replace(/,/g,"")));const m=s.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(m){t.alignment=m[1],t.size=m[2];const d=m[3].trim();t.subtypes=d.split(/,\s*/).map(C=>C.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(d)?t.type="Outsider":/Dragon/i.test(d)?t.type="Dragon":/Undead/i.test(d)?t.type="Undead":/Beast/i.test(d)?t.type="Magical Beast":t.type=d.split(" ")[0]}const g=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let S;for(;(S=g.exec(s))!==null;)t.classLevels?.push({className:S[1],level:parseInt(S[2])});const x=s.match(/AC\s*(\d+)/i);x&&(t.ac_claimed=parseInt(x[1]));const D=s.match(/touch\s*(\d+)/i);D&&(t.touch_ac_claimed=parseInt(D[1]));const N=s.match(/flat-?footed\s*(\d+)/i);N&&(t.flat_footed_ac_claimed=parseInt(N[1]));const y=s.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(y&&(t.hp_claimed=parseInt(y[1]),t.hp=parseInt(y[1]),y[2])){const d=/(\d+)d/.exec(y[2]);d&&(t.racialHD=parseInt(d[1]))}const B=t.classLevels?.reduce((d,C)=>d+C.level,0)||0;t.racialHD===B&&B>0&&(t.racialHD=0);const I=s.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);I&&(t.fort_save_claimed=parseInt(I[1]),t.ref_save_claimed=parseInt(I[2]),t.will_save_claimed=parseInt(I[3]));const T=s.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);T&&(t.bab_claimed=parseInt(T[1]));const L=s.match(/CMD\s*(\d+)/i);L&&(t.cmd_claimed=parseInt(L[1]));const M=(d,C)=>{const W=new RegExp(`${C}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),F=d.match(W);if(!F)return 10;const O=F[1];return/\d/.test(O)?parseInt(O):0};t.str=M(s,"Str"),t.dex=M(s,"Dex"),t.con=M(s,"Con"),t.int=M(s,"Int"),t.wis=M(s,"Wis"),t.cha=M(s,"Cha"),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const P=s.match(/Init\s*([+-]?\d+)/i);P&&(t.init_claimed=parseInt(P[1]));const E=s.match(/Perception\s*([+-]?\d+)/i);E&&(t.perception_claimed=parseInt(E[1]));const f=s.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);f&&(t.feats=f[1].split(/[,;]/).map(d=>d.trim()).filter(Boolean));const A=s.match(/Treasure\s+(.+?)(?:$|\n)/i);if(A){const d=A[1].toLowerCase();d.includes("npc gear")?t.treasureType="NPC Gear":(d.includes("standard"),t.treasureType="Standard")}return t}function V(e){const{name:s,cr:a,xp:t,size:o,type:l}=e,h=e.alignment||"N",u=f=>Math.floor((f-10)/2),n=f=>u(f)>=0?`+${u(f)}`:`${u(f)}`;let v="";const _=e.classLevels?.reduce((f,A)=>f+A.level,0)||0;if(_>0&&(e.racialHD||0)===0){const f=e.classLevels[0],A=G[f.className],d=A?A.hitDieType:8,C=e.classLevels.reduce((W,F)=>W+F.level,0);v=`${C}d${d}+${u(e.con)*C}`}else{const f=e.racialHD||1,d=(b[e.type]||{hitDieType:8}).hitDieType,C=f+_;v=`${C}d${d}+${u(e.con)*C}`}const $=e.classLevels?.map(f=>`${f.className} ${f.level}`).join(", ")||"",c=e.subtypes&&e.subtypes.length>0?e.subtypes.join(", "):l,i=$?`${h} ${o} ${c} ${$}`:`${h} ${o} ${c}`,p=e.melee_line||`Melee weapon +${e.bab_claimed||0} (1d8)`,m=e.ranged_line?`${e.ranged_line}
`:"",g=e.special_attacks_line?`${e.special_attacks_line}
`:"",S=e.spells_block?`${e.spells_block}
`:"",x=e.skills_line?`${e.skills_line}
`:"",D=e.languages_line?`${e.languages_line}
`:"",N=e.equipment_line?`${e.equipment_line}
`:"",y=e.special_abilities_block?`
${e.special_abilities_block}`:"",B=e.speed_line||"Speed 30 ft.",I=e.init_claimed!==void 0?e.init_claimed>=0?`+${e.init_claimed}`:`${e.init_claimed}`:n(e.dex),T=e.perception_claimed!==void 0?e.perception_claimed>=0?`+${e.perception_claimed}`:`${e.perception_claimed}`:"+0",L=X[o]||{cmbCmdMod:0},M=(e.bab_claimed||0)+u(e.str)+L.cmbCmdMod,P=M>=0?`+${M}`:`${M}`,E=f=>f===0?"â€”":f.toString();return`
${s}
CR ${a}
XP ${t?.toLocaleString()||"0"}
${i}
Init ${I}; Senses Perception ${T}
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${v})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
${B}
${p}
${m}${g}${S}STATISTICS
Str ${E(e.str)}, Dex ${E(e.dex)}, Con ${E(e.con)}, Int ${E(e.int)}, Wis ${E(e.wis)}, Cha ${E(e.cha)}
Base Atk +${e.bab_claimed||0}; CMB ${P}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
${x}${D}${N}${y}
`.trim()}function Z(e,s="fix_math"){const a=JSON.parse(JSON.stringify(e)),t=[],o=(i,p,m,g)=>{p!=m&&t.push({feature:i,oldValue:p,newValue:m,reason:g})};if(s==="enforce_cr"){const i=H.find(p=>p.cr===a.cr);if(i){const m=(b[a.type]||{hitDieType:8}).hitDieType/2+.5,g=Math.floor(((a.con||10)-10)/2),S=Math.max(1,m+g),x=a.hp_claimed||a.hp;if(x>i.hp*1.5){const D=Math.max(1,Math.round(i.hp/S));if((a.classLevels||[]).length===0){const N=a.racialHD;a.racialHD=D;const y=Math.floor(a.racialHD*m)+a.racialHD*g;a.hp=y,a.hp_claimed=y,o("Hit Dice",N,D,`Reduced to match CR ${a.cr} Benchmark`),o("Hit Points",x,y,`Recalculated for ${D} HD`)}}}}let l=0;if(a.racialHD&&a.racialHD>0){const i=b[a.type];let p="medium";i&&(p=i.babProgression),p==="fast"?l+=a.racialHD:p==="medium"?l+=Math.floor(a.racialHD*.75):l+=Math.floor(a.racialHD*.5)}for(const i of a.classLevels||[]){const p=G[i.className];p&&(p.babProgression==="fast"?l+=i.level:p.babProgression==="medium"?l+=Math.floor(i.level*.75):l+=Math.floor(i.level*.5))}(a.racialHD||0)===0&&(a.classLevels||[]).length===0&&(l=a.bab_claimed??a.bab??0);const h=a.bab_claimed??a.bab;l!==h&&(o("Base Attack Bonus",h,l,`Fixed based on ${a.racialHD||0} HD (${a.type}) + Class Levels`),a.bab=l,a.bab_claimed=l);const u=X[a.size]||{cmbCmdMod:0},n=Math.floor(((a.str??10)-10)/2),v=Math.floor(((a.dex??10)-10)/2),_=10+l+n+v+(u.cmbCmdMod||0),$=a.cmd_claimed??a.cmd;if(_!==$&&(o("CMD",$,_,`Recalculated: 10 + BAB(${l}) + Str(${n}) + Dex(${v}) + Size(${u.cmbCmdMod})`),a.cmd=_,a.cmd_claimed=_),s==="fix_math"){const i=a.hp_claimed||a.hp;if(i>0){const p=H.find(m=>m.cr===a.cr);if(p&&i>p.hp*1.5){const m=H.find(g=>i>=g.hp*.85&&i<=g.hp*1.25);m&&(o("Challenge Rating",a.cr,m.cr,`Upgraded to match HP (${i})`),a.cr=m.cr,a.cr_text=m.cr)}}}let c=a.cr_text||a.cr.toString();if(c==="0.5"&&(c="1/2"),(c==="0.33"||c==="0.333")&&(c="1/3"),c==="0.25"&&(c="1/4"),(c==="0.16"||c==="0.166"||c==="0.167")&&(c="1/6"),c==="0.125"&&(c="1/8"),z[c]){const i=z[c];a.xp!==i&&(o("XP Award",a.xp,i,`Standardized for CR ${c}`),a.xp=i)}return{block:a,fixes:t}}function Y(e){const s=[],a=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(a))return{valid:!0,messages:s,status:"PASS"};const t=H.find(n=>n.cr===String(e.cr)||n.cr===e.cr_text);if(!t)return{valid:!0,messages:s,status:"PASS"};const o=e.hp_claimed??e.hp??void 0;if(o!==void 0&&typeof o=="number"){const n=o/t.hp;n<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${o} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):n>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${o} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const l=e.ac_claimed??e.ac??void 0;if(l!==void 0&&typeof l=="number"){const n=l-t.ac;n<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very low (-${Math.abs(n)}) for CR ${e.cr} (Benchmark: ${t.ac}).`}):n>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very high (+${n}) for CR ${e.cr} (Benchmark: ${t.ac}).`})}const h=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const n of h)n.val!==void 0&&typeof n.val=="number"&&n.val<t.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${n.name} Save +${n.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!s.some(n=>n.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const k=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,q=()=>{const[e,s]=R.useState(k),[a,t]=R.useState(null),[o,l]=R.useState("fix_math"),[h,u]=R.useState(null),[n,v]=R.useState([]),[_,$]=R.useState(null);return R.useEffect(()=>{if(!e.trim()){t(null),u(null),$(null),v([]);return}try{const c=K(e);t(c);const{block:i,fixes:p}=Z(c,o);u(i),v(p);const m=U(i),g=Y(i),S=j(i),x={valid:m.valid&&g.valid&&S.valid,status:m.status==="FAIL"||S.status==="FAIL"?"FAIL":m.status==="WARN"||S.status==="WARN"||g.status==="WARN"?"WARN":"PASS",messages:[...m.messages,...g.messages,...S.messages]};$(x)}catch(c){console.error(c)}},[e,o]),r.createElement("div",{className:"validator-playground"},r.createElement("div",{className:"validator-column"},r.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),r.createElement("textarea",{className:"validator-textarea",value:e,onChange:c=>s(c.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"validator-scroll-area"},r.createElement("div",null,r.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v2)"),a&&_?r.createElement(J,{statBlock:a,validation:_}):null),n.length>0&&r.createElement("div",{className:"fix-report"},r.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",o==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"fix-list"},n.map((c,i)=>r.createElement("li",{key:i,className:"fix-item"},r.createElement("div",{style:{fontWeight:600}},c.feature),r.createElement("div",{className:"fix-change-row"},r.createElement("span",{className:"fix-old"},c.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"fix-new"},c.newValue)),r.createElement("div",{className:"fix-reason"},c.reason)))))),r.createElement("div",{className:"validator-column"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},r.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),r.createElement("div",{className:"mode-toggle"},r.createElement("button",{onClick:()=>l("fix_math"),className:`mode-btn ${o==="fix_math"?"active":"inactive"}`,title:"Trust Stats, Update CR"},"Fix Math"),r.createElement("button",{onClick:()=>l("enforce_cr"),className:`mode-btn ${o==="enforce_cr"?"active":"inactive"}`,title:"Trust CR, Downgrade Stats"},"Enforce CR"))),r.createElement("div",{className:"output-area"},h?r.createElement("pre",{className:"output-pre"},V(h)):r.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),r.createElement("button",{onClick:()=>h&&navigator.clipboard.writeText(V(h)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};q.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const se={title:"Validators/Rules Lawyer Workbench",component:q,parameters:{layout:"fullscreen"}},w={};w.parameters={...w.parameters,docs:{...w.parameters?.docs,source:{originalSource:"{}",...w.parameters?.docs?.source}}};const ie=["InteractiveWorkbench"];export{w as InteractiveWorkbench,ie as __namedExportsOrder,se as default};
