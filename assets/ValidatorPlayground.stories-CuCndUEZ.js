import{r as A,R as c}from"./iframe-BCo0Amne.js";import{s as J,f as G}from"./pf1e-formatter-rxhD__3t.js";import{M as W,C as z,a as q,S as K,X as V}from"./pf1e-data-tables-BqrvN3By.js";import{v as O,a as Q}from"./validateEconomy-6D0WuLcc.js";import{v as X}from"./validateBenchmarks-B3-agmKT.js";import{V as j}from"./ValidatorDisplay-CSKE2MNl.js";import"./preload-helper-PPVm8Dsz.js";function Z(x){return x.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function Y(x){const a=Z(x),t={name:a.split(`
`).map(s=>s.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},f=a.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);f&&(t.melee_line="Melee "+f[1].trim());const d=a.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);d&&(t.ranged_line="Ranged "+d[1].trim());const m=a.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);m&&(t.speed_line="Speed "+m[1].trim());const g=a.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);g&&(t.special_attacks_line="Special Attacks "+g[1].trim());const u=a.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);u&&(t.spells_block=u[0].trim());const y=a.match(/SPECIAL ABILITIES(.+)$/s);y&&(t.special_abilities_block=`SPECIAL ABILITIES
`+y[1].trim());const b=a.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);b&&(t.skills_line="Skills "+b[1].trim());const D=a.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);D&&(t.languages_line="Languages "+D[1].trim());const E=a.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);E&&(t.equipment_line="Equipment "+E[1].trim());const B=a.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);B&&(t.cr=B[1]);const l=a.match(/XP\s*([0-9,]+)/i);l&&(t.xp=parseInt(l[1].replace(/,/g,"")));const p=a.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(p){t.alignment=p[1],t.size=p[2];const s=p[3].trim();t.subtypes=s.split(/,\s*/).map(n=>n.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(s)?t.type="Outsider":/Dragon/i.test(s)?t.type="Dragon":/Undead/i.test(s)?t.type="Undead":/Beast/i.test(s)?t.type="Magical Beast":t.type=s.split(" ")[0]}const I=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let S;for(;(S=I.exec(a))!==null;)t.classLevels?.push({className:S[1],level:parseInt(S[2])});const M=a.match(/AC\s*(\d+)/i);M&&(t.ac_claimed=parseInt(M[1]));const R=a.match(/touch\s*(\d+)/i);R&&(t.touch_ac_claimed=parseInt(R[1]));const w=a.match(/flat-?footed\s*(\d+)/i);w&&(t.flat_footed_ac_claimed=parseInt(w[1]));const _=a.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(_&&(t.hp_claimed=parseInt(_[1]),t.hp=parseInt(_[1]),_[2])){const s=/(\d+)d/.exec(_[2]);s&&(t.racialHD=parseInt(s[1]))}const L=t.classLevels?.reduce((s,n)=>s+n.level,0)||0;t.racialHD===L&&L>0&&(t.racialHD=0);const k=a.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);k&&(t.fort_save_claimed=parseInt(k[1]),t.ref_save_claimed=parseInt(k[2]),t.will_save_claimed=parseInt(k[3]));const h=a.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);h&&(t.bab_claimed=parseInt(h[1]));const C=a.match(/CMD\s*(\d+)/i);C&&(t.cmd_claimed=parseInt(C[1]));const i=(s,n)=>{const P=new RegExp(`${n}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),H=s.match(P);if(!H)return 10;const N=H[1];return/\d/.test(N)?parseInt(N):0};t.str=i(a,"Str"),t.dex=i(a,"Dex"),t.con=i(a,"Con"),t.int=i(a,"Int"),t.wis=i(a,"Wis"),t.cha=i(a,"Cha"),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const v=a.match(/Init\s*([+-]?\d+)/i);v&&(t.init_claimed=parseInt(v[1]));const F=a.match(/Perception\s*([+-]?\d+)/i);F&&(t.perception_claimed=parseInt(F[1]));const r=a.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);r&&(t.feats=r[1].split(/[,;]/).map(s=>s.trim()).filter(Boolean));const o=a.match(/Treasure\s+(.+?)(?:$|\n)/i);if(o){const s=o[1].toLowerCase();s.includes("npc gear")?t.treasureType="NPC Gear":(s.includes("standard"),t.treasureType="Standard")}return t}function ee(x,a="enforce_cr"){const e=JSON.parse(JSON.stringify(x)),t=[],f=(r,o,s,n)=>{o!=s&&t.push({feature:r,oldValue:o,newValue:s,reason:n})};if(a==="enforce_cr"){const r=W.find(o=>o.cr===e.cr);if(r){const s=(z[e.type]||{hitDieType:8}).hitDieType/2+.5,n=Math.floor(((e.con||10)-10)/2),P=Math.max(1,s+n),H=e.hp_claimed||e.hp;if(H>r.hp*1.5){const N=Math.max(1,Math.round(r.hp/P));if((e.classLevels||[]).length===0){const U=e.racialHD;e.racialHD=N;const $=Math.floor(e.racialHD*s)+e.racialHD*n;e.hp=$,e.hp_claimed=$,f("Hit Dice",U,N,`Reduced to match CR ${e.cr} Benchmark`),f("Hit Points",H,$,`Recalculated for ${N} HD`)}}}}let d=0;if(e.racialHD&&e.racialHD>0){const r=z[e.type];let o="medium";r&&(o=r.babProgression),o==="fast"?d+=e.racialHD:o==="medium"?d+=Math.floor(e.racialHD*.75):d+=Math.floor(e.racialHD*.5)}for(const r of e.classLevels||[]){const o=q[r.className];o&&(o.babProgression==="fast"?d+=r.level:o.babProgression==="medium"?d+=Math.floor(r.level*.75):d+=Math.floor(r.level*.5))}(e.racialHD||0)===0&&(e.classLevels||[]).length===0&&(d=e.bab_claimed??e.bab??0);const m=e.bab_claimed??e.bab;d!==m&&(f("Base Attack Bonus",m,d,`Fixed based on ${e.racialHD||0} HD (${e.type}) + Class Levels`),e.bab=d,e.bab_claimed=d);const g=K[e.size]||{acAttackMod:0,cmbCmdMod:0},u=Math.floor(((e.str??10)-10)/2),y=Math.floor(((e.dex??10)-10)/2),b=10+d+u+y+(g.cmbCmdMod||0),D=e.cmd_claimed??e.cmd;b!==D&&(f("CMD",D,b,`Recalculated: 10 + BAB(${d}) + Str(${u}) + Dex(${y}) + Size(${g.cmbCmdMod})`),e.cmd=b,e.cmd_claimed=b);const E=d+u+(g.cmbCmdMod||0),B=e.cmb;E!==B&&(f("CMB",B,E,`Recalculated: BAB(${d}) + Str(${u}) + Size(${g.cmbCmdMod})`),e.cmb=E);const l=(e.racialHD??0)+(e.classLevels||[]).reduce((r,o)=>r+(o.level||0),0),p=Math.floor(2+l/2),I=Math.floor(l/3),S=z[e.type]||{goodSaves:[]},M=(S.goodSaves?.includes("Fort")?p:I)+Math.floor(((e.con??10)-10)/2),R=(S.goodSaves?.includes("Ref")?p:I)+Math.floor(((e.dex??10)-10)/2),w=(S.goodSaves?.includes("Will")?p:I)+Math.floor(((e.wis??10)-10)/2),_=e.fort_save_claimed??e.fort;M!==_&&(f("Fort Save",_,M,`Recalculated for ${l} HD and con ${e.con}`),e.fort=M,e.fort_save_claimed=M);const L=e.ref_save_claimed??e.ref;R!==L&&(f("Ref Save",L,R,`Recalculated for ${l} HD and dex ${e.dex}`),e.ref=R,e.ref_save_claimed=R);const k=e.will_save_claimed??e.will;w!==k&&(f("Will Save",k,w,`Recalculated for ${l} HD and wis ${e.wis}`),e.will=w,e.will_save_claimed=w);const h=Math.floor(((e.dex??10)-10)/2),C=e.init_claimed??void 0;if(h!==C&&(f("Init",C,h,`Set to Dex modifier ${h}`),e.init_claimed=h),a==="fix_math"){const r=e.hp_claimed||e.hp;if(r>0){const o=W.find(s=>s.cr===e.cr);if(o&&r>o.hp*1.5){const s=W.find(n=>r>=n.hp*.85&&r<=n.hp*1.25);s&&(f("Challenge Rating",e.cr,s.cr,`Upgraded to match HP (${r})`),e.cr=s.cr,e.cr_text=s.cr)}}}let i=e.cr_text||e.cr.toString();if(i==="0.5"&&(i="1/2"),(i==="0.33"||i==="0.333")&&(i="1/3"),i==="0.25"&&(i="1/4"),(i==="0.16"||i==="0.166"||i==="0.167")&&(i="1/6"),i==="0.125"&&(i="1/8"),V[i]){const r=V[i];e.xp!==r&&(f("XP Award",e.xp,r,`Standardized for CR ${i}`),e.xp=r)}const v=e.ac_claimed||e.ac,F=10+y+g.acAttackMod;return v>F?e.ac=v:e.ac=Math.max(v,F),{block:e,fixes:t}}const te=`New Creature
CR 1
XP 400
N Medium Humanoid
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 20 (2d8+4)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee unarmed +1 (1d4)
STATISTICS
Str 10, Dex 10, Con 14, Int 10, Wis 10, Cha 10
Base Atk +1; CMB +1; CMD 12
Feats Improved Initiative
Treasure Standard`,ae=()=>{const[x,a]=A.useState(te),[e,t]=A.useState(null),[f,d]=A.useState(1),[m,g]=A.useState("enforce_cr"),[u,y]=A.useState(null),[b,D]=A.useState([]),[E,B]=A.useState(null);return A.useEffect(()=>{if(!x.trim()){t(null),y(null),B(null),D([]);return}try{const l=Y(x);t(l);const p=parseInt(l.cr)||1;d(p)}catch(l){console.error(l)}},[x]),A.useEffect(()=>{if(!e)return;let l=JSON.parse(JSON.stringify(e));const p=[],I=e.cr,S=f.toString();if(I!==S){const n=V[S];if(n){const{block:P,changes:H}=J(l,n);l=P,H.forEach(N=>p.push({feature:"Creature Scaler",oldValue:I,newValue:S,reason:N}))}}const{block:M,fixes:R}=ee(l,m);y(M),D([...p,...R]);const _=O(e).messages.filter(n=>n.category==="structure"),k=X(e).messages.filter(n=>n.severity!=="note"),h=m==="enforce_cr"?M:e;let C={status:"PASS",messages:[]},i={status:"PASS",messages:[]},v={status:"PASS",messages:[]};h&&(C=O(h),i=X(h),v=Q(h));const F=[..._,...k,...C.messages,...i.messages,...v.messages],r=_.some(n=>n.severity==="critical"),o=C.status==="FAIL"||v.status==="FAIL",s={valid:!r&&!o,status:r||o?"FAIL":C.status==="WARN"||v.status==="WARN"||i.status==="WARN"?"WARN":"PASS",messages:F};B(s)},[e,f,m]),c.createElement("div",{className:"validator-playground"},c.createElement("div",{className:"validator-column"},c.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),c.createElement("textarea",{className:"validator-textarea",value:x,onChange:l=>a(l.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),c.createElement("div",{className:"validator-scroll-area"},c.createElement("div",null,c.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v3.0)"),c.createElement("div",{style:{fontSize:"0.85rem",color:"#6b7280",marginBottom:"0.5rem"}},"Validating: ",m==="enforce_cr"?"Auto-Fixed Version (Design Mode)":"Raw Input (Audit Mode)"),e&&E?c.createElement(j,{statBlock:m==="enforce_cr"?u:e,validation:E,validationTarget:m==="enforce_cr"?"fixed":"raw"}):null),b.length>0&&c.createElement("div",{className:"fix-report"},c.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",m==="fix_math"?"Audit Mode":"Design Mode",")"),c.createElement("ul",{className:"fix-list"},b.map((l,p)=>c.createElement("li",{key:p,className:"fix-item"},c.createElement("div",{style:{fontWeight:600}},l.feature),c.createElement("div",{className:"fix-change-row"},c.createElement("span",{className:"fix-old"},l.oldValue),c.createElement("span",null,"â†’"),c.createElement("span",{className:"fix-new"},l.newValue)),c.createElement("div",{className:"fix-reason"},l.reason)))))),c.createElement("div",{className:"validator-column"},c.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},c.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),c.createElement("div",{className:"mode-toggle",style:{display:"flex",alignItems:"center",gap:"1rem"}},c.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"}},c.createElement("label",{htmlFor:"cr-slider",style:{fontSize:"0.75rem",fontWeight:"bold",color:"#4b5563"}},"Target CR: ",f),c.createElement("input",{id:"cr-slider",type:"range",min:"1",max:"20",value:f,onChange:l=>d(parseInt(l.target.value)),style:{width:"100px"}})),c.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},c.createElement("button",{onClick:()=>g("enforce_cr"),style:{backgroundColor:m==="enforce_cr"?"white":"transparent",color:m==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:m==="enforce_cr"?"bold":"normal",boxShadow:m==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep CR, Downgrade Stats"},"Design Mode (Enforce CR)"),c.createElement("button",{onClick:()=>g("fix_math"),style:{backgroundColor:m==="fix_math"?"white":"transparent",color:m==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:m==="fix_math"?"bold":"normal",boxShadow:m==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep Stats, Update CR"},"Audit Mode (Fix Math)")))),c.createElement("div",{className:"output-area"},u?c.createElement("pre",{className:"output-pre"},G(u)):c.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),c.createElement("button",{onClick:()=>u&&navigator.clipboard.writeText(G(u)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))},de={title:"Validators/Rules Lawyer Workbench",component:ae,parameters:{layout:"fullscreen"}},T={};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:"{}",...T.parameters?.docs?.source}}};const me=["InteractiveWorkbench"];export{T as InteractiveWorkbench,me as __namedExportsOrder,de as default};
