import{r as w,R as c}from"./iframe-CMjbAIKP.js";import{C as q,a as J,S as j,M as P,X as W,v as K}from"./validateBasics-CetwHHmj.js";import"./preload-helper-PPVm8Dsz.js";function Z(a){return a.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function O(a){const e=Z(a),t={name:e.split(`
`).map(o=>o.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},r=e.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);r&&(t.melee_line="Melee "+r[1].trim());const d=e.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);d&&(t.ranged_line="Ranged "+d[1].trim());const g=e.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);g&&(t.speed_line="Speed "+g[1].trim());const p=e.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);p&&(t.special_attacks_line="Special Attacks "+p[1].trim());const i=e.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);i&&(t.spells_block=i[0].trim());const S=e.match(/SPECIAL ABILITIES(.+)$/s);S&&(t.special_abilities_block=`SPECIAL ABILITIES
`+S[1].trim());const n=e.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);n&&(t.skills_line="Skills "+n[1].trim());const f=e.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);f&&(t.languages_line="Languages "+f[1].trim());const s=e.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);s&&(t.equipment_line="Equipment "+s[1].trim());const m=e.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);m&&(t.cr=m[1]);const u=e.match(/XP\s*([0-9,]+)/i);u&&(t.xp=parseInt(u[1].replace(/,/g,"")));const _=e.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(_){t.alignment=_[1],t.size=_[2];const o=_[3].trim();/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(o)?t.type="Outsider":/Dragon/i.test(o)?t.type="Dragon":/Undead/i.test(o)?t.type="Undead":/Beast/i.test(o)?t.type="Magical Beast":t.type=o.split(" ")[0]}const M=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let D;for(;(D=M.exec(e))!==null;)t.classLevels?.push({className:D[1],level:parseInt(D[2])});const E=e.match(/AC\s*(\d+)/i);E&&(t.ac_claimed=parseInt(E[1]));const R=e.match(/touch\s*(\d+)/i);R&&(t.touch_ac_claimed=parseInt(R[1]));const I=e.match(/flat-?footed\s*(\d+)/i);I&&(t.flat_footed_ac_claimed=parseInt(I[1]));const v=e.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(v&&(t.hp_claimed=parseInt(v[1]),t.hp=parseInt(v[1]),v[2])){const o=/(\d+)d/.exec(v[2]);o&&(t.racialHD=parseInt(o[1]))}const A=t.classLevels?.reduce((o,Q)=>o+Q.level,0)||0;t.racialHD===A&&A>0&&(t.racialHD=0);const C=e.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);C&&(t.fort_save_claimed=parseInt(C[1]),t.ref_save_claimed=parseInt(C[2]),t.will_save_claimed=parseInt(C[3]));const l=e.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);l&&(t.bab_claimed=parseInt(l[1]));const $=e.match(/CMD\s*(\d+)/i);$&&(t.cmd_claimed=parseInt($[1]));const x=/Str\s*(\d+)/i.exec(e),y=/Dex\s*(\d+)/i.exec(e),B=/Con\s*(\d+)/i.exec(e),T=/Int\s*(\d+)/i.exec(e),L=/Wis\s*(\d+)/i.exec(e),H=/Cha\s*(\d+)/i.exec(e);x&&(t.str=parseInt(x[1])),y&&(t.dex=parseInt(y[1])),B&&(t.con=parseInt(B[1])),T&&(t.int=parseInt(T[1])),L&&(t.wis=parseInt(L[1])),H&&(t.cha=parseInt(H[1])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const N=e.match(/Init\s*([+-]?\d+)/i);N&&(t.init_claimed=parseInt(N[1]));const b=e.match(/Perception\s*([+-]?\d+)/i);b&&(t.perception_claimed=parseInt(b[1]));const z=e.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);z&&(t.feats=z[1].split(/[,;]/).map(o=>o.trim()).filter(Boolean));const V=e.match(/Treasure\s+(.+?)(?:$|\n)/i);if(V){const o=V[1].toLowerCase();o.includes("npc gear")?t.treasureType="NPC Gear":(o.includes("standard"),t.treasureType="Standard")}return t}function Y(a){const{name:e,cr:h,xp:t,size:r,type:d}=a,g=a.alignment||"N",p=l=>Math.floor((l-10)/2),i=l=>p(l)>=0?`+${p(l)}`:`${p(l)}`;let S="";const n=a.classLevels?.reduce((l,$)=>l+$.level,0)||0;if(n>0&&(a.racialHD||0)===0){const l=a.classLevels[0],$=q[l.className],x=$?$.hitDieType:8,y=a.classLevels.reduce((B,T)=>B+T.level,0);S=`${y}d${x}+${p(a.con)*y}`}else{const l=a.racialHD||1,x=(J[a.type]||{hitDieType:8}).hitDieType,y=l+n;S=`${y}d${x}+${p(a.con)*y}`}const f=a.classLevels?.map(l=>`${l.className} ${l.level}`).join(", ")||"",s=f?`${g} ${r} ${d} ${f}`:`${g} ${r} ${d}`,m=a.melee_line||`Melee weapon +${a.bab_claimed||0} (1d8)`,u=a.ranged_line?`${a.ranged_line}
`:"",_=a.special_attacks_line?`${a.special_attacks_line}
`:"",M=a.spells_block?`${a.spells_block}
`:"",D=a.skills_line?`${a.skills_line}
`:"",E=a.languages_line?`${a.languages_line}
`:"",R=a.equipment_line?`${a.equipment_line}
`:"",I=a.special_abilities_block?`
${a.special_abilities_block}`:"",v=a.speed_line||"Speed 30 ft.",A=a.init_claimed!==void 0?a.init_claimed>=0?`+${a.init_claimed}`:`${a.init_claimed}`:i(a.dex),C=a.perception_claimed!==void 0?a.perception_claimed>=0?`+${a.perception_claimed}`:`${a.perception_claimed}`:"+0";return`
${e}
CR ${h}
XP ${t?.toLocaleString()||"0"}
${s}
Init ${A}; Senses Perception ${C}
DEFENSE
AC ${a.ac_claimed||a.ac}, touch ${a.touch_ac_claimed||10}, flat-footed ${a.flat_footed_ac_claimed||10}
hp ${a.hp_claimed||a.hp} (${S})
Fort +${a.fort_save_claimed||0}, Ref +${a.ref_save_claimed||0}, Will +${a.will_save_claimed||0}
OFFENSE
${v}
${m}
${u}${_}${M}STATISTICS
Str ${a.str}, Dex ${a.dex}, Con ${a.con}, Int ${a.int}, Wis ${a.wis}, Cha ${a.cha}
Base Atk +${a.bab_claimed||0}; CMB +${(a.bab_claimed||0)+p(a.str)}; CMD ${a.cmd_claimed||10}
Feats ${a.feats?.join(", ")||"None"}
${D}${E}${R}${I}
`.trim()}function G(a){const e=JSON.parse(JSON.stringify(a)),h=[];let t=0,r="";if(e.racialHD&&e.racialHD>0){const s=J[e.type];s?s.babProgression==="fast"?(t+=e.racialHD,r+=`Racial HD (${e.racialHD} Fast) `):s.babProgression==="medium"?(t+=Math.floor(e.racialHD*.75),r+=`Racial HD (${e.racialHD} Medium) `):(t+=Math.floor(e.racialHD*.5),r+=`Racial HD (${e.racialHD} Slow) `):(t+=Math.floor(e.racialHD*.75),r+=`Racial HD (${e.racialHD} Default Medium) `)}const d=e.classLevels||[];for(const s of d){const m=q[s.className];m&&(m.babProgression==="fast"?(t+=s.level,r+=`${s.className} ${s.level} (Fast) `):m.babProgression==="medium"?(t+=Math.floor(s.level*.75),r+=`${s.className} ${s.level} (Medium) `):(t+=Math.floor(s.level*.5),r+=`${s.className} ${s.level} (Slow) `))}(e.racialHD||0)===0&&d.length===0&&(t=e.bab_claimed??e.bab??0,r="No HD/Levels found, kept original"),e.bab_claimed!==t&&h.push({feature:"Base Attack Bonus",oldValue:e.bab_claimed||0,newValue:t,reason:r.trim()}),e.bab_claimed=t,e.bab=t;const g=j[e.size]||{cmbCmdMod:0},p=Math.floor(((e.str??10)-10)/2),i=Math.floor(((e.dex??10)-10)/2),S=10+t+p+i+(g.cmbCmdMod||0);e.cmd_claimed!==S&&h.push({feature:"CMD",oldValue:e.cmd_claimed||0,newValue:S,reason:`10 + BAB(${t}) + Str(${p}) + Dex(${i}) + Size(${g.cmbCmdMod||0})`}),e.cmd_claimed=S,e.cmd=e.cmd_claimed;const n=e.hp_claimed||e.hp;if(n>0){const s=e.cr,m=P.find(u=>u.cr===s);if(m&&n>m.hp*1.5){for(const u of P)if(n>=u.hp*.85&&n<=u.hp*1.25){const _=e.cr;e.cr=u.cr,h.push({feature:"Challenge Rating",oldValue:_,newValue:e.cr,reason:`HP ${n} is too high for CR ${_} (Benchmark: ${m.hp}). Matched CR ${e.cr} (Benchmark: ${u.hp}).`});break}}}const f=e.cr.toString();if(W[f]){const s=e.xp;e.xp=W[f],s!==e.xp&&h.push({feature:"XP Award",oldValue:s||0,newValue:e.xp,reason:`Updated to match CR ${e.cr}`})}return{block:e,fixes:h}}function k(a){const e=[],h=typeof a.cr=="number"?a.cr:parseInt(String(a.cr),10);if(isNaN(h))return{valid:!0,messages:e,status:"PASS"};const t=P.find(i=>i.cr===String(a.cr)||i.cr===a.cr_text);if(!t)return{valid:!0,messages:e,status:"PASS"};const r=a.hp_claimed??a.hp??void 0;if(r!==void 0&&typeof r=="number"){const i=r/t.hp;i<.7?e.push({severity:"warning",category:"benchmarks",message:`HP ${r} is dangerously low (<70%) for CR ${a.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):i>1.5&&e.push({severity:"warning",category:"benchmarks",message:`HP ${r} is significantly high (>150%) for CR ${a.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const d=a.ac_claimed??a.ac??void 0;if(d!==void 0&&typeof d=="number"){const i=d-t.ac;i<-3?e.push({severity:"warning",category:"benchmarks",message:`AC ${d} is very low (-${Math.abs(i)}) for CR ${a.cr} (Benchmark: ${t.ac}).`}):i>5&&e.push({severity:"warning",category:"benchmarks",message:`AC ${d} is very high (+${i}) for CR ${a.cr} (Benchmark: ${t.ac}).`})}const g=[{name:"Fort",val:a.fort_save_claimed},{name:"Ref",val:a.ref_save_claimed},{name:"Will",val:a.will_save_claimed}];for(const i of g)i.val!==void 0&&typeof i.val=="number"&&i.val<t.poorSave-2&&e.push({severity:"warning",category:"benchmarks",message:`${i.name} Save +${i.val} is critically weak for CR ${a.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!e.some(i=>i.severity==="error"),messages:e,status:e.length>0?"WARN":"PASS"}}const X=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,U=()=>{const[a,e]=w.useState(X),[h,t]=w.useState(()=>G(O(X)).block),[r,d]=w.useState([]),[g,p]=w.useState([]),i=n=>{const f=n.currentTarget.value;e(f);try{const s=O(f),{block:m,fixes:u}=G(s);t(m),d(u);const _=K(s),M=k(s);p([_,M])}catch(s){console.error("Parse error:",s)}},S=n=>{switch(n){case"error":return"#dc2626";case"warning":return"#ea580c";case"info":return"#2563eb"}};return c.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",fontFamily:"system-ui, sans-serif",height:"100vh",boxSizing:"border-box"}},c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"ðŸ“ Raw Stat Block"),c.createElement("textarea",{value:a,onChange:i,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",lineHeight:1.5},spellCheck:!1})),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",overflow:"auto"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âš–ï¸ Validation & Fixes"),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},g.map((n,f)=>c.createElement("div",{key:f,style:{border:"1px solid #d1d5db",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f9fafb"}},c.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem"}},n.messages[0]?.category||"Validation"),n.messages.length===0?c.createElement("div",{style:{color:"#059669",fontWeight:500}},"âœ“ PASS"):c.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},n.messages.map((s,m)=>c.createElement("li",{key:m,style:{color:S(s.severity),marginBottom:"0.25rem",fontSize:"0.875rem"}},c.createElement("strong",null,s.severity.toUpperCase(),":")," ",s.message,s.expected!==void 0&&c.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:"#6b7280"}},"Expected: ",JSON.stringify(s.expected)," | Actual: ",JSON.stringify(s.actual))))))),r.length>0&&c.createElement("div",{style:{border:"1px solid #10b981",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f0fdf4"}},c.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"#059669"}},"ðŸ› ï¸ Auto-Fixes Applied"),c.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},r.map((n,f)=>c.createElement("li",{key:f,style:{color:"#047857",marginBottom:"0.5rem",fontSize:"0.875rem"}},c.createElement("strong",null,n.feature,":")," ",n.oldValue," â†’ ",c.createElement("strong",null,n.newValue),c.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.1rem",color:"#065f46"}},n.reason))))))),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âœ¨ Auto-Fixed Version"),c.createElement("textarea",{value:Y(h),readOnly:!0,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #10b981",borderRadius:"0.375rem",resize:"none",backgroundColor:"#f0fdf4",lineHeight:1.5},spellCheck:!1})))};U.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const se={title:"Validators/Rules Lawyer Workbench",component:U,parameters:{layout:"fullscreen"}},F={};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:"{}",...F.parameters?.docs?.source}}};const ie=["InteractiveWorkbench"];export{F as InteractiveWorkbench,ie as __namedExportsOrder,se as default};
