import{r as D,R as r}from"./iframe-DyX1HsPw.js";import{C as q,b,S as U,M as W,X as G,v as J,a as Q,V as K}from"./validateEconomy-BBa7ZIX9.js";import"./preload-helper-PPVm8Dsz.js";function Z(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function Y(e){const s=Z(e),t={name:s.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},o=s.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);o&&(t.melee_line="Melee "+o[1].trim());const l=s.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);l&&(t.ranged_line="Ranged "+l[1].trim());const h=s.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);h&&(t.speed_line="Speed "+h[1].trim());const u=s.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);u&&(t.special_attacks_line="Special Attacks "+u[1].trim());const n=s.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);n&&(t.spells_block=n[0].trim());const v=s.match(/SPECIAL ABILITIES(.+)$/s);v&&(t.special_abilities_block=`SPECIAL ABILITIES
`+v[1].trim());const g=s.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);g&&(t.skills_line="Skills "+g[1].trim());const S=s.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);S&&(t.languages_line="Languages "+S[1].trim());const i=s.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);i&&(t.equipment_line="Equipment "+i[1].trim());const c=s.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);c&&(t.cr=c[1]);const m=s.match(/XP\s*([0-9,]+)/i);m&&(t.xp=parseInt(m[1].replace(/,/g,"")));const d=s.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(d){t.alignment=d[1],t.size=d[2];const p=d[3].trim();t.subtypes=p.split(/,\s*/).map(O=>O.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?t.type="Outsider":/Dragon/i.test(p)?t.type="Dragon":/Undead/i.test(p)?t.type="Undead":/Beast/i.test(p)?t.type="Magical Beast":t.type=p.split(" ")[0]}const _=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let y;for(;(y=_.exec(s))!==null;)t.classLevels?.push({className:y[1],level:parseInt(y[2])});const M=s.match(/AC\s*(\d+)/i);M&&(t.ac_claimed=parseInt(M[1]));const C=s.match(/touch\s*(\d+)/i);C&&(t.touch_ac_claimed=parseInt(C[1]));const A=s.match(/flat-?footed\s*(\d+)/i);A&&(t.flat_footed_ac_claimed=parseInt(A[1]));const $=s.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if($&&(t.hp_claimed=parseInt($[1]),t.hp=parseInt($[1]),$[2])){const p=/(\d+)d/.exec($[2]);p&&(t.racialHD=parseInt(p[1]))}const B=t.classLevels?.reduce((p,O)=>p+O.level,0)||0;t.racialHD===B&&B>0&&(t.racialHD=0);const I=s.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);I&&(t.fort_save_claimed=parseInt(I[1]),t.ref_save_claimed=parseInt(I[2]),t.will_save_claimed=parseInt(I[3]));const T=s.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);T&&(t.bab_claimed=parseInt(T[1]));const L=s.match(/CMD\s*(\d+)/i);L&&(t.cmd_claimed=parseInt(L[1]));const N=/Str\s*(\d+)/i.exec(s),P=/Dex\s*(\d+)/i.exec(s),f=/Con\s*(\d+)/i.exec(s),x=/Int\s*(\d+)/i.exec(s),R=/Wis\s*(\d+)/i.exec(s),E=/Cha\s*(\d+)/i.exec(s);N&&(t.str=parseInt(N[1])),P&&(t.dex=parseInt(P[1])),f&&(t.con=parseInt(f[1])),x&&(t.int=parseInt(x[1])),R&&(t.wis=parseInt(R[1])),E&&(t.cha=parseInt(E[1])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const F=s.match(/Init\s*([+-]?\d+)/i);F&&(t.init_claimed=parseInt(F[1]));const w=s.match(/Perception\s*([+-]?\d+)/i);w&&(t.perception_claimed=parseInt(w[1]));const z=s.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);z&&(t.feats=z[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const V=s.match(/Treasure\s+(.+?)(?:$|\n)/i);if(V){const p=V[1].toLowerCase();p.includes("npc gear")?t.treasureType="NPC Gear":(p.includes("standard"),t.treasureType="Standard")}return t}function X(e){const{name:s,cr:a,xp:t,size:o,type:l}=e,h=e.alignment||"N",u=f=>Math.floor((f-10)/2),n=f=>u(f)>=0?`+${u(f)}`:`${u(f)}`;let v="";const g=e.classLevels?.reduce((f,x)=>f+x.level,0)||0;if(g>0&&(e.racialHD||0)===0){const f=e.classLevels[0],x=q[f.className],R=x?x.hitDieType:8,E=e.classLevels.reduce((F,w)=>F+w.level,0);v=`${E}d${R}+${u(e.con)*E}`}else{const f=e.racialHD||1,R=(b[e.type]||{hitDieType:8}).hitDieType,E=f+g;v=`${E}d${R}+${u(e.con)*E}`}const S=e.classLevels?.map(f=>`${f.className} ${f.level}`).join(", ")||"",i=e.subtypes&&e.subtypes.length>0?e.subtypes.join(", "):l,c=S?`${h} ${o} ${i} ${S}`:`${h} ${o} ${i}`,m=e.melee_line||`Melee weapon +${e.bab_claimed||0} (1d8)`,d=e.ranged_line?`${e.ranged_line}
`:"",_=e.special_attacks_line?`${e.special_attacks_line}
`:"",y=e.spells_block?`${e.spells_block}
`:"",M=e.skills_line?`${e.skills_line}
`:"",C=e.languages_line?`${e.languages_line}
`:"",A=e.equipment_line?`${e.equipment_line}
`:"",$=e.special_abilities_block?`
${e.special_abilities_block}`:"",B=e.speed_line||"Speed 30 ft.",I=e.init_claimed!==void 0?e.init_claimed>=0?`+${e.init_claimed}`:`${e.init_claimed}`:n(e.dex),T=e.perception_claimed!==void 0?e.perception_claimed>=0?`+${e.perception_claimed}`:`${e.perception_claimed}`:"+0",L=U[o]||{cmbCmdMod:0},N=(e.bab_claimed||0)+u(e.str)+L.cmbCmdMod,P=N>=0?`+${N}`:`${N}`;return`
${s}
CR ${a}
XP ${t?.toLocaleString()||"0"}
${c}
Init ${I}; Senses Perception ${T}
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${v})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
${B}
${m}
${d}${_}${y}STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||0}; CMB ${P}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
${M}${C}${A}${$}
`.trim()}function k(e,s="fix_math"){const a=JSON.parse(JSON.stringify(e)),t=[],o=(c,m,d,_)=>{m!=d&&t.push({feature:c,oldValue:m,newValue:d,reason:_})};if(s==="enforce_cr"){const c=W.find(m=>m.cr===a.cr);if(c){const d=(b[a.type]||{hitDieType:8}).hitDieType/2+.5,_=Math.floor(((a.con||10)-10)/2),y=Math.max(1,d+_),M=a.hp_claimed||a.hp;if(M>c.hp*1.5){const C=Math.max(1,Math.round(c.hp/y));if((a.classLevels||[]).length===0){const A=a.racialHD;a.racialHD=C;const $=Math.floor(a.racialHD*d)+a.racialHD*_;a.hp=$,a.hp_claimed=$,o("Hit Dice",A,C,`Reduced to match CR ${a.cr} Benchmark`),o("Hit Points",M,$,`Recalculated for ${C} HD`)}}}}let l=0;if(a.racialHD&&a.racialHD>0){const c=b[a.type];let m="medium";c&&(m=c.babProgression),m==="fast"?l+=a.racialHD:m==="medium"?l+=Math.floor(a.racialHD*.75):l+=Math.floor(a.racialHD*.5)}for(const c of a.classLevels||[]){const m=q[c.className];m&&(m.babProgression==="fast"?l+=c.level:m.babProgression==="medium"?l+=Math.floor(c.level*.75):l+=Math.floor(c.level*.5))}(a.racialHD||0)===0&&(a.classLevels||[]).length===0&&(l=a.bab_claimed??a.bab??0);const h=a.bab_claimed??a.bab;l!==h&&(o("Base Attack Bonus",h,l,`Fixed based on ${a.racialHD||0} HD (${a.type}) + Class Levels`),a.bab=l,a.bab_claimed=l);const u=U[a.size]||{cmbCmdMod:0},n=Math.floor(((a.str??10)-10)/2),v=Math.floor(((a.dex??10)-10)/2),g=10+l+n+v+(u.cmbCmdMod||0),S=a.cmd_claimed??a.cmd;if(g!==S&&(o("CMD",S,g,`Recalculated: 10 + BAB(${l}) + Str(${n}) + Dex(${v}) + Size(${u.cmbCmdMod})`),a.cmd=g,a.cmd_claimed=g),s==="fix_math"){const c=a.hp_claimed||a.hp;if(c>0){const m=W.find(d=>d.cr===a.cr);if(m&&c>m.hp*1.5){const d=W.find(_=>c>=_.hp*.85&&c<=_.hp*1.25);d&&(o("Challenge Rating",a.cr,d.cr,`Upgraded to match HP (${c})`),a.cr=d.cr,a.cr_text=d.cr)}}}let i=a.cr_text||a.cr.toString();if(i==="0.5"&&(i="1/2"),(i==="0.33"||i==="0.333")&&(i="1/3"),i==="0.25"&&(i="1/4"),(i==="0.16"||i==="0.166"||i==="0.167")&&(i="1/6"),i==="0.125"&&(i="1/8"),G[i]){const c=G[i];a.xp!==c&&(o("XP Award",a.xp,c,`Standardized for CR ${i}`),a.xp=c)}return{block:a,fixes:t}}function ee(e){const s=[],a=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(a))return{valid:!0,messages:s,status:"PASS"};const t=W.find(n=>n.cr===String(e.cr)||n.cr===e.cr_text);if(!t)return{valid:!0,messages:s,status:"PASS"};const o=e.hp_claimed??e.hp??void 0;if(o!==void 0&&typeof o=="number"){const n=o/t.hp;n<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${o} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):n>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${o} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const l=e.ac_claimed??e.ac??void 0;if(l!==void 0&&typeof l=="number"){const n=l-t.ac;n<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very low (-${Math.abs(n)}) for CR ${e.cr} (Benchmark: ${t.ac}).`}):n>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${l} is very high (+${n}) for CR ${e.cr} (Benchmark: ${t.ac}).`})}const h=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const n of h)n.val!==void 0&&typeof n.val=="number"&&n.val<t.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${n.name} Save +${n.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!s.some(n=>n.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const te=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,j=()=>{const[e,s]=D.useState(te),[a,t]=D.useState(null),[o,l]=D.useState("fix_math"),[h,u]=D.useState(null),[n,v]=D.useState([]),[g,S]=D.useState(null);return D.useEffect(()=>{if(!e.trim()){t(null),u(null),S(null),v([]);return}try{const i=Y(e);t(i);const c=J(i),m=ee(i),d=Q(i),_={valid:c.valid&&m.valid&&d.valid,status:c.status==="FAIL"||d.status==="FAIL"?"FAIL":c.status==="WARN"||d.status==="WARN"||m.status==="WARN"?"WARN":"PASS",messages:[...c.messages,...m.messages,...d.messages]};S(_);const{block:y,fixes:M}=k(i,o);u(y),v(M)}catch(i){console.error(i)}},[e,o]),r.createElement("div",{className:"validator-playground"},r.createElement("div",{className:"validator-column"},r.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),r.createElement("textarea",{className:"validator-textarea",value:e,onChange:i=>s(i.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),r.createElement("div",{className:"validator-scroll-area"},r.createElement("div",null,r.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v2)"),a&&g?r.createElement(K,{statBlock:a,validation:g}):null),n.length>0&&r.createElement("div",{className:"fix-report"},r.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",o==="fix_math"?"Audit Mode":"Design Mode",")"),r.createElement("ul",{className:"fix-list"},n.map((i,c)=>r.createElement("li",{key:c,className:"fix-item"},r.createElement("div",{style:{fontWeight:600}},i.feature),r.createElement("div",{className:"fix-change-row"},r.createElement("span",{className:"fix-old"},i.oldValue),r.createElement("span",null,"â†’"),r.createElement("span",{className:"fix-new"},i.newValue)),r.createElement("div",{className:"fix-reason"},i.reason)))))),r.createElement("div",{className:"validator-column"},r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},r.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),r.createElement("div",{className:"mode-toggle"},r.createElement("button",{onClick:()=>l("fix_math"),className:`mode-btn ${o==="fix_math"?"active":"inactive"}`,title:"Trust Stats, Update CR"},"Fix Math"),r.createElement("button",{onClick:()=>l("enforce_cr"),className:`mode-btn ${o==="enforce_cr"?"active":"inactive"}`,title:"Trust CR, Downgrade Stats"},"Enforce CR"))),r.createElement("div",{className:"output-area"},h?r.createElement("pre",{className:"output-pre"},X(h)):r.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),r.createElement("button",{onClick:()=>h&&navigator.clipboard.writeText(X(h)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};j.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ce={title:"Validators/Rules Lawyer Workbench",component:j,parameters:{layout:"fullscreen"}},H={};H.parameters={...H.parameters,docs:{...H.parameters?.docs,source:{originalSource:"{}",...H.parameters?.docs?.source}}};const ne=["InteractiveWorkbench"];export{H as InteractiveWorkbench,ne as __namedExportsOrder,ce as default};
