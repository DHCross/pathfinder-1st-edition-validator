import{r as A,R as c}from"./iframe-BgJJoUKM.js";import{C as U,a as W,S as j,M as L,X as z,v as K}from"./validateBasics-CetwHHmj.js";import"./preload-helper-PPVm8Dsz.js";function Z(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function G(e){const i=Z(e),t={name:i.split(`
`).map(p=>p.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},r=i.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);r&&(t.melee_line="Melee "+r[1].trim());const o=i.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);o&&(t.ranged_line="Ranged "+o[1].trim());const g=i.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);g&&(t.speed_line="Speed "+g[1].trim());const h=i.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);h&&(t.special_attacks_line="Special Attacks "+h[1].trim());const l=i.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);l&&(t.spells_block=l[0].trim());const S=i.match(/SPECIAL ABILITIES(.+)$/s);S&&(t.special_abilities_block=`SPECIAL ABILITIES
`+S[1].trim());const v=i.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);v&&(t.skills_line="Skills "+v[1].trim());const m=i.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);m&&(t.languages_line="Languages "+m[1].trim());const x=i.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);x&&(t.equipment_line="Equipment "+x[1].trim());const C=i.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);C&&(t.cr=C[1]);const $=i.match(/XP\s*([0-9,]+)/i);$&&(t.xp=parseInt($[1].replace(/,/g,"")));const n=i.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(n){t.alignment=n[1],t.size=n[2];const p=n[3].trim();t.subtypes=p.split(/,\s*/).map(V=>V.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(p)?t.type="Outsider":/Dragon/i.test(p)?t.type="Dragon":/Undead/i.test(p)?t.type="Undead":/Beast/i.test(p)?t.type="Magical Beast":t.type=p.split(" ")[0]}const _=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let s;for(;(s=_.exec(i))!==null;)t.classLevels?.push({className:s[1],level:parseInt(s[2])});const d=i.match(/AC\s*(\d+)/i);d&&(t.ac_claimed=parseInt(d[1]));const u=i.match(/touch\s*(\d+)/i);u&&(t.touch_ac_claimed=parseInt(u[1]));const M=i.match(/flat-?footed\s*(\d+)/i);M&&(t.flat_footed_ac_claimed=parseInt(M[1]));const y=i.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(y&&(t.hp_claimed=parseInt(y[1]),t.hp=parseInt(y[1]),y[2])){const p=/(\d+)d/.exec(y[2]);p&&(t.racialHD=parseInt(p[1]))}const E=t.classLevels?.reduce((p,V)=>p+V.level,0)||0;t.racialHD===E&&E>0&&(t.racialHD=0);const D=i.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);D&&(t.fort_save_claimed=parseInt(D[1]),t.ref_save_claimed=parseInt(D[2]),t.will_save_claimed=parseInt(D[3]));const w=i.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);w&&(t.bab_claimed=parseInt(w[1]));const I=i.match(/CMD\s*(\d+)/i);I&&(t.cmd_claimed=parseInt(I[1]));const B=/Str\s*(\d+)/i.exec(i),T=/Dex\s*(\d+)/i.exec(i),f=/Con\s*(\d+)/i.exec(i),b=/Int\s*(\d+)/i.exec(i),P=/Wis\s*(\d+)/i.exec(i),R=/Cha\s*(\d+)/i.exec(i);B&&(t.str=parseInt(B[1])),T&&(t.dex=parseInt(T[1])),f&&(t.con=parseInt(f[1])),b&&(t.int=parseInt(b[1])),P&&(t.wis=parseInt(P[1])),R&&(t.cha=parseInt(R[1])),t.ac_claimed&&(t.ac=t.ac_claimed),t.touch_ac_claimed&&(t.touch=t.touch_ac_claimed),t.flat_footed_ac_claimed&&(t.flatFooted=t.flat_footed_ac_claimed);const H=i.match(/Init\s*([+-]?\d+)/i);H&&(t.init_claimed=parseInt(H[1]));const F=i.match(/Perception\s*([+-]?\d+)/i);F&&(t.perception_claimed=parseInt(F[1]));const O=i.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);O&&(t.feats=O[1].split(/[,;]/).map(p=>p.trim()).filter(Boolean));const X=i.match(/Treasure\s+(.+?)(?:$|\n)/i);if(X){const p=X[1].toLowerCase();p.includes("npc gear")?t.treasureType="NPC Gear":(p.includes("standard"),t.treasureType="Standard")}return t}function Y(e){const{name:i,cr:a,xp:t,size:r,type:o}=e,g=e.alignment||"N",h=f=>Math.floor((f-10)/2),l=f=>h(f)>=0?`+${h(f)}`:`${h(f)}`;let S="";const v=e.classLevels?.reduce((f,b)=>f+b.level,0)||0;if(v>0&&(e.racialHD||0)===0){const f=e.classLevels[0],b=U[f.className],P=b?b.hitDieType:8,R=e.classLevels.reduce((H,F)=>H+F.level,0);S=`${R}d${P}+${h(e.con)*R}`}else{const f=e.racialHD||1,P=(W[e.type]||{hitDieType:8}).hitDieType,R=f+v;S=`${R}d${P}+${h(e.con)*R}`}const m=e.classLevels?.map(f=>`${f.className} ${f.level}`).join(", ")||"",x=e.subtypes&&e.subtypes.length>0?e.subtypes.join(", "):o,C=m?`${g} ${r} ${x} ${m}`:`${g} ${r} ${x}`,$=e.melee_line||`Melee weapon +${e.bab_claimed||0} (1d8)`,n=e.ranged_line?`${e.ranged_line}
`:"",_=e.special_attacks_line?`${e.special_attacks_line}
`:"",s=e.spells_block?`${e.spells_block}
`:"",d=e.skills_line?`${e.skills_line}
`:"",u=e.languages_line?`${e.languages_line}
`:"",M=e.equipment_line?`${e.equipment_line}
`:"",y=e.special_abilities_block?`
${e.special_abilities_block}`:"",E=e.speed_line||"Speed 30 ft.",D=e.init_claimed!==void 0?e.init_claimed>=0?`+${e.init_claimed}`:`${e.init_claimed}`:l(e.dex),w=e.perception_claimed!==void 0?e.perception_claimed>=0?`+${e.perception_claimed}`:`${e.perception_claimed}`:"+0",I=j[r]||{cmbCmdMod:0},B=(e.bab_claimed||0)+h(e.str)+I.cmbCmdMod,T=B>=0?`+${B}`:`${B}`;return`
${i}
CR ${a}
XP ${t?.toLocaleString()||"0"}
${C}
Init ${D}; Senses Perception ${w}
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${S})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
${E}
${$}
${n}${_}${s}STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||0}; CMB ${T}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
${d}${u}${M}${y}
`.trim()}function q(e,i="fix_math"){const a=JSON.parse(JSON.stringify(e)),t=[];if(i==="enforce_cr"){const s=L.find(d=>d.cr===a.cr);if(s){const d=W[a.type]||{hitDieType:8},u=d.hitDieType/2+.5,M=Math.floor((a.con-10)/2),y=Math.max(1,u+M),E=Math.round(s.hp/y);if((a.classLevels||[]).length===0){const D=a.racialHD,w=a.hp_claimed||a.hp;a.racialHD=Math.max(1,E),a.hp_claimed=Math.floor(a.racialHD*u)+a.racialHD*M,a.hp=a.hp_claimed,t.push({feature:"Hit Dice & HP",oldValue:`${D}d${d.hitDieType} (${w} hp)`,newValue:`${a.racialHD}d${d.hitDieType} (${a.hp} hp)`,reason:`Enforcing CR ${a.cr} (Benchmark HP: ${s.hp}). Reduced HD to match.`,action:"changed"})}}}let r=0,o="";if(a.racialHD&&a.racialHD>0){const s=W[a.type];s?s.babProgression==="fast"?(r+=a.racialHD,o+=`Racial HD (${a.racialHD} Fast) `):s.babProgression==="medium"?(r+=Math.floor(a.racialHD*.75),o+=`Racial HD (${a.racialHD} Medium) `):(r+=Math.floor(a.racialHD*.5),o+=`Racial HD (${a.racialHD} Slow) `):(r+=Math.floor(a.racialHD*.75),o+=`Racial HD (${a.racialHD} Default Medium) `)}const g=a.classLevels||[];for(const s of g){const d=U[s.className];d&&(d.babProgression==="fast"?(r+=s.level,o+=`${s.className} ${s.level} (Fast) `):d.babProgression==="medium"?(r+=Math.floor(s.level*.75),o+=`${s.className} ${s.level} (Medium) `):(r+=Math.floor(s.level*.5),o+=`${s.className} ${s.level} (Slow) `))}(a.racialHD||0)===0&&g.length===0&&(r=a.bab_claimed??a.bab??0,o="No HD/Levels found, kept original");const h=typeof e.bab_claimed=="number"&&!isNaN(e.bab_claimed);i==="enforce_cr"?(a.bab_claimed!==r&&t.push({feature:"Base Attack Bonus",oldValue:a.bab_claimed||void 0,newValue:r,reason:`Recalculated for new HD (${a.racialHD})`,action:"changed"}),a.bab_claimed=r,a.bab=r):h?(e.bab_claimed!==r&&t.push({feature:"Base Attack Bonus",oldValue:e.bab_claimed,newValue:e.bab_claimed,reason:`Preserved published BAB ${e.bab_claimed} despite expected ${r} (${o.trim()})`,action:"preserved"}),a.bab_claimed=e.bab_claimed,a.bab=e.bab_claimed):(a.bab_claimed!==r&&t.push({feature:"Base Attack Bonus",oldValue:a.bab_claimed||void 0,newValue:r,reason:o.trim(),action:"changed"}),a.bab_claimed=r,a.bab=r);const l=j[a.size]||{cmbCmdMod:0},S=Math.floor(((a.str??10)-10)/2),v=Math.floor(((a.dex??10)-10)/2),m=10+r+S+v+(l.cmbCmdMod||0),x=typeof e.cmd_claimed=="number"&&!isNaN(e.cmd_claimed),C=`10 + BAB(${r}) + Str(${S}) + Dex(${v}) + Size(${l.cmbCmdMod||0})`;i==="enforce_cr"?(a.cmd_claimed!==m&&t.push({feature:"CMD",oldValue:a.cmd_claimed||void 0,newValue:m,reason:`Recalculated for new BAB (${r})`,action:"changed"}),a.cmd_claimed=m,a.cmd=m):x?(e.cmd_claimed!==m&&t.push({feature:"CMD",oldValue:e.cmd_claimed,newValue:e.cmd_claimed,reason:`Preserved published CMD ${e.cmd_claimed} despite expected ${m} (${C})`,action:"preserved"}),a.cmd_claimed=e.cmd_claimed,a.cmd=e.cmd_claimed):(a.cmd_claimed!==m&&t.push({feature:"CMD",oldValue:a.cmd_claimed||void 0,newValue:m,reason:C,action:"changed"}),a.cmd_claimed=m,a.cmd=m);const $=a.hp_claimed||a.hp;if(i==="fix_math"&&$>0){const s=a.cr,d=L.find(u=>u.cr===s);if(d&&$>d.hp*1.5){for(const u of L)if($>=u.hp*.85&&$<=u.hp*1.25){t.push({feature:"Challenge Rating",oldValue:a.cr,newValue:a.cr,reason:`HP ${$} is too high for the published CR ${a.cr} (Benchmark: ${d.hp}). Suggested match: CR ${u.cr} (Benchmark: ${u.hp}). Preserved published CR per authoritative source.`,action:"warning"});break}}}const n=a.cr.toString();if(typeof e.xp=="number"&&!isNaN(e.xp)){const s=z[n];s&&s!==e.xp&&t.push({feature:"XP Award",oldValue:e.xp,newValue:e.xp,reason:`Preserved published XP ${e.xp} despite canonical XP ${s} for CR ${a.cr}.`,action:"preserved"}),a.xp=e.xp}else if(z[n]){const s=a.xp;a.xp=z[n],s!==a.xp&&t.push({feature:"XP Award",oldValue:s||void 0,newValue:a.xp,reason:`Assigned canonical XP ${a.xp} for CR ${a.cr}`,action:"changed"})}return{block:a,fixes:t}}function k(e){const i=[],a=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(a))return{valid:!0,messages:i,status:"PASS"};const t=L.find(l=>l.cr===String(e.cr)||l.cr===e.cr_text);if(!t)return{valid:!0,messages:i,status:"PASS"};const r=e.hp_claimed??e.hp??void 0;if(r!==void 0&&typeof r=="number"){const l=r/t.hp;l<.7?i.push({severity:"warning",category:"benchmarks",message:`HP ${r} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${t.hp}). Creature is a "Glass Jaw".`}):l>1.5&&i.push({severity:"warning",category:"benchmarks",message:`HP ${r} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${t.hp}). It may be a "Damage Sponge".`})}const o=e.ac_claimed??e.ac??void 0;if(o!==void 0&&typeof o=="number"){const l=o-t.ac;l<-3?i.push({severity:"warning",category:"benchmarks",message:`AC ${o} is very low (-${Math.abs(l)}) for CR ${e.cr} (Benchmark: ${t.ac}).`}):l>5&&i.push({severity:"warning",category:"benchmarks",message:`AC ${o} is very high (+${l}) for CR ${e.cr} (Benchmark: ${t.ac}).`})}const g=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const l of g)l.val!==void 0&&typeof l.val=="number"&&l.val<t.poorSave-2&&i.push({severity:"warning",category:"benchmarks",message:`${l.name} Save +${l.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${t.poorSave}).`});return{valid:!i.some(l=>l.severity==="error"),messages:i,status:i.length>0?"WARN":"PASS"}}const J=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,Q=()=>{const[e,i]=A.useState(J),[a,t]=A.useState("fix_math"),[r,o]=A.useState(()=>q(G(J),"fix_math").block),[g,h]=A.useState([]),[l,S]=A.useState([]),v=n=>{const _=n.currentTarget.value;i(_),x(_,a)},m=n=>{t(n),x(e,n)},x=(n,_)=>{try{const s=G(n),{block:d,fixes:u}=q(s,_);o(d),h(u);const M=K(s),y=k(s);S([M,y])}catch(s){console.error("Parse error:",s)}},C=n=>{switch(n){case"error":return"#dc2626";case"warning":return"#ea580c";case"info":return"#2563eb"}},$=n=>{switch(n){case"changed":return"#065f46";case"preserved":return"#b45309";case"warning":return"#991b1b";default:return"#047857"}};return c.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",fontFamily:"system-ui, sans-serif",height:"100vh",boxSizing:"border-box"}},c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"ðŸ“ Raw Stat Block"),c.createElement("textarea",{value:e,onChange:v,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",lineHeight:1.5},spellCheck:!1})),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",overflow:"auto"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âš–ï¸ Validation & Fixes"),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},l.map((n,_)=>c.createElement("div",{key:_,style:{border:"1px solid #d1d5db",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f9fafb"}},c.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem"}},n.messages[0]?.category||"Validation"),n.messages.length===0?c.createElement("div",{style:{color:"#059669",fontWeight:500}},"âœ“ PASS"):c.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},n.messages.map((s,d)=>c.createElement("li",{key:d,style:{color:C(s.severity),marginBottom:"0.25rem",fontSize:"0.875rem"}},c.createElement("strong",null,s.severity.toUpperCase(),":")," ",s.message,s.expected!==void 0&&c.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:"#6b7280"}},"Expected: ",JSON.stringify(s.expected)," | Actual: ",JSON.stringify(s.actual))))))),g.length>0&&c.createElement("div",{style:{border:"1px solid #10b981",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f0fdf4"}},c.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"#059669"}},"ðŸ› ï¸ Auto-Fixes Applied"),c.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},g.map((n,_)=>c.createElement("li",{key:_,style:{color:$(n.action),marginBottom:"0.5rem",fontSize:"0.875rem"}},c.createElement("strong",null,n.feature,":")," ",n.oldValue," â†’ ",c.createElement("strong",null,n.newValue),c.createElement("span",{style:{marginLeft:"0.5rem",fontSize:"0.75rem",opacity:.85}},n.action==="changed"&&"âœ… Changed",n.action==="preserved"&&"ðŸ›¡ï¸ Preserved",n.action==="warning"&&"âš ï¸ Warning"),c.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.1rem",color:"#065f46"}},n.reason))))))),c.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},c.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},c.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âœ¨ Auto-Fixed Version"),c.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},c.createElement("button",{onClick:()=>m("fix_math"),style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer",fontWeight:a==="fix_math"?700:400,backgroundColor:a==="fix_math"?"white":"transparent",color:a==="fix_math"?"#1d4ed8":"#4b5563",boxShadow:a==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none"},title:"Trust Stats, Update CR"},"Fix Math"),c.createElement("button",{onClick:()=>m("enforce_cr"),style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer",fontWeight:a==="enforce_cr"?700:400,backgroundColor:a==="enforce_cr"?"white":"transparent",color:a==="enforce_cr"?"#1d4ed8":"#4b5563",boxShadow:a==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none"},title:"Trust CR, Downgrade Stats"},"Enforce CR"))),c.createElement("textarea",{value:Y(r),readOnly:!0,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #10b981",borderRadius:"0.375rem",resize:"none",backgroundColor:"#f0fdf4",lineHeight:1.5},spellCheck:!1})))};Q.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const ie={title:"Validators/Rules Lawyer Workbench",component:Q,parameters:{layout:"fullscreen"}},N={};N.parameters={...N.parameters,docs:{...N.parameters?.docs,source:{originalSource:"{}",...N.parameters?.docs?.source}}};const se=["InteractiveWorkbench"];export{N as InteractiveWorkbench,se as __namedExportsOrder,ie as default};
