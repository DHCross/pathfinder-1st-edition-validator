import{r as $,R as l}from"./iframe-C4TbYbw6.js";import{C as N,a as P,S as z,X as B,M as H,v as W}from"./validateBasics-B3GO95Uh.js";import"./preload-helper-PPVm8Dsz.js";function T(e){return e.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function A(e){const s=e.split(`
`).map(o=>o.trim()).filter(Boolean),r=T(e),a={name:T(s[0]||"Unnamed Creature"),classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},d=r.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);d&&(a.cr=d[1]);const m=r.match(/XP\s*([0-9,]+)/i);m&&(a.xp=parseInt(m[1].replace(/,/g,"")));const n=r.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+)/i);if(n){a.alignment=n[1],a.size=n[2];let o=n[3].trim();/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata/i.test(o)?a.type="Outsider":/Dragon/i.test(o)?a.type="Dragon":/Undead/i.test(o)?a.type="Undead":a.type=o.split(" ")[0]}const h=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let t;for(;(t=h.exec(r))!==null;)a.classLevels?.push({className:t[1],level:parseInt(t[2])});const f=r.match(/AC\s*(\d+)/i);f&&(a.ac_claimed=parseInt(f[1]));const c=r.match(/touch\s*(\d+)/i);c&&(a.touch_ac_claimed=parseInt(c[1]));const i=r.match(/flat-footed\s*(\d+)/i);i&&(a.flat_footed_ac_claimed=parseInt(i[1]));const p=r.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(p&&(a.hp_claimed=parseInt(p[1]),a.hp=parseInt(p[1]),p[2])){const o=/(\d+)d/.exec(p[2]);o&&(a.racialHD=parseInt(o[1]))}const u=a.classLevels?.reduce((o,b)=>o+b.level,0)||0;a.racialHD===u&&u>0&&(a.racialHD=0);const g=r.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);g&&(a.fort_save_claimed=parseInt(g[1]),a.ref_save_claimed=parseInt(g[2]),a.will_save_claimed=parseInt(g[3]));const y=r.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);y&&(a.bab_claimed=parseInt(y[1]));const v=r.match(/CMD\s*(\d+)/i);v&&(a.cmd_claimed=parseInt(v[1]));const C=/Str\s*(\d+)/i.exec(r),x=/Dex\s*(\d+)/i.exec(r),_=/Con\s*(\d+)/i.exec(r),M=/Int\s*(\d+)/i.exec(r),E=/Wis\s*(\d+)/i.exec(r),D=/Cha\s*(\d+)/i.exec(r);C&&(a.str=parseInt(C[1])),x&&(a.dex=parseInt(x[1])),_&&(a.con=parseInt(_[1])),M&&(a.int=parseInt(M[1])),E&&(a.wis=parseInt(E[1])),D&&(a.cha=parseInt(D[1])),a.ac_claimed&&(a.ac=a.ac_claimed);const I=r.match(/Feats[:\s]+(.+?)(?:;|$|Skills|Languages|SQ|Ecology|Special Abilities)/i);I&&(a.feats=I[1].split(/[,;]+/).map(o=>o.trim()).filter(Boolean));const R=r.match(/Treasure\s+(.+?)(?:$|\n)/i);if(R){const o=R[1].toLowerCase();o.includes("npc gear")?a.treasureType="NPC Gear":(o.includes("standard"),a.treasureType="Standard")}return a}function O(e){const{name:s,cr:r,xp:a,size:d,type:m}=e,n=i=>Math.floor((i-10)/2),h=i=>n(i)>=0?`+${n(i)}`:`${n(i)}`;let t="";if(e.classLevels&&e.classLevels.length>0){const i=e.classLevels[0],p=N[i.className],u=p?p.hitDieType:8,g=e.classLevels.reduce((y,v)=>y+v.level,0);t=`${g}d${u}+${n(e.con)*g}`}else{const i=e.racialHD||1,p=P[e.type],u=p?p.hitDieType:8;t=`${i}d${u}+${n(e.con)*i}`}const f=e.classLevels?.map(i=>`${i.className} ${i.level}`).join(", ")||"",c=f?`${e.alignment||"N"} ${d} ${m} ${f}`:`${e.alignment||"N"} ${d} ${m}`;return`
${s}
CR ${r}
XP ${a?.toLocaleString()||"0"}
${c}
Init ${h(e.dex)}; Senses Perception +0
DEFENSE
AC ${e.ac_claimed||e.ac}, touch ${e.touch_ac_claimed||10}, flat-footed ${e.flat_footed_ac_claimed||10}
hp ${e.hp_claimed||e.hp} (${t})
Fort +${e.fort_save_claimed||0}, Ref +${e.ref_save_claimed||0}, Will +${e.will_save_claimed||0}
OFFENSE
Speed 30 ft.
Melee weapon +${e.bab_claimed||0} (1d8)
STATISTICS
Str ${e.str}, Dex ${e.dex}, Con ${e.con}, Int ${e.int}, Wis ${e.wis}, Cha ${e.cha}
Base Atk +${e.bab_claimed||0}; CMB +${(e.bab_claimed||0)+n(e.str)}; CMD ${e.cmd_claimed||10}
Feats ${e.feats?.join(", ")||"None"}
Treasure ${e.treasureType||"Standard"}
`.trim()}function w(e){const s=JSON.parse(JSON.stringify(e));let r=0;if(s.racialHD&&s.racialHD>0){const t=P[s.type];t?t.babProgression==="fast"?r+=s.racialHD:t.babProgression==="medium"?r+=Math.floor(s.racialHD*.75):r+=Math.floor(s.racialHD*.5):r+=Math.floor(s.racialHD*.75)}const a=s.classLevels||[];for(const t of a){const f=N[t.className];f&&(f.babProgression==="fast"?r+=t.level:f.babProgression==="medium"?r+=Math.floor(t.level*.75):r+=Math.floor(t.level*.5))}(s.racialHD||0)===0&&a.length===0&&(r=s.bab_claimed??s.bab??0),s.bab_claimed=r,s.bab=r;const d=z[s.size]||{cmbCmdMod:0},m=Math.floor(((s.str??10)-10)/2),n=Math.floor(((s.dex??10)-10)/2);s.cmd_claimed=10+r+m+n+(d.cmbCmdMod||0),s.cmd=s.cmd_claimed;let h=s.cr;return B[h]&&(s.xp=B[h]),s}function V(e){const s=[],r=typeof e.cr=="number"?e.cr:parseInt(String(e.cr),10);if(isNaN(r))return{valid:!0,messages:s,status:"PASS"};const a=H.find(t=>t.cr===String(e.cr)||t.cr===e.cr_text);if(!a)return{valid:!0,messages:s,status:"PASS"};const d=e.hp_claimed??e.hp??void 0;if(d!==void 0&&typeof d=="number"){const t=d/a.hp;t<.7?s.push({severity:"warning",category:"benchmarks",message:`HP ${d} is dangerously low (<70%) for CR ${e.cr} (Benchmark: ${a.hp}). Creature is a "Glass Jaw".`}):t>1.5&&s.push({severity:"warning",category:"benchmarks",message:`HP ${d} is significantly high (>150%) for CR ${e.cr} (Benchmark: ${a.hp}). It may be a "Damage Sponge".`})}const m=e.ac_claimed??e.ac??void 0;if(m!==void 0&&typeof m=="number"){const t=m-a.ac;t<-3?s.push({severity:"warning",category:"benchmarks",message:`AC ${m} is very low (-${Math.abs(t)}) for CR ${e.cr} (Benchmark: ${a.ac}).`}):t>5&&s.push({severity:"warning",category:"benchmarks",message:`AC ${m} is very high (+${t}) for CR ${e.cr} (Benchmark: ${a.ac}).`})}const n=[{name:"Fort",val:e.fort_save_claimed},{name:"Ref",val:e.ref_save_claimed},{name:"Will",val:e.will_save_claimed}];for(const t of n)t.val!==void 0&&typeof t.val=="number"&&t.val<a.poorSave-2&&s.push({severity:"warning",category:"benchmarks",message:`${t.name} Save +${t.val} is critically weak for CR ${e.cr} (Benchmark Poor Save: +${a.poorSave}).`});return{valid:!s.some(t=>t.severity==="error"),messages:s,status:s.length>0?"WARN":"PASS"}}const F=`Fire Beetle
CR 1/3
XP 135
N Small vermin
Init +0; Senses Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 4 (1d8)
Fort +2, Ref +0, Will +0
OFFENSE
Speed 30 ft.
Melee bite +1 (1d4)
STATISTICS
Str 10, Dex 11, Con 11, Int 10, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats Weapon Finesse
Treasure None`,L=()=>{const[e,s]=$.useState(F),[r,a]=$.useState(()=>w(A(F))),[d,m]=$.useState([]),n=t=>{const f=t.currentTarget.value;s(f);try{const c=A(f),i=w(c);a(i);const p=W(c),u=V(c);m([p,u])}catch(c){console.error("Parse error:",c)}},h=t=>{switch(t){case"error":return"#dc2626";case"warning":return"#ea580c";case"info":return"#2563eb"}};return l.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",padding:"1rem",fontFamily:"system-ui, sans-serif",height:"100vh",boxSizing:"border-box"}},l.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},l.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"ðŸ“ Raw Stat Block"),l.createElement("textarea",{value:e,onChange:n,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",resize:"none",lineHeight:1.5},spellCheck:!1})),l.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",overflow:"auto"}},l.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âš–ï¸ Validation Results"),l.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},d.map((t,f)=>l.createElement("div",{key:f,style:{border:"1px solid #d1d5db",borderRadius:"0.375rem",padding:"0.75rem",backgroundColor:"#f9fafb"}},l.createElement("div",{style:{fontWeight:600,marginBottom:"0.5rem"}},t.messages[0]?.category||"Validation"),t.messages.length===0?l.createElement("div",{style:{color:"#059669",fontWeight:500}},"âœ“ PASS"):l.createElement("ul",{style:{margin:0,paddingLeft:"1.5rem"}},t.messages.map((c,i)=>l.createElement("li",{key:i,style:{color:h(c.severity),marginBottom:"0.25rem",fontSize:"0.875rem"}},l.createElement("strong",null,c.severity.toUpperCase(),":")," ",c.message,c.expected!==void 0&&l.createElement("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem",color:"#6b7280"}},"Expected: ",JSON.stringify(c.expected)," | Actual: ",JSON.stringify(c.actual))))))))),l.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"}},l.createElement("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600}},"âœ¨ Auto-Fixed Version"),l.createElement("textarea",{value:O(r),readOnly:!0,style:{flex:1,padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #10b981",borderRadius:"0.375rem",resize:"none",backgroundColor:"#f0fdf4",lineHeight:1.5},spellCheck:!1})))};L.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const U={title:"Validators/Rules Lawyer Workbench",component:L,parameters:{layout:"fullscreen"}},S={};S.parameters={...S.parameters,docs:{...S.parameters?.docs,source:{originalSource:"{}",...S.parameters?.docs?.source}}};const j=["InteractiveWorkbench"];export{S as InteractiveWorkbench,j as __namedExportsOrder,U as default};
