import{r as m,R as a}from"./iframe-B8e6Fyvt.js";import{s as O,f as V}from"./pf1e-formatter-BViDTO6Q.js";import{a as H,v as X}from"./validateBenchmarks-Q5KBnCxV.js";import{X as U}from"./pf1e-data-tables-BqrvN3By.js";import{v as z,a as q,V as Q}from"./validateEconomy-Mk1nyWUe.js";import"./preload-helper-PPVm8Dsz.js";function $(d){return d.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2212/g,"-").replace(/\u00A0/g," ").trim()}function J(d){const t=$(d),e={name:t.split(`
`).map(s=>s.trim()).filter(Boolean)[0]||"Unnamed Creature",classLevels:[],feats:[],str:10,dex:10,con:10,int:10,wis:10,cha:10,hp:10,ac:10,fort:0,ref:0,will:0,bab:0,cr:"1",size:"Medium",type:"Humanoid"},h=t.match(/Melee\s+(.+?)(?=\n|Ranged|Space|Special|Str|Statistic)/i);h&&(e.melee_line="Melee "+h[1].trim());const x=t.match(/Ranged\s+(.+?)(?=\n|Space|Special|Str|Statistic)/i);x&&(e.ranged_line="Ranged "+x[1].trim());const c=t.match(/Speed\s+(.+?)(?=\n|Melee|Ranged|Space|Special|Str|Statistic)/i);c&&(e.speed_line="Speed "+c[1].trim());const b=t.match(/Special Attacks\s+(.+?)(?=\n|Str|Statistic|Spells)/i);b&&(e.special_attacks_line="Special Attacks "+b[1].trim());const p=t.match(/(?:Spells|Spell-Like).+?(?=STATISTICS|Str\s+\d)/s);p&&(e.spells_block=p[0].trim());const C=t.match(/SPECIAL ABILITIES(.+)$/s);C&&(e.special_abilities_block=`SPECIAL ABILITIES
`+C[1].trim());const k=t.match(/Skills\s+(.+?)(?=\n|Languages|SQ|Feats|Special|Gear|Treasure)/i);k&&(e.skills_line="Skills "+k[1].trim());const y=t.match(/Languages\s+(.+?)(?=\n|SQ|Feats|Special|Gear|Treasure)/i);y&&(e.languages_line="Languages "+y[1].trim());const I=t.match(/(?:Combat Gear|Other Gear|Equipment)\s+(.+?)(?=\n|Special|Treasure)/is);I&&(e.equipment_line="Equipment "+I[1].trim());const M=t.match(/(?:CR|Challenge Rating)\s*(\d+(?:[\/\.]\d+)?)/i);M&&(e.cr=M[1]);const r=t.match(/XP\s*([0-9,]+)/i);r&&(e.xp=parseInt(r[1].replace(/,/g,"")));const l=t.match(/(LG|NG|CG|LN|N|CN|LE|NE|CE)\s+(Fine|Diminutive|Tiny|Small|Medium|Large|Huge|Gargantuan|Colossal)\s+([a-zA-Z\-\s\(\)]+?)(?=\s*(?:Init|Senses|CR|Level|\d))/i);if(l){e.alignment=l[1],e.size=l[2];const s=l[3].trim();e.subtypes=s.split(/,\s*/).map(E=>E.trim()).filter(Boolean),/Fiend|Devil|Demon|Daemon|Angel|Archon|Azata|Chaos-Beast/i.test(s)?e.type="Outsider":/Dragon/i.test(s)?e.type="Dragon":/Undead/i.test(s)?e.type="Undead":/Beast/i.test(s)?e.type="Magical Beast":e.type=s.split(" ")[0]}const B=/(Barbarian|Bard|Cleric|Druid|Fighter|Monk|Paladin|Ranger|Rogue|Sorcerer|Wizard|Adept|Aristocrat|Commoner|Expert|Warrior)\s+(\d+)/gi;let g;for(;(g=B.exec(t))!==null;)e.classLevels?.push({className:g[1],level:parseInt(g[2])});const A=t.match(/AC\s*(\d+)/i);A&&(e.ac_claimed=parseInt(A[1]));const w=t.match(/touch\s*(\d+)/i);w&&(e.touch_ac_claimed=parseInt(w[1]));const T=t.match(/flat-?footed\s*(\d+)/i);T&&(e.flat_footed_ac_claimed=parseInt(T[1]));const u=t.match(/(?:hp|HP)\s*(\d+)\s*(?:\(([^)]+)\))?/);if(u&&(e.hp_claimed=parseInt(u[1]),e.hp=parseInt(u[1]),u[2])){const s=/(\d+)d/.exec(u[2]);s&&(e.racialHD=parseInt(s[1]))}const S=e.classLevels?.reduce((s,E)=>s+E.level,0)||0;e.racialHD===S&&S>0&&(e.racialHD=0);const n=t.match(/Fort\s*\+?(-?\d+),\s*Ref\s*\+?(-?\d+),\s*Will\s*\+?(-?\d+)/i);n&&(e.fort_save_claimed=parseInt(n[1]),e.ref_save_claimed=parseInt(n[2]),e.will_save_claimed=parseInt(n[3]));const v=t.match(/(?:Base Atk|Base Atk\.|Base Attack)\s*\+?(\d+)/i);v&&(e.bab_claimed=parseInt(v[1]));const _=t.match(/CMD\s*(\d+)/i);_&&(e.cmd_claimed=parseInt(_[1]));const f=(s,E)=>{const D=new RegExp(`${E}\\s*(\\d+|[\\u2013\\u2014\\-])`,"i"),P=s.match(D);if(!P)return 10;const W=P[1];return/\d/.test(W)?parseInt(W):0};e.str=f(t,"Str"),e.dex=f(t,"Dex"),e.con=f(t,"Con"),e.int=f(t,"Int"),e.wis=f(t,"Wis"),e.cha=f(t,"Cha"),e.ac_claimed&&(e.ac=e.ac_claimed),e.touch_ac_claimed&&(e.touch=e.touch_ac_claimed),e.flat_footed_ac_claimed&&(e.flatFooted=e.flat_footed_ac_claimed);const N=t.match(/Init\s*([+-]?\d+)/i);N&&(e.init_claimed=parseInt(N[1]));const R=t.match(/Perception\s*([+-]?\d+)/i);R&&(e.perception_claimed=parseInt(R[1]));const F=t.match(/Feats[:\s]+(.+?)(?=\n|Skills|Languages|SQ|Ecology|Special Abilities)/i);F&&(e.feats=F[1].split(/[,;]/).map(s=>s.trim()).filter(Boolean));const o=t.match(/Treasure\s+(.+?)(?:$|\n)/i);if(o){const s=o[1].toLowerCase();s.includes("npc gear")?e.treasureType="NPC Gear":(s.includes("standard"),e.treasureType="Standard")}return e}const K=`Fire Beetle
CR 1
XP 400
N Small Vermin
Init +0; Senses Darkvision 60 ft.; Perception +0
DEFENSE
AC 12, touch 11, flat-footed 12
hp 50 (1d8+46)
Fort +2, Ref +0, Will +0
Immune mind-affecting effects
OFFENSE
Speed 30 ft., fly 30 ft. (poor)
Melee bite +1 (1d4)
Special Abilities Luminescence
STATISTICS
Str 10, Dex 11, Con 11, Int -, Wis 10, Cha 7
Base Atk +0; CMB -1; CMD 9
Feats None
Treasure None`,G=()=>{const[d,t]=m.useState(K),[i,e]=m.useState(null),[h,x]=m.useState(1),[c,b]=m.useState("enforce_cr"),[p,C]=m.useState(null),[k,y]=m.useState([]),[I,M]=m.useState(null);return m.useEffect(()=>{if(!d.trim()){e(null),C(null),M(null),y([]);return}try{const r=J(d);e(r);const l=parseInt(r.cr)||1;x(l)}catch(r){console.error(r)}},[d]),m.useEffect(()=>{if(!i)return;let r=JSON.parse(JSON.stringify(i));const l=[],B=i.cr,g=h.toString();if(B!==g){const o=U[g];if(o){const{block:s,changes:E}=O(r,o);r=s,E.forEach(D=>l.push({feature:"Creature Scaler",oldValue:B,newValue:g,reason:D}))}}const{block:A,fixes:w}=H(r,c);C(A),y([...l,...w]);const u=z(i).messages.filter(o=>o.category==="structure"),S=c==="enforce_cr"?A:i;let n={status:"PASS",messages:[]},v={status:"PASS",messages:[]},_={status:"PASS",messages:[]};S&&(n=z(S),v=X(S),_=q(S));const f=[...u,...n.messages,...v.messages,..._.messages],N=u.some(o=>o.severity==="critical"),R=n.status==="FAIL"||_.status==="FAIL",F={valid:!N&&!R,status:N||R?"FAIL":n.status==="WARN"||_.status==="WARN"||v.status==="WARN"?"WARN":"PASS",messages:f};M(F)},[i,h,c]),a.createElement("div",{className:"validator-playground"},a.createElement("div",{className:"validator-column"},a.createElement("h2",{className:"validator-header"},"1. Raw Stat Block"),a.createElement("textarea",{className:"validator-textarea",value:d,onChange:r=>t(r.target.value),spellCheck:!1,placeholder:"Paste stat block here..."})),a.createElement("div",{className:"validator-scroll-area"},a.createElement("div",null,a.createElement("h3",{className:"validator-header"},"2. Rules Lawyer Audit (v3.0)"),a.createElement("div",{style:{fontSize:"0.85rem",color:"#6b7280",marginBottom:"0.5rem"}},"Validating: ",c==="enforce_cr"?"Auto-Fixed Version (Design Mode)":"Raw Input (Audit Mode)"),i&&I?a.createElement(Q,{statBlock:c==="enforce_cr"?p:i,validation:I,validationTarget:c==="enforce_cr"?"fixed":"raw"}):null),k.length>0&&a.createElement("div",{className:"fix-report"},a.createElement("h4",{className:"fix-report-header"},"ðŸ› ï¸ Auto-Fixes Applied (",c==="fix_math"?"Audit Mode":"Design Mode",")"),a.createElement("ul",{className:"fix-list"},k.map((r,l)=>a.createElement("li",{key:l,className:"fix-item"},a.createElement("div",{style:{fontWeight:600}},r.feature),a.createElement("div",{className:"fix-change-row"},a.createElement("span",{className:"fix-old"},r.oldValue),a.createElement("span",null,"â†’"),a.createElement("span",{className:"fix-new"},r.newValue)),a.createElement("div",{className:"fix-reason"},r.reason)))))),a.createElement("div",{className:"validator-column"},a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}},a.createElement("h2",{className:"validator-header"},"3. Auto-Fixed Version"),a.createElement("div",{className:"mode-toggle",style:{display:"flex",alignItems:"center",gap:"1rem"}},a.createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"#f3f4f6",padding:"0.25rem 0.5rem",borderRadius:"0.25rem"}},a.createElement("label",{htmlFor:"cr-slider",style:{fontSize:"0.75rem",fontWeight:"bold",color:"#4b5563"}},"Target CR: ",h),a.createElement("input",{id:"cr-slider",type:"range",min:"1",max:"20",value:h,onChange:r=>x(parseInt(r.target.value)),style:{width:"100px"}})),a.createElement("div",{style:{display:"flex",backgroundColor:"#e5e7eb",borderRadius:"0.25rem",padding:"0.25rem"}},a.createElement("button",{onClick:()=>b("enforce_cr"),style:{backgroundColor:c==="enforce_cr"?"white":"transparent",color:c==="enforce_cr"?"#1d4ed8":"#4b5563",fontWeight:c==="enforce_cr"?"bold":"normal",boxShadow:c==="enforce_cr"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep CR, Downgrade Stats"},"Design Mode (Enforce CR)"),a.createElement("button",{onClick:()=>b("fix_math"),style:{backgroundColor:c==="fix_math"?"white":"transparent",color:c==="fix_math"?"#1d4ed8":"#4b5563",fontWeight:c==="fix_math"?"bold":"normal",boxShadow:c==="fix_math"?"0 1px 2px 0 rgba(0, 0, 0, 0.05)":"none",padding:"0.25rem 0.75rem",fontSize:"0.75rem",borderRadius:"0.25rem",border:"none",cursor:"pointer"},title:"Keep Stats, Update CR"},"Audit Mode (Fix Math)")))),a.createElement("div",{className:"output-area"},p?a.createElement("pre",{className:"output-pre"},V(p)):a.createElement("p",{style:{color:"#9ca3af",fontSize:"0.875rem",fontStyle:"italic"}},"Fixes will appear here.")),a.createElement("button",{onClick:()=>p&&navigator.clipboard.writeText(V(p)),className:"copy-btn"},"ðŸ“‹ Copy to Clipboard")))};G.__docgenInfo={description:"",methods:[],displayName:"ValidatorPlayground"};const se={title:"Validators/Rules Lawyer Workbench",component:G,parameters:{layout:"fullscreen"}},L={};L.parameters={...L.parameters,docs:{...L.parameters?.docs,source:{originalSource:"{}",...L.parameters?.docs?.source}}};const re=["InteractiveWorkbench"];export{L as InteractiveWorkbench,re as __namedExportsOrder,se as default};
